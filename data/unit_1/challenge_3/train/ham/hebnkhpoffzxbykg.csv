<title>RFM User's Guide</title>

<center> <h3> Michelson Interferometer for Passive 
Atmospheric Sounding (MIPAS) </h3> </center>
<center> <h3> Reference Forward Model (RFM) </h3> </center>
<center> <h1> SOFTWARE USER'S MANUAL (SUM) </h1> </center>
<center> <h2> PO-MA-OXF-GS-0003 </H2> </CENTER>
<center> <h2> Issue 4.2 </H2> </CENTER>
<p>
<p>
<h2> Contents </h2>
	<ol>
	<li> <a href=#intro>Introduction</a>
	<li> <a href=#ti> Terminal Input</a>
	<li> <a href=#to> Terminal Output </a>
	<li> <a href=#fi> Input Files </a>
	<li> <a href=#fo> Output Files </a> 
	<li> <a href=#driver> Driver Table </a> 
	<li> <a href=#error> Error Handling </A>
	<li> <a href=#runlog> Runlog File </A>
	<LI> <A href=#speed> Numerical Optimisations </a>
	<li> <a href=#size> Memory Size </a>
	<li> <a href=#alpha> Alpha Modifications </a>
	<li> <a href=#linux> Linux Modifications </a>
	<LI> Appendices 
		<ul>
	<li> A: <a href=#sections> Driver Table Sections </a>
	<li> B: <a href=#flags>Flags </a>
	<li> C: <a href=#formats> File Formats </a>
	<li> D: <a href=#spectra> Output Spectra </a>
	<li> E: <a href=#gaslist> List of Absorbers </a>
		</ul>
	<li> <a href=#abb>List of Abbreviations </a>
	<li> <a href=#ref>References & Applicable Documents</a>
	</ul>
<h3>Other Web documents</h3>
	<ul>
	<li> <a href=index.html>RFM home page</a>
	<li> <a href=rfm_bugs.html>List of known bugs</a>
	<li> <a href=rfm_upgrades.html>List of upgrades</a>
	</ul>
<h3>Document Change History</h3>
<ul>
<LI> 19-JAN-2004: Modify definition of <a href=#ntefil>.nte</a> file format to 
allow for rotational non-LTE.
<LI> 16-JAN-2004: Write out absorption coefficient for <a href=#mtxflg>MTX</a>
+ <a href=#traflg>TRA</a> flags
<LI> 06-JAN-2004: Add <a href=#prfflg>PRF</a> flag
<LI> 02-JAN-2004: Add <a href=#levflg>LEV</a> flag
<LI> 03-SEP-2003: Add surface parameter jacobians
<LI> 11-AUG-2003: Add <a href=#vvwflg>VVW</a> flag and 
VVW option to <a href=#shp>*SHP</a> lineshapes
<LI> 10-AUG-2003: Add <a href=#bbtflg>BBT</a> and <a href=#ghzflg>GHZ</a>
flags v4.23 onwards. 
<LI> 23-JUL-2003: Add capability of using input filename templates, 
v4.23 onwards.
<LI> 14-FEB-2003: Add capability of using direct TIPS tabulations
<a href=#tpsflg>TPS flag</a>, v4.22 onwards.
<LI> 25-APR-2002: Add capability of multiple ILS shapes within
a single <a href=#ilsfil>.ils file</a> (v4.21 onwards)
<LI> 04-MAR-2002: Add capability of handling separate isotope profiles.
<LI> 12-DEC-2001: Add warnings to compiling under 
<a href=#linux>Linux</a> with g77.
<LI> 05-SEP-2001: Add comments about <tt>FWIND</tt> under 
<a href=#wngflg>WNG</a> flag.
<LI> 08-JUN-2001: Add <a href=#losflg>LOS</a> flag (v4.11 onwards)
<li> 07-FEB-2001: Additional species #70-81 defined
<LI> 16-OCT-2000: Additional species #40-45 defined
in <a href=#gaslist>Appendix E</a>
<li> 08-JUN-2000: Extend use of irregular grids (v4.10 onwards)
<li> 28-MAY-2000: Add <a href=#dblflg>DBL</a> flag (v4.10 onwards)
<LI> 24-APR-2000: Add <a href=#flxflg>FLX</a>, <a href=#cooflg>COO</a>
and <a href=#mtxflg>MTX</a> flags (v4.10 onwards).
<li> 05-JAN-2000: Add <a href=#graflg>GRA</a> and <a href=#avgflg>AVG</a>
flags (v4.10 onwards).
<li> 05-NOV-1999: Add relevant bugs
<LI> 15-SEP-1999: RFM Version 4 
<li> 05-MAR-1997: Modifications for RFM Version 3 and review comments.
<LI> 16-OCT-1996: Introduction: 
incorporate suggestions from CM4 meeting regarding RFM
version designation using <tt>VERSN</tt> field.
<LI> 01-OCT-1996: Revised to incorporate ESTEC comments and RFM Version 2
     changes
<li> 01-SEP-1996: 1st Draft, applicable to RFM Version 1
</ul>


<hr>
<a name=intro>
<h2>1. INTRODUCTION </h2>


The MIPAS Reference Forward Model (RFM) is a program to calculate line-by-line
atmospheric limb emission/transmission spectra for the Earth. 
It was created under ESA contract number ESTEC 11886/NL/GS within the
Statement of Work <A href=#sow>PO-SW-ESA-GS-00323</a>, to meet the 
specifications listed in the Software Requirements Document 
<a href=#srd>PO-RS-OXF-GS-0001</A>. The High-Level Algorithm Description is
contained in document <a href=#hlad>PO-MA-OXF-GS-0004</A>.
<p>
The installation of the RFM program is described in the RFM Software
Transfer Document <a href=#std>(PO-MA-OXF-GS-0009)</a>.
The method used to validate
the installation is described in the RFM Software Verification
and Validation Plans <a href=#svvp>(PO-PL-OXF-GS0002)</a>, which 
also describes the quality control applied during software development.
It should be possible to
install the RFM on any Unix machine with 64Mbytes of available RAM,
200 Mbytes of free disc space (in addition to that required for the ASCII
HITRAN database), and a Fortran77 compiler which accepts MIL-STD 1753 language
extensions 
(<tt>INCLUDE</tt>, <tt>IMPLICIT NONE</tt>, <tt>DO WHILE</tt>, <tt>ENDDO</tt>
 in particular).
<P>
<a name=reclen>
There is a single machine-dependent part of the source code which is
the <TT>RECL</TT> parameter in the FORTRAN OPEN statement required when opening
the (direct access) HITRAN binary file. 
This usually has the value 88 although Alpha machines 
require a value 22. The RFM accesses the appropriate
value by including the file <tt>reclen.inc</tt>, however
the source code is usually distributed with both 
<tt>reclen.inc_88</tt> and <tt>reclen.inc_22</tt> rather than 
<tt>reclen.inc</tt> to force the user to 
select the correct version before compiling, eg.
<PRE>
       cp reclen.inc_88 reclen.inc
</PRE>
<P>
In most situations, all that is then needed to compile the code is to place all
source code (*.for and *.inc files) in a single directory and do
<pre>
       f77 *.for -o rfm
</pre>
See also <a href=#linux>Linux modifications</a> 
<p>
After initiating the program, operation is controlled by an ASCII
Driver File opened in the local directory with the filename <tt>rfm.drv</tt>.
A single run
of the RFM can produce spectra for one or more tangent heights over one or more
spectral ranges, as specified in this Driver Table. 
<p>
To run the program, 
change default directory (<tt>cd</tt>) to the directory containing the Driver
File.
Unless otherwise directed (via the Driver Table), 
all output files will also be created in the default
directory.
Assuming the RFM executable has been installed in the directory 
<tt>RFMPATH/bin</tt>
the program is run with the command 
<pre>
RFMPATH/bin/rfm
</pre>
<center><b>LOCAL MODIFICATIONS</b></center>
There is a  C*11 field <tt>VERSN</TT> (set
as the first executable statement in the main program module <tt>rfm.for</tt>)
which is written as part of the output file headers. To allow traceability
between spectra generated by different versions of the RFM code,
any local modifications to the RFM code should be reflected in this field.
E.g.,  to represent a local Oxford modification 13 to the
standard (ESTEC-distrubuted) version `4.00', the suggested change is:
<blockquote><tt>VERSN = '4.00_OXF_13'</tt></blockquote> 
<p>
Any queries or <a href=rfm_bugs.html>Bug reports</a>
should be addressed to: <br>
<blockquote>
A.Dudhia <br>
AOPP, Clarendon Laboratory <br>
Parks Rd,
Oxford OX1 3PU <br>
England <br>
<i>email: <a href=mailto:dudhia@atm.ox.ac.uk>dudhia@atm.ox.ac.uk</a></i>
</blockquote>
<hr>
<blockquote>
For copyright purposes, the program is regarded as a GENLN2 derivative.
All rights, title and interest in and to the copyright
and any other proprietary right, are held by
The University Corporation for Atmospheric Research, having a
correspondence address of P.O. Box 3000, Boulder, Colorado 80307, USA.
</blockquote>
<p>
<hr>
<a name=ti>
<a name=runid>
<h2>2. TERMINAL INPUT </h2>

On starting, the RFM prompts the user (via the terminal) 
for a `<tt>run_ID</tt>'.
The normal response would just be <tt>&lt;CR&gt;</TT>,
 but can be any contiguous text label (up to 80 characters)
which is then appended to any filenames generated from this particular run.
In the following example the 
user responds to the prompt by typing `<tt>_x</tt>':
<blockquote>
<pre>
Optional ID to be appended to filenames (&lt;CR&gt;=none):
_x 
</pre>
</blockquote>
This would then generate files such as <tt>rfm.runlog_x</tt> and
<tt>pth_40000.asc_x</tt> instead of
the default <tt>rfm.runlog</tt> and <tt>pth_40000.asc</tt> (obtained 
if the user had responded with <tt>&lt;CR&gt;</tt>).
The file contents are unaffected, ie the output files contain no internal
record of the <tt>run_ID</tt> label. 
<p>
The <tt>run_ID</tt> may be convenient for:
<ul>
<li>Distinguishing files generated under (slightly) different conditions
<li>Allowing multiple runs in parallel 
</ul>

<hr>
<a name=to>
<h2>3. TERMINAL OUTPUT </h2>

A typical (short) run of the RFM generates the following messages on the 
terminal
<blockquote>
<pre>
R-RFM:    Program RFM v4.00
Optional ID to be appended to filenames (&lt;CR&gt;=none):
_x                                                      [ = user response ]
R-RFM:    Filename append string=_x
R-RFM:    Commencing Wide Mesh Calculation
R-RFM:    Commencing Fine Mesh Calculation
          1           4
          2           4
          3           4
          4           4
R-RFM:    Successful completion
</pre>
</blockquote>
<p>
The <tt>R-RFM: ...</tt>
 messages are routine status information, the first one indicating
the version of the RFM is being run. 
This version identifier also appears in the
first header record of all output files.
<p>
Note that if the user had typed `<tt>&lt;CR&gt;</tt>'
 instead of `<tt>_x</tt>' the
second <tt>R-RFM: ...</tt> record confirming the <tt>run_ID</tt> would have
been suppressed.
<p>
The Wide Mesh Calculation usually starts a few seconds after the user responds 
to the <tt>run_ID</tt> prompt (but may be rather longer if any molecular 
cross-sectional data are required due to the time taken to check these files).
During this interval, the Driver Table is completely processed, so after this
message appears it is safe to alter the Driver Table 
to set up another run.
Once the Wide Mesh Calculation starts, it can usually be assumed that the 
program will continue to a successful completion. Any subsequent problem
would most likely be caused by running out of disk space or other problem
associated with writing the
output files. Another possible subsequent 
run-time problem is running out of cyclic
buffer space if the number of HITRAN lines required for the fine mesh
calculation exceeds parameter MAXCYC in RFMSIZ.INC. For HITRAN96, a parameter 
MAXCYC=10000 seems adequate.
<p>
The sequence of number pairs refer to the
current wavenumber interval processed during the Fine Mesh Calculation, 
and the (fixed) total number required, which gives some idea of progress (this 
is the time-consuming part of any major run of the RFM).
<p>
The `<tt>R-RFM:    Successful completion</tt>' message indicates a successful
completion, i.e. no fatal errors. 
Any `underflow' messages can be ignored.
<p>
If, for some reason, a fatal error occurs (most likely while the Driver Table
is being processed, i.e. before the commencement of the Wide Mesh Calculation)
the program will halt and print a message to the terminal 
beginning with `<tt>F-</tt>'
(see <a href=#error>Section 7</a>).
<p>
It is possible that various `warning' (rather than `fatal') conditions may
arise, in which case an extra message will be printed to the terminal just 
before the `<tt>successful completion</tt>' message, e.g.
<blockquote>
<pre>
R-RFM:          3 Warning messages in RUNLOG file
</pre>
</blockquote>
The <tt><a href=#runlog>.runlog</a></tt>
 file should then be inspected for details.
                                                    
<hr>
<a name=fi>
<h2>4. INPUT FILES </h2>

The first input file required is the `Driver Table' 
(see <a href=#driver>Section 6</a>)
which is opened with the 
filename `<tt>rfm.drv</tt>'. Other input files are determined by the 
Driver Table, and detailed formats are given in <A href=#formats>Appendix C</a>.
Filenames listed in the Driver Table are transferred directly to the 
FORTRAN <tt>OPEN</tt> Statement so should also include any relative directory
information, e.g. `<tt>./inp/std.atm</tt>'
 (subject to the 80-character limit for
any record read from the Driver File).
<p>
It is recommended that these files are distinguished by the 
3-character extensions listed here.
	<dl>
	<dt> <tt><a href=#atmfil>.atm</a>  </tt> 
	<dd> Atmospheric Profiles (mandatory)

	<dt> <tt><a href=#spcfil>.spc</a>  </tt>
	<dd> Spectral Ranges (optional)

	<dt> <tt><a href=#gasfil>.gas</a>  </tt>
	<dd> List of Absorbers (optional)

	<dt> <tt><a href=#tanfil>.tan</a>  </tt>
	<dd> List of Tangent Heights (optional)

	<dt> <tt><a href=#fovfil>.fov</a>  </tt>
	<dd> Field-of-View data (required if <a href=#fovflg>FOV Flag</a> enabled)

	<dt> <tt><a href=#grdfil>.grd</a>  </tt>
	<dd> Irregular Grid Files (required if <a href=#grdflg>GRD Flag</a> enabled)

	<dt> <tt><a href=#hitfil>.hit</a>  </tt>
	<dd> HITRAN binary line data (required for any `line' molecules)

        <dt> <tt><a href=#ilsfil>.ils</a>  </tt>
        <dd> Instrument Line Shape data (required if <a href=#ilsflg>ILS Flag</a> enabled)

	<dt> <tt><a href=#lutfil>.lut</a>  </tt>
	<dd> Look-Up Tables (required if <a href=#lutflg>LUT Flag</a> enabled)

	<dt> <tt><a href=#ntefil>.nte</a>  </tt>
	<dd> Non-LTE data (required if
		<a href=#nteflg>NTE Flag</a> enabled)

	<dt> <tt><a href=#tpsfil>.tps</a>  </tt>
	<dd> Total Internal Partition Sum data (required if
		<a href=#tpsflg>TPS Flag</a> enabled)

	<dt> <tt><a href=#xscfil>.xsc</a>  </tt>
	<dd> Cross-Section data (required for any `cross-section' molecules)
	</dl>
In the case of the optional files, the user may either supply the name of
a file
containing the necessary information, or enter the information explicitly in
the appropriate section of the Driver Table. The file option may be useful, for
example, for entering pre-defined microwindows, lists of absorbing species, or
sequences of tangent heights corresponding to fixed scan patterns, whereas the
direct Driver Table entry is more convenient for setting up simple runs.

<h3>Notes </h3>

For RFM-specific input files (i.e. excluding the <tt>.grd</tt>, <TT>.hit</TT>, 
<tt>.lut</tt> and  <tt>.xsc</tt> files) the following principles apply:
<ol>
<li>Files are ASCII, with maximum record lengths of 80 characters (anything
    beyond column 80 is ignored)
<li>Files may start with an arbitrary number of comment records, indicated by
    the first printable character being an exclamation mark `!'
<li>The first record of each file is copied to the <tt>.runlog</tt> file
    (<a href=#runlog>section 8</a>) so should contain a comment giving 
    some meaningful identification of the file contents and version.
<li>All text (apart from text used to form filenames)
is case-insensitive - everything is converted to lower case within
    the RFM.
<li>Character fields may be delimited by spaces, tabs, commas or single quotes.
<li>Numerical fields are read free-format, so may be delimited by spaces or
    commas.
</ol>
<hr>
<a name=fo>
<h2>5. OUTPUT FILES </h2>

Running the RFM will always create a file
<a href=#runlog><tt>rfm.runlog</tt></a> (plus
any <tt>run_ID</tt> extension to the filename) - see 
<a href=#runlog>Section 8</a>. 
This contains diagnostic information on the
progress of the particular run of the RFM, eg listing section of the Driver
Table being read, names of files which are about to be opened, warning messages.
<p>
Other output files depend on the Driver Table, and detailed formats are given
in <a href=#formats</a>Appendix C</a>.
The main purpose of the RFM is to generate spectra: these can be 
<a href=#radfil>radiance</a>, <a href=#trafil>transmission</a>, 
<a href=#absfil>absorption</a> or <a href=#optfil>optical depth</a> spectra, 
written either as ASCII or Binary files. 
Additional diagnostic information (ASCII files only) can be produced
for the <a href=#prffil>internal profile</a>,
<a href=#pthfil>ray-tracing</a> and <a href=#widfil>line-by-line</a>
calculations. Selection of these
output files is controlled by the appropriate Flag in the Driver Table.
<p>
<dl>
	<dt> <tt><a href=#absfil>.abs</a>  </tt>
	<dd> Absorption (=1-transmission) Spectrum 
		(<a href=#absflg>ABS</a> Flag Enabled)
	<dd> Separate file for each tangent height/spectral range combination

	<dt> <tt><a href=#bbtfil>.bbt</a>  </tt>
	<dd> Brightness Temperature [K] Spectrum 
		(<a href=#bbtflg>BBT</a> Flag Enabled)
	<dd> Separate file for each atmospheric level/spectral range combination

	<dt> <tt><a href=#coofil>.coo</a>  </tt>
	<dd> Cooling Rate [K/day/cm-1] Spectrum 
		(<a href=#cooflg>COO</a> Flag Enabled)
	<dd> Separate file for each atmospheric level/spectral range combination

	<dt> <tt><a href=#optfil>.opt</a>  </tt>
	<dd> Optical Depth (=-ln(transmission)) Spectrum 
	     	(<a href=#optflg>OPT</a> Flag Enabled)
	<dd> Separate file for each tangent height/spectral range combination

	<dt> <tt><a href=#pthfil>.pth</a>  </tt>
	<dd> Path Diagnostics 
	     	(<a href=#pthflg>PTH</a> Flag Enabled)
	<dd> Separate file for each tangent height

	<dt> <tt><a href=#prffil>.prf</a>  </tt>
	<dd> Internal Profile
	     	(<a href=#prfflg>PRF</a> Flag Enabled)
	<dd> Separate file for each LOS angle (if using <a href=#graflg>GRA</a> flag)

	<dt> <tt><a href=#radfil>.rad</a>  </tt>
	<dd> Radiance [nW/(cm2.st.(cm-1))] Spectrum 
	     	(<a href=#radflg>RAD</a> Flag Enabled) or
             Radiance Flux [W/m2.(cm-1)] Spectrum (<a href=#flxflg>FLX</a> Flag
	also enabled)
	<dd> Separate file for each tangent height/spectral range combination

	<dt> <tt><a href=#tabfil>.tab</a>  </tt>
	<dd> Absorption Coefficient [m^2/mole] table.
	     	(<a href=#tabflg>TAB</a> Flag Enabled)
	<dd> Separate file for each gas/spectral range combination

	<dt> <tt><a href=#trafil>.tra</a>  </tt>
	<dd> Transmission Spectrum 
	     	(<a href=#traflg>TRA</a> Flag Enabled)
	<dd> Separate file for each tangent height/spectral range combination

	<dt> <tt><a href=#widil>.wid</a>  </tt>
	<dd> Widemesh Diagnostics 
	     	(<a href=#widflg>WID</a> Flag Enabled)
	<dd> Separate file for each absorber/spectral range combination, plus 
	    a total absorber file (if more than one absorber) for each spectral
            range.
</DL>
<P>
By default, output spectra and abs.coeff tables
are written as ASCII files, but this can be altered
to sequential binary files by enabling the <a href=#binflg>BIN</a> Flag.
<a href=#spectra>Appendix D</a> describes the general format for both ASCII
and Binary output spectra.
<p>
The RFM has default filename templates for each class of output file, which
will create the files in the user's directory. 
These may be modified by the user via the optional sections of the Driver
Table (<a href=#driver>section 6</a>)
eg to switch the output to a different directory. 
If multiple files are created, it is necessary for the template to contain
a wildcard character `<tt>*</tt>' which will be expanded to provide a unique 
spectral_range/gas/tangent_height identifier.
For example, if the user specifies output filenames for transmission files
by adding a section to the Driver Table:
<blockquote>
<pre>
*TRA
      ./out/rfm_*.tra
</pre>
</blockquote>
Then, for tangent heights 20, 25 km and spectral ranges labelled `A' and `B',
4 files will be created with filenames:
<pre>
	rfm_a20000.tra
	rfm_a25000.tra
	rfm_b20000.tra
	rfm_b25000.tra
</pre>
<p>
The default option is to open any file with a FORTRAN OPEN statement using
<tt>STATUS='UNKNOWN'</TT>, meaning that any existing file with the same
name will be overwritten.
This can be changed to <TT>STATUS='NEW'</tt> if the <A href=#newflg>NEW</a>
Flag is enabled, in which case a fatal error condition results if any
files with the same name already exist.
<hr>
<a name=driver>
<h2>6. DRIVER TABLE </h2>

The RFM is controlled by a Driver Table, an ASCII file opened as 
`<tt>rfm.drv</tt>', 
which is intended to be created/modified with a text editor.
If the file is not found in the
user's current directory a fatal error results.
<p>
The file is divided into sections,
marked by records starting with <tt>*XXX</tt>, where <tt>XXX</tt> is one of 
a set of section markers.
<p>
Sections are divided into 3 classes: Primary, Secondary and Optional.
<p>
<dl> 
<dt><b>Primary Sections</b>
<dd> The first 6 sections of the Driver Table are mandatory, and must appear
in the following sequence:
	<dl> 
	<dt> <tt><a href=#hdr>*HDR</a></tt> 
	<dd> Header Text for output files
	<dt> <tt><a href=#flg>*FLG</a></tt> 
	<dd> Flags (listed in <a href=#flags>Appendix B</a>)
	<dt> <tt><a href=#spc>*SPC</a></tt> 
	<dd> Spectral Range & Resolution
	<dt> <tt><a href=#gas>*GAS</a></tt> 
	<dd> List of Absorbers
	<dt> <tt><a href=#atm>*ATM</a></tt> 
	<dd> Atmospheric Profiles 
	<dt> <tt><a href=#tan>*TAN</a></tt> (alternatives: *DIM,
*GEO, *ELE, *LEN, *LEV or *SEC for specific contexts)
	<dd> Tangent Heights (or other ray-path definitions)
	</dl> 
<dt><b>Secondary Sections</b>
<dd> The requirement for the following sections depends on the contents of
     the primary sections (especially the <a href=#flg><tt>*FLG</tt></a> 
	section).
     These may be input in any order after the primary sections. If not required
     the section will be ignored, but a warning message will be printed in the
     <tt><a href=#runlog>.runlog</a></tt> file.
	<dl> 

	<dt> <tt><a href=#crv>*CRV</a>  </tt> 
	<dd> Earth's Local Radius of Curvature
(required if <A href=#crvflg>CRV</a> flag is enabled)

	<dt> <tt><a href=#fin>*FIN</a>  </tt> 
	<dd> Spectral Resolution of Fine Mesh calculation 
	prior to ILS Convolution file
(required if <A href=#finflg>FIN</a> flag is enabled)

	<dt> <tt><a href=#fov>*FOV</a>  </tt> 
	<dd> Field-of-View Data filename
(required if <A href=#fovflg>FOV</a> flag is enabled)

	<dt> <tt><a href=#grd>*GRD</a>  </tt> 
	<dd> Irregular Grid filename(s)
(required if <A href=#grdflg>GRD</a> flag is enabled)

	<dt> <tt><a href=#hit>*HIT</a>  </tt> 
	<dd> HITRAN Line Data filename(s)
(required if any `line' molecules selected)

	<dt> <tt><a href=#ils>*ILS</a>  </tt> 
	<dd> Instrument Line Shape filename(s)
(required if <A href=#ilsflg>ILS</a> flag is enabled)

	<dt> <tt><a href=#jac>*JAC</a>  </tt> 
	<dd> Jacobian calculation elements (s)
(required if <A href=#jacflg>JAC</a> flag is enabled)

	<dt> <tt><a href=#lev>*LEV</a>  </tt> 
	<dd> Intermediate Output Levels
(required if <A href=#levflg>LEV</a> flag is enabled)

	<dt> <tt><a href=#lut>*LUT</a>  </tt> 
	<dd> Look-Up Table filename(s)
(required if <A href=#lutflg>LUT</a> flag is enabled)

	<dt> <tt><a href=#nte>*NTE</a>  </tt> 
	<dd> Non-LTE Data filename(s)
(required if <A href=#nteflg>NTE</a> flag is enabled)

	<dt> <tt><a href=#obs>*OBS</a>  </tt> 
	<dd> Observer Altitude 
(required if <A href=#obsflg>OBS</a> flag is enabled)

	<dt> <tt><a href=#rej>*REJ</a>  </tt> 
	<dd> Line Rejection limits 
(required if <A href=#rejflg>REJ</a> flag is enabled)

	<dt> <tt><a href=#sfc>*SFC</a>  </tt> 
	<dd> Surface Parameters 
(required if <A href=#sfcflg>SFC</a> flag is enabled)

	<dt> <tt><a href=#shp>*SHP</a>  </tt> 
	<dd> Molecular Lineshapes (ie non-Voigt)
(required if <A href=#shpflg>SHP</a> flag is enabled)

	<dt> <tt><a href=#tps>*TPS</a>  </tt> 
	<dd> Total Internal Partition Sum data filenames
(required if <A href=#tpsflg>TPS</a> flag is enabled)

	<dt> <tt><a href=#xsc>*XSC</a>  </tt> 
	<dd> Molecular Cross-Section Data filename(s)
(required if any `cross-section' molecules selected)
	</dl> 
<dt><b>Optional Sections</b>
<dd> The following sections are optional and can appear in any order after
     the primary sections. These override the default output filenames so
     are only effective if the particular output option has been selected,
     otherwise the section is ignored and a warning message printed in the
     <tt><a href=#runlog>.runlog</a></tt> file.
	<dl>
	<dt> <tt><a href=#abs>*ABS</a>  </tt> 
	<dd> Absorption Spectrum filename
(Effective if <A href=#absflg>ABS</a> flag enabled)
	<dt> <tt><a href=#bbt>*BBT</a>  </tt> 
	<dd> Brightness Temperature Spectrum filename
(Effective if <A href=#bbtflg>BBT</a> flag enabled)
	<dt> <tt><a href=#coo>*COO</a>  </tt> 
	<dd> Cooling Rate  Spectrum filename
(Effective if <A href=#cooflg>COO</a> flag enabled)
	<dt> <tt><a href=#opt>*OPT</a>  </tt> 
	<dd> Optical Depth Spectrum filename
(Effective if <A href=#optflg>OPT</a> flag enabled)
	<dt> <tt><a href=#prf>*PRF</a>  </tt> 
	<dd> Internal Profile filename
(Effective if <A href=#prfflg>PRF</a> flag enabled)
	<dt> <tt><a href=#pth>*PTH</a>  </tt> 
	<dd> Path Diagnostics filename
(Effective if <A href=#pthflg>PTH</a> flag enabled)
	<dt> <tt><a href=#rad>*RAD</a>  </tt> 
	<dd> Radiance Spectrum filename
(Effective if <A href=#radflg>RAD</a> flag enabled)
	<dt> <tt><a href=#tab>*TAB</a>  </tt> 
	<dd> Absorption Coefficient table filename
(Effective if <A href=#tabflg>TAB</a> flag enabled)
	<dt> <tt><a href=#tra>*TRA</a>  </tt> 
	<dd> Transmission Spectrum filename
(Effective if <A href=#traflg>TRA</a> flag enabled)
	<dt> <tt><a href=#wid>*WID</a>  </tt> 
	<dd> Widemesh Diagnostics filename
(Effective if <A href=#widflg>WID</a> flag enabled)
	</DL>
<dt><b>End-of-File marker</b>
<dd> The Driver File is terminated with a special record.
     This is also printed in the 
	<tt><a href=#runlog>.runlog</a></tt> to indicate that the 
     entire Driver Table was successfully processed.
	<dl>
<a name=end>
	<dt><tt><a href=#end>*END</a></tt>
	</dl>
<dt><b>Notes</b>
<ol>
<li>Secondary and Optional sections appearing in the Driver Table are redundant
unless the appropriate flag is enabled (or, in the case of the 
<a href=#hit><tt>*HIT</tt></a> and <a href=#xsc><tt>*XSC</tt></a> sections, 
appropriate species
selected). If a section is not used, a warning message appears in the 
<tt><a href=#runlog>.runlog</a></tt> file and the section skipped.

<li>
Any remaining text (column 5 and beyond) in these section header
records is ignored but the entire section header records are printed to the 
<tt>.runlog</tt> file.

<li>
Comments may appear at any point within the Driver File, indicated by an
exclamation mark `<tt>!</tt>'. Since any text on the record following an
exclamation mark is ignored, these can also be used to comment out ends of
records.
Empty records are also permitted.

<li> Most sections are field-structured, ie contain
one or more fields in arbitrary order spread over as many records as required.
Some sections are record-structured, in which case the type and sequence of
fields within a record is fixed.
</ul>

<dt><b>Example</b>
<dd><pre>
! 25-AUG-96 Example Driver Table
*HDR
RFM run using Driver Table v.25-AUG-96
*FLG
      ILS RAD FOV        ! Create ILS & FOV-convolved RADiance spectra
*SPC
      700.5 702.8 0.025  ! Output range 700.5-702.8 cm-1 on 0.025 cm-1 grid
*GAS 
      CO2 H2O 
*ATM
      std.atm            ! US Std Atmosphere
*TAN
      20 30 40           ! 20,30,40 km tangent heights
*HIT
      hitran_1996.bin    ! HITRAN 96 line data
*ILS
      mipas_a.ils        ! MIPAS A Band Instrument Line Shape
*FOV
      mipas7.fov         ! MIPAS 7-pt Field-of-view tabulation
*END
</pre>
</DL>
<hr>
<a name=error>
<h2> 7. ERROR HANDLING </h2>

The RFM should trap all error conditions and terminate with an error message
of the form
<pre>
F-ABCDEF: .... 
</pre>
where <tt>ABCDEF</tt> is the FORTRAN module in which the error occurred.
These messages are printed to the terminal and, where possible, the
<a href=#runlog><tt>.runlog</tt></a> file (ie unless writing to the 
runlog file itself caused the error).
<p>
Generally, these errors will be for one of 3 reasons:
<dl>
<dt>I/O Errors on input/output files
<dd> in which case the (machine dependent) 
     <tt>IOSTAT</tt> value will also be printed (this is the integer status
     variable associated with FORTRAN I/O operations).     
<dt> Driver Table errors
<dd> due to incorrectly formatted Driver Table. These often (but not always) 
     begin with 
     <TT>F-INPXXX</TT> where <tt>XXX</tt> is the name of the Driver Table 
     section. The best way to detect these is to examine the 
     <a href=#runlog><tt>.runlog</tt></a> file and find the last section read. 
<dt> Array size errors
<dd> where the available array space is insufficient for the
     task. The appropriate parameter, with a name beginning 
     <TT>MAX...</TT> can usually be found in the include file 
     <tt>rfmsiz.inc</tt> (see <a href=#memory>Section 10</a>). 
      Once adjusted, the code needs to be recompiled.
</dl>
Most of these failures will occur before the Wide Mesh Calculation starts.
The most likely exception is running out of diskspace, which may result in an 
I/O error at any point.
<p>
A common problem encountered when first using the RFM is with reading the 
HITRAN binary file. This is usually because the RECLEN parameter is either
incorrectly set for the RFM, or was incorrectly set for 
<A HREF=rfm_downloads.html#hitbin>HITBIN</a> when generating
the binary file. 
<p>
With Linux, a common source of error when reading ASCII files is due to
unreadable linefeed or carriage-return characters. These give IOSTAT=112 
using the gnu "g77" compiler, or IOSTAT=173 using the Fujitsu "f95" compiler
(see under <a href=#linux>Linux Modifications</a>).
These characters can be removed using
<PRE>
       perl -pe "s/\r//" infile.asc > outfile.asc
</PRE>
Note that it is also possible that the program terminates with an error
message printed to the terminal of the form:
<PRE>
F-ABCDEF: Logical Error
</pre>
These are logic checks within the code, eg checking for running off the end 
of a DO loop when it isn't supposed to happen. If you get one of those
it means that there's a bug in the code, so please inform me (email: 
<a href=mailto:dudhia@atm.ox.ac.uk>dudhia@atm.ox.ac.uk</a>) 
<hr>
<a name=runlog>
<h2> 8. RUNLOG FILE </h2>
Every run of the RFM will create a <tt>.runlog</tt> file with the filename
`<tt>rfm.runlog</tt>' (+ any specified <a href=#runid><tt>run_ID</tt></a>).
This file logs all details of the particular run.
<p>
The file contains 3 types of record:
<dl>
<dt> <b>Status Messages</b>
	<dl>
	<dt> <tt>R-RFM:    ... </tt> 
	<dd> General status (also printed to terminal)
	<dt> <tt>I-ABCDEF: ... </tt> 
	<dd> Info from subroutine <tt>ABCDEF</tt>
	<dt> <tt>W-ABCDEF: ... </tt> 
	<dd> Warning from subroutine <tt>ABCDEF</tt>
	<dt> <tt>F-ABCDEF: ... </tt> 
	<dd> Fatal Error in subroutine  <tt>ABCDEF</tt> (also printed to 
		terminal)
	</dl>
<dt> <b>File Header Records</b>
<dd> <tt> ! ...    </tt> First record of each input file opened
<dt> <b>Section Header Records</b>
<dd> <tt> *XXX ... </tt> Driver Table Sections (eg. <tt>*HDR</tt>)
or atmospheric profile identifiers (eg. <tt>*HGT</tt>) loaded in the 
<a href=#atm><tt>*ATM</tt></a> section. 
Atmospheric profile identifiers 
are  indented to distinguish them from Driver Table sections.

<dt><b>Example</b>
<dd>A run with the Driver Table listed in <a href=#driver>section 6</a> would 
generate a <tt>.runlog</tt> file: 
<pre>
R-RFM:    Program RFM v4.00
I-OPNFIL: Opening file: rfm.drv
  ! 25-AUG-96 Example Driver Table
*HDR                
    RFM run using Driver Table v.25-AUG-96
*FLG
I-INPFLG: Enabled flags: fov ils rad
</pre>
...etc
</dl>
<hr>
<a name=speed>
<h2> 9. NUMERICAL OPTIMISATIONS </h2>

The principle calculation unit is a `path', 
defined as the segment of a tangent ray bounded by an atmospheric
profile layer for a single gas. For example, if an atmosphere is defined
at 0, 10, 20 .... 60 km, and a single CO2 radiance spectrum from tangent height
35 km is required, there will be 3 paths corresponding to the altitudes 35-40,
40-50 and 50-60 km. If H2O is added, this will double the number of paths to 6.
If a FOV convolution is required the number of paths is again increased by
a factor corresponding to the number of tangent rays required to specify the 
FOV.
<p>
If processing speed rather than accuracy is a requirement, several optimisations
are available which either reduce the number of calculated paths, or speed up
the spectral calculation for each path.
<dl>
<dt> <a href=#finflg>FIN</A> Flag 
<dd> If an ILS convolution is required (set by the <A href=#ilsflg>ILS</a> Flag)
     the
     default is to perform the calculation at 2000 pts/cm-1, which is adequate
     to resolve lines at all altitudes. 
	If only broad lines are required (ie low altitude
     tangent points, say below 30 km) the user can specify a coarser resolution
     to speed up the calculation. A warning message is printed in the 
	<a href=#runlog><tt>.runlog</tt></a> file
     if the user-specified resolution seems too coarse.
<dt> <a href=#grdflg>GRD</a> Flag
<dd> The user can supply irregular grids (<tt><A HREF=#grdfil>.grd</a></tt>
	files) to specify the spectral points at 
     which the lineshapes, absorption coefficients, radiative transfer etc
     are calculated instead of using every point on the regular fine grid.
     The path radiances, absorptions and transmissions are then interpolated 
     to the regular grid before output (also prior to any ILS convolution).
<dt> <a href=#lutflg>LUT</a> Flag
<dd> The user can supply Look-Up Tables 
     (<tt><a href=#lutfil>.lut</a></tt> files)
     to supply pretabulated absorption coefficients for specific absorbers and
     spectral ranges, instead of using a line-by-line calculation.
<dt> <a href=#rejflg>REJ</a>  Flag
<dd> Sets lower limits on the path-adjusted strength of lines which are
     included in the spectral calculation.
     Different criteria will be appropriate for different spectral regions and
     tangent heights so it is advisable to compare results with and without
     this option for specific cases.
<dt> <a href=#wngflg>WNG</a>  Flag
<dd> Excludes all line wings beyond 200 line-widths
     where this is narrower than the normal fine-mesh calculation limit of 
     1-2 cm-1. This reduces the number of line-shape calcuations for weak
     lines or high altitudes.
<dt> <a href=#fovfil><tt>.fov</tt></a> File
<dd> The details of the FOV tabulation 
     critically affect the number of calculated paths. For single tangent 
     heights, the number of paths will be proportional to the number of points 
     required
     to specify the FOV. For multiple, regularly-spaced tangent heights, 
     efficiency can be gained by using a FOV tabulation on the same spacing
     as the tangent heights which allows individual tangent paths to be reused.
     For example, the MIPAS trapezium-shape response (0,1,1,1,0) at 
     relative altitude coordinates (-2,-1.4,0,+1.4,+2) can be replaced by an 
     `equivalent' shape (0,y,1,y,0) where y=0.2798 for (-3,-1.5,0,+1.5,+3),
     or y=0.2302 for (-2,-1,0,+1,+2). For the 1.5km FOV spacing, 
     a series of n limb views at 3 km increments will 
     require 2n+3 tangent paths instead of 5n. 
<dt> <a href=#atmfil><tt>.atm</tt></a> File
<dd> The number of paths is also determined
     by the height and resolution of the atmospheric profile, i.e. the 
     altitude grid specified in the first file named in the 
     <a href=#atm><tt>*ATM</tt></a> section of  the Driver Table. It is generally
     adequate to set an upper limit of 25km above the highest limb tangent
     point required, and to increase the profile spacing in the
     upper levels. Rather than reformat the standard atmosphere files,
     the suggested method is to prepare a single height profile in
     the <a href=#atmfil><tt>.atm</tt></a> format which contains the required subset of
     the US Std atmosphere altitudes and insert this as the first file in the
     <tt>*ATM</tt> section.
</dl>
<hr>
<a name=size>
<h2> 10. MEMORY SIZE </h2>

The RFM checks all required calculations against available array space and,
if insufficient, returns an error message (<a href=#errors>Section 7</a>)
indicating the limiting parameter.
Most of these parameters determining RFM array sizes are contained in the
include file <tt>rfmsiz.inc</tt>, and can be increased as required without
significantly affecting the total RAM space requirements.
However the following common arrays constitute most of the RFM memory space and 
increasing their dimensions may create problems:
<dl>
<dt>(in file <tt>fincom.inc</tt>)
<dd><tt>REAL ABSFIN(MAXFIN,MAXCLC) ! Fine mesh absorption</tt>
<dd><tt>REAL CNTFIN(MAXFIN,MAXCLC) ! Fine mesh path non-LTE factor</tt>
<dt>(in file <tt>widcom.inc</tt>)
<dd><tt>REAL ABSWID(3,MAXWID,MAXCLC) ! Widepass abs. by parabolic point</tt>
<dd><tt>REAL CNTWID(3,MAXWID,MAXCLC) ! Widepass nonlte factor by parab.pt.</tt>
</pre>
The dimension 3 relates to storing parameters for quadratic 
interpolation and cannot be altered, but the 
other dimensions are defined: (initial values shown in brackets)
<dt><tt>MAXCLC</TT> (1260). 
<dd>Maximum number of calculated paths (see <a href=#speed>Section 9</a>).
<dt><tt>MAXWID</tt> (652). 
<dd> Maximum number of widemesh intervals. Since each
        interval is 1 cm-1 wide,  this has to be changed to 1902 if spectra
        are required over the entire 600-2500 cm-1 range 
        (with margins for the ILS convolution). 
	This may be reduced if smaller ranges are required.
<dt><tt>MAXFIN</TT> (2100). 
<dd> Maximum number of finemesh grid points per widemesh
        interval. This may be reduced if fine mesh calculations are required
        at resolutions less than 2000 pts/cm-1 (with an ILS
        convolution, the fine mesh calculation would normally be performed at
        a finer resolution than the output grid).
</dl>
<p>
These values of <TT>MAXWID</TT> and 
<tt>MAXFIN</tt> are unlikely to be exceeded for normal 
calculations, but it is quite possible that the <tt>MAXCLC</tt>
 dimension can prove
too small, which results in a fatal error message, e.g.
<pre>
F-TANPTH: No.paths for line-by-line calc=       1625 >MAXCLC in RFMSIZ=   1260
</pre>
In this case, the following measures are suggested (in order of preference)
<ol>
<li> Increase the size of MAXCLC and recompile the code, provided that this does
     not exceed the RAM limit of the machine (it is actually recommended that 
    the value of <tt>MAXCLC</tt> be set to the maximum size that the machine 
     can handle)
<li> Redefine the calculation to reduce the number of calculated paths
     by altering either the 
     <a href=#fovfil><tt>.fov</tt></a> or <a href=#atmfil><tt>.atm</tt></a> 
     file spacing (all
     described in <a href=#speed>Section 9</a>), or reduce number of tangent
     points required in a single run.
<li> Increase <tt>MAXCLC</tt> while reducing <tt>MAXWID</tt> and/or 
	<tt>MAXFIN</tt> to maintain total RAM space, subject to caveats 
     listed previously.
</ol>
<hr>
<a name=linux>
<h2> 11. LINUX MODIFICATIONS </h2>
Under Linux, the parameter <tt>RECLEN=88</tt> should be set in
<tt>reclen.inc</tt> (for Alpha machines RECLEN=22 is required).
<p>
To compile using gnu
<pre>
          g77 *.for -o rfm
</pre>
<b>WARNING</b> the RFM has been developed using compilers which assume
subroutine variables are SAVEd between calls. The g77 compiler is different
in that variables are volatile, so it is recommended that you use the 
following switch to verify results
(this forces all subroutine variables to be SAVEd 
at the expense of a slower executable)
<pre>
         g77 -fno-automatic *.for -o rfm
</pre>
Please inform me ( <a href=mailto:dudhia@atm.ox.ac.uk>dudhia@atm.ox.ac.uk</a> )
if you find any discrepancies (see <a href=rfm_bugs.html#bug29>RFM Bugs#28,29</a>).
See <a href="http://gcc.gnu.org/onlinedocs/gcc-3.1.1/g77/Code-Gen-Options.html#Code%20Gen%20Options">Gnu Online
Documentation</a> for details.

<p>
If you have it, the Fujitsu f95 compiler seems more efficient but is slightly
more complicated to use. You may need something like:
<pre>
         /usr/local/PACK/FFC/bin/f95 -fw -Xf7 *.for -o rfm_f95
</pre>
(NB you may also need 
<tt> setenv  LD_LIBRARY_PATH /usr/local/PACK/FFC/lib </tt>
beforehand for this compiler.

<hr>
<h2> 13. APPENDICES </h2>
<hr>
<a name=sections>
<h2> APPENDIX A: DRIVER TABLE SECTIONS </h2>
<ul>
<li> Primary Sections (in this order)
	<ul> 
	<li><a href=#hdr><tt> *HDR</tt> </a> Header Text for output files
	<li><a href=#flg><tt>  *FLG</tt> </a> Flags
	<li><a href=#spc><tt>  *SPC</tt> </a> Spectral Ranges & Resolutions
	<li><a href=#gas><tt>  *GAS</tt> </a> List of absorbers
	<li><a href=#atm><tt>  *ATM</tt> </a> Atmospheric Profiles
	<li><a href=#tan><tt>  *TAN</tt> </a> Tangent Heights (or other
	ray-path definitions *DIM, *ELE, *GEO, *LEN, *LEV or *SEC)
	</ul>
<li> Secondary Sections (follow primary sections, in any order)
	<ul> 
	<li><a href=#crv><tt>  *CRV</tt> </a> Radius of Curvature 
	<li><a href=#fin><tt>  *FIN</tt> </a> Fine Mesh resolution
	<li><a href=#fov><tt>  *FOV</tt> </a> Field-of-View Data file 
	<li><a href=#grd><tt>  *GRD</tt> </a> Irregular Grid file(s)
	<li><a href=#hit><tt>  *HIT</tt> </a> HITRAN Line Data file(s)
	<li><a href=#ils><tt>  *ILS</tt> </a> Instrument Line Shape file(s)
	<li><a href=#jac><tt>  *JAC</tt> </a> Jacobian Calculation elements
	<li><a href=#lev><tt>  *LEV</tt> </a> Intermediate output levels
	<li><a href=#lut><tt>  *LUT</tt> </a> Look-Up Table file(s)
	<li><a href=#nte><tt>  *NTE</tt> </a> Non-LTE Data file(s)
	<li><a href=#obs><tt>  *OBS</tt> </a> Observer Altitude 
	<li><a href=#rej><tt>  *REJ</tt> </a> Line Rejection limits
	<li><a href=#sfc><tt>  *SFC</tt> </a> Surface Parameters 
	<li><a href=#shp><tt>  *SHP</tt> </a> Molecular Lineshape(s)
	<li><a href=#tps><tt>  *TPS</tt> </a> Total Internal Partition Sums
	<li><a href=#xsc><tt>  *XSC</tt> </a> Molecular Cross-Section file(s)
	</ul>
<li> Optional Sections (follow primary sections, in any order)
	<ul>
	<li><a href=#abs><tt>  *ABS</tt> </a> Absorption Spectrum filename 
	<li><a href=#bbt><tt>  *BBT</tt> </a> Brightness Temperature Spectrum filename 
	<li><a href=#coo><tt>  *COO</tt> </a> Cooling Rate filename 
	<li><a href=#opt><tt>  *OPT</tt> </a> Optical Depth Spectrum filename
	<li><a href=#prf><tt>  *PRF</tt> </a> Internal Profile filename
	<li><a href=#pth><tt>  *PTH</tt> </a> Path Diagnostics filename
	<li><a href=#rad><tt>  *RAD</tt> </a> Radiance Spectrum filename
	<LI><a href=#tab><tt>  *TAB</tt> </a> Tabulated Absorption Coefficient filename
	<LI><a href=#tra><tt>  *TRA</tt> </a> Transmission Spectrum filename
	<LI><a href=#wid><tt>  *WID</tt> </a> Widemesh Diagnostics filename 
	</ul>
<li> End-of-File Marker
	<ul>
	<li><tt>*END</tt>  Last Record of Driver File
	</ul>
</UL>
<hr>
<a name=hdr>
<h3> *HDR SECTION: Header text for output files </h3>

<dl>
<dt><b>Type</b>
<dd>Primary Section

<dt><b>Description</b>
<dd> Text inserted into the header (as 2nd record)
of all output files generated from this version of the Driver Table.

<dt><b>Format</b>
<dd>Single record.

<dt><b>Record</b>
	<DL>
	<dT><tt>HDRREC</tt> 
	<DD> Up to 79 characters of text, including spaces, reproduced 
             literally (up to and excluding any `<tt>!</tt>' and subsequent 
	      text)
	</dl>

<dt><b>Notes</b>
<ol>
<li>The restriction to 79 characters is because an exclamation mark is inserted
    at the start of the header in the output files.
</ol>

<dt><b>Example</b><br>
<dd><pre>
*HDR
26-JUN-96 Full range full resolution 40km timing run
</pre>
<dt><b>Bugs</b><br>
<dd><a href=rfm_bugs.html#bug46>Bug#46</a>
</dl>
<hr>
<a name=flg>
<h3> *FLG SECTION: Flags </h3>

<dl>
<dt><b>Type</b>
<dd> Primary Section


<dt><b>Description</b>
<dd> List of enabled switches for the RFM.
<dd> Absence of any flag = switch disabled.

<dt><b>Format</b>
<dd> Multiple fields, arbitrary order.

<dt><b>Fields</b>
<DD> Single type
	<dl>
	<dt><tt>FLAG</tt> (Character)
	<dd> A C*3 string. Allowed values 
	(see <a href=#flags>Appendix B</a> for full descriptions):
<dl>
<dt><b>Output Selection:</b>
<dd> <a href=#absflg><tt>ABS</tt></a> - Write Absorption spectra
<dd> <a href=#binflg><tt>BIN</tt></a> - Write output spectra as binary files
<dd> <a href=#bbtflg><tt>BBT</tt></a> - Write Brightness Temperature spectra
<dd> <a href=#cooflg><tt>COO</tt></a> - Write Cooling Rate spectra
<dd> <a href=#dblflg><tt>DBL</tt></a> - Write spectra with Double Precision 
<dd> <a href=#ghzflg><tt>GHZ</tt></a> - Spectral units GHz rather than cm-1.
<dd> <A href=#jacflg><tt>JAC</tt></a> - Write Jacobian spectra
<dd> <A href=#levflg><tt>LEV</tt></a> - Intermediate outputs at specified levels
<dd> <A href=#losflg><tt>LOS</tt></a> - Write Pointing Jacobian spectra
<dd> <A href=#lunflg><tt>LUN</tt></a> - Re-use Logical Unit Numbers
for output spectra
<dd> <A href=#newflg><tt>NEW</tt></a> - Open output files as `NEW'
<dd> <A href=#optflg><tt>OPT</tt></a> - Write Optical Depth spectra
<dd> <A href=#prfflg><tt>PRF</tt></a> - Write out internal profile
<dd> <A href=#pthflg><tt>PTH</tt></a> - Write Ray Path diagnostics
<dd> <a href=#radflg><tt>RAD</tt></a> - Write Radiance spectra
<dd> <a href=#tabflg><tt>TAB</tt></a> - Write tabulated absorption coefficients
<dd> <a href=#traflg><tt>TRA</tt></a> - Write Transmission spectra
<dd> <a href=#widflg><tt>WID</tt></a> - Write Widemesh diagnostics

<dt><b>Special Physics:</b>
<dd> <a href=#ctmflg><tt>CTM</tt></a> - Include Continuum absorption
<dd> <a href=#mixflg><tt>MIX</tt></a> - Include Line-mixing
<dd> <a href=#mtxflg><tt>MTX</tt></a> - Matrix output (with Flux calculations)
<dd> <a href=#nteflg><tt>NTE</tt></a> - Use non-LTE calculations
<dd> <a href=#qadflg><tt>QAD</tt></a> - Quadratic fit for line wings
<dd> <a href=#shpflg><tt>SHP</tt></a> - Use non-Voigt line shapes
<dd> <a href=#vvwflg><tt>VVW</tt></a> - Apply VVW correction to line shapes

<dt><b>Convolutions:</b>
<dd> <A href=#avgflg><tt>AVG</tt></a> - Spectrally averaged output
<dd> <A href=#fovflg><tt>FOV</tt></a> - Convolve with field-of-view
<dd> <A href=#fvzflg><tt>FVZ</tt></a> - Treat FOV function as representing
<i>refracted</I> altitudes rather than <i>projected</i> altitudes 
<dd> <A href=#ilsflg><tt>ILS</tt></a> - Convolve with instrument line-shape

<dt><b>Approximations:</b>
<dd> <a href=#clcflg><tt>CLC</tt></a> - Use specific absorption coefficients
for all path segments 
<dd> <a href=#finflg><tt>FIN</tt></a> - User-specified fine mesh resolution 
<dd> <a href=#grdflg><tt>GRD</tt></a> - Use Irregular Grid for calculations
<dd> <a href=#lutflg><tt>LUT</tt></a> - Use Look-Up Tables for Absorption Coefficients
<dd> <a href=#rejflg><tt>REJ</tt></a> - Implement line rejection
<dd> <A href=#tpsflg><tt>TPS</tt></a> - Use tabulated TIPS functions
<dd> <A href=#wngflg><tt>WNG</tt></a> - Use far-wing cut off for lines

<dt><b>Ray Paths:</b>
<dd> <a href=#bfxflg><tt>BFX</tt></a> - Use Planck v. optical depth in layers 
<dd> <a href=#crvflg><tt>CRV</tt></a> - User-specified Local Radius of Curvature 
<dd> <a href=#flxflg><tt>FLX</tt></a> - Flux-type calculations (over solid
angle)  
<dd> <a href=#geoflg><tt>GEO</tt></a> - Use geometric (cf.refracted) ray paths
<dd> <a href=#graflg><tt>GRA</tt></a> - Assume horizontal gradients (2D atmosphere)
<dd> <a href=#homflg><tt>HOM</tt></a> - Perform Homogeneous path calculation
<dd> <a href=#layflg><tt>LAY</tt></a> - Perform sub-layering of profiles
<dd> <a href=#linflg><tt>LIN</tt></a> - Assume VMR varies linearly with
altitude 
<dd> <A href=#nadflg><tt>NAD</tt></a> - Use Nadir-viewing ray paths
<dd> <A href=#obsflg><tt>OBS</tt></a> - Observer within atmosphere
<dd> <A href=#sfcflg><tt>SFC</tt></a> - Specify surface characteristics
<dd> <A href=#vrtflg><tt>VRT</tt></a> - Flux-type calculations without solid-angle
integration 
<dd> <A href=#zenflg><tt>ZEN</tt></a> - Use Zenith-viewing ray paths
</dl>
</dl>
<dt><b>Notes</b>
<ol><li> Certain combinations are not valid and will result in a fatal error
         message. These are listed under descriptions of each flag given
         in <a href=#flags>Appendix B</a>.
</ol>
<p>
<dt><b>Example</b>
<DD><pre>
*FLG 
      FOV ils   ! Use field-of-view and instrument line shape convolutions
      RAD TRA   ! also: generate radiance and transmission spectra
</PRE>
</dl>
<hr>
<a name=spc>
<h3> *SPC SECTION: Spectral Range & Resolution </h3>

<DL>
<DT><B>Type</b>
<dd>Primary Section

<dt><b>Description:</b>
<dd>Define range(s) and resolution(s) of output spectra generated by RFM.
<DD> Units are Wavenumber [cm-1] by default, but GHz if the
<a href=#ghzflg>GHZ</a> flag is enabled.

<dt><b>Format</b>
<dd>Multiple records, order may be significant.

<dt><b>Records</b>
<dd> 4 types, depending on number of fields contained:
	<dl>
	<dt><tt>UNLREC</TT>
	<dD> Unlabelled spectral range
	<dd>Fields: <tt>WNOLOW WNOUPP WNORES       </tt> 
	<dt><tt>FILREC</TT>
	<dD> Spectral Range filename
	<dd>Fields: <tt>SPCFIL                     </tt> 
	<dt><tt>LABREC</TT>
	<dD> Labelled spectral range
	<dd>Fields: <tt>LABEL WNOLOW WNOUPP WNORES </tt> 
	<dt><tt>PREREC</TT>
	<dd> Predefined spectral range
	<dd>Fields: <tt>LABEL WNORES               </tt> 
	</dl>

<dt><b>Fields</b>
	<dd> 5 types, ordered according to type of record 
	<dl>
	<dt><tt>SPCFIL</tt> (Character)
	<DD> Name of a <tt> <a href=#spcfil>.spc</a></tt> file 
	     containing a sequence of labelled spectral ranges.
	<dt><tt>LABEL</tt> (Character)
	<dd> C*8  alphanumeric label for spectral range  
	<dt><tt>WNOLOW</tt> (Real)
	<DD> Lower wavenumber [cm-1] for output spectra. 
	     Allowed range: 0.001cm-1 - <TT>WNOUPP</TT>.
	<dt><tt>WNOUPP</tt> (Real) 
	<dd> Upper wavenumber [cm-1] for output spectra. cm-1.
	     Allowed range: <TT>WNOLOW</TT> - 20 000cm-1.
	<dt><tt>WNORES</tt> (Real)
	<DD> Resolution for output spectra, which is interpreted according to 
	     value:
		<dl>
		<dt> <tt>0.0004 .LE. WNORES .LE. 1.0</TT>
		<dd> Wavenumber increment [cm-1]. 
		<dt> <TT>1.0 .LE. WNORES .LE. 2500</TT>
		<dd> (Integer) Number of points per wavenumber (does not apply
                     to <a href=#ghzflg>GHZ</a> flag) 
		<dt> <tt>WNORES .EQ. 0.0</TT>
		<dd> No calculation required
		</dl>
	     Values outside these ranges result in a fatal error (See Note 7).
	</dl>
<dt><b>Notes</b>
<ol><li>The label (case-sensitive) 
for a spectral range appears as part of the output 
            filenames, so a label is compulsory if more than one spectral range
            is required so that the different output files are distinguished.
	<li>Setting resolution <tt>WNORES</TT>= 0 is the method for 
	    predefining a range without actually initiating a calculation. 
            This would normally only be done in a 
            <A href=#spcfil><tt>.spc</tt></a> file.
            To activate it, the <tt>LABEL</tt> is quoted again, but with a 
	    non-zero resolution (<tt>PREREC</TT> record).
	<li>It is possible to have different labels identifying the same upper
            and lower limits provided the resolution is different.
	<li>The resolution applies to the output spectra - if an ILS convolution
            is required the RFM actually performs internal calculation at 
            0.0005 cm-1 resolution, or the closest sub-multiple of the output
            spacing. This can be modified by setting the <a href=#finflg>FIN</a>
	    Flag and specifying a new value in the 
             <A href=#fin><tt>*FIN</tt></a> section.
	<li>Predefined labels may be redefined (with a warning in the 
           <tt><a href=#runlog>.runlog</a></tt> file), but once the resolution has been
            set the label may not be further redefined.
	<li>A Warning message is issued if spectral lines at the highest
	    required tangent level are unlikely to be unresolved at the 
            resolution selected for the fine-mesh calculation.
	<lI> The maximum resolution is determined
	by the value of <a href=#size>MAXFIN</a> in RFMSIZ.INC
        <li> The RFM calculates each spectral range sequentially, so there
are no benefits other than convenience in specifying more than one spectral
range within a particular driver table. The sequence is not significant.
        <LI> If the <a href=#ghzflg>GHZ</a> flag is enabled the requested 
             spectral range and resolution are converted to wavenumber 
             internally and the calculation proceeds in the same way.
	</ol>
<dt><b>Examples</b>
<dd> This is a single, user-specified, unlabelled spectral range
<pre>
*SPC   
    1000 1100 0.01     ! 1000-1100 cm-1 @ 0.01 cm-1 resolution
</pre>
<dd> This is a pair of labelled spectral ranges @ 40pts/wno.
<pre>
*SPC
    BandA  685  970 0.025  ! Band A
    BandB 1215 1500 0.025  ! Band B
</pre>
<dd>The next example uses preloaded ranges and multi-range RFM calculation. In
this case the file <tt>amicro.spc</tt> would contain a series of predefined
spectral ranges (see example <a href=#spcfil><tt>.spc</tt></a> file in <a
href=#formats>Appendix 
C</a>).
<pre>
*SPC   
    amicro.spc              ! Define MIPAS A band microwindow spectral ranges
    A15   100               ! Microwindow 'A15' @ 0.01/cm resolution
    A15HR 952   953.2 0.001 ! A15 Microwindow @ 0.001/cm resolution
    A14   944.5 946.5 0.001 ! Redefine A14 range and run @0.001/cm resolution
</pre>
<dd>The </tt>A15</tt>
 range is activated by the second record, and the third record runs another
calculation over the same range but at a different resolution, requiring a new
label to be defined to prevent conflict over output filenames.
<dt><b>Bugs</b>
<dd> <a href=rfm_bugs.html#bug17>Bug#17</a> (Fixed 
<a href=rfm_upgrades.html#v411>v4.11</a>)
<dd> <a href=rfm_bugs.html#bug15>Bug#15</a> (Fixed 
<a href=rfm_upgrades.html#v411>v4.11</a>)
<dd> <a href=rfm_bugs.html#bug7>Bug#7</a>  (Fixed 
<A href=rfm_upgrades.html#v410>v4.10</a>)
</dl>
<hr>
<a name=gas>
<h3> *GAS SECTION: List of Absorbers </h3>

<dl>
<dt><b>Type</b>
<dd> Primary Section

<dt><b>Description</b>
<dd> List of absorbing species required for calculations, plus optional
qualifiers to select particular bands, isotopes and continuum handling.

<dt><b>Format</b>
<dd>Multiple fields, arbitrary order for molecules, but significant order for
qualifiers attached to molecules.

<DT><B>Fields</b>
<dd> 6 types:
	<dl>
	<dt><tt>GAS</tt> (Character) 
	<dd> Chemical formula of the absorbing species required, e.g. 
		`<tt>H2O</tt>' 
	<dd> Allowed values: see <a href=#gaslist>Appendix E</a>.

	<dt><tt>CFC</tt> (Character)
	<dd> Alternative name for CFC's, eg `<tt>F14</tt>' for <tt>CF4</tt>.
	<dd> Allowed values: see <a href=#gaslist>Appendix E</a>.

	<dt><tt>IDX</tt> (Integer)
	<dd> HITRAN index of required molecule, eg `<tt>3</tt>' for ozone.
	<dd> Allowed values: see <a href=#gaslist>Appendix E</a>.

	<dt><tt>(Qn)</tt> (Character)
	<dd> Qualifier(s) applicable to molecule, 
	eg `<tt>H2O(1:2)(3)(NOCTM)(4)</TT>'
	<dd> Four types of qualifier can be used:
		<dl>
		<dt> <tt>(i)</tt> 
		<dd> <tt>i</tt> is a selected HITRAN 
		isotope index. <br> Allowed range 
		1:(no.of isotopes listed for molecule) (see subroutine
                   <tt>gasiso.for</tt>)
		<dt> <tt>(j:k)</tt> 
		<dd> <tt>j,k</tt> are the
             lower and upper Global Quantum Indices for the selected vibrational
             band (see Notes below) <br> Allowed range: 1:999 or `*'.
		<dt> <tt>(CTM)</tt> 
		<dd> Select continuum-only and omit lines.
Can only be in conjunction with the 
<a href=#ctmflg>CTM</a> flag, and excludes
		use of any other qualifiers for molecule
		<dt> <tt>(NOCTM)</tt> 
		<dd> Exclude continuum if the 
<a href=#ctmflg>CTM</a> flag is enabled (otherwise no effect, but generates
a warning message). This can be placed anywhere in the qualifier string.
		</dl>
	<dt><tt>GASFIL</TT> (Character)
	<dd> The name of a <a href=#gasfil><tt>.gas</tt></a> file containing a 
	     list of absorbers.
	<dt><tt>*(n)</tt> (Character) 
        <dd> Wildcard character <tt>*</tt>, interpreted as "use all absorbing
        gases within these spectral ranges".
	The optional qualifier <tt>(n)</tt>
        (where n is any integer in range 0-99) sets the minimum "optical
	strength" for inclusion (see Notes 9-12 below).   
	</dl>

<dt><b>Notes</b>
<ol><li>The type of field is identified by 
first checking the list of gases, then checking the internal list of CFC nos, 
then attempt to open a file using the field as a filename, i.e. `co2' or `f11'
cannot be used as filenames since these will be interpreted as absorber names.
<li>The list of qualifiers for a particular molecule must be appended to the
molecule name without any spaces, with a maximum total field length of
80 characters.
<li><TT>(CTM)</TT> and <tt>(NOCTM)</tt> qualifiers are only applicable to
molecules with continuum models: CO2, H2O, O2, N2. 
<li>Isotope/band 
 qualifiers may only be used for molecules with line data
(i.e. not cross-section molecules). The isotope number refers to the HITRAN
index, ordered such that 1=most abundant. The bands are distinguished by the 
HITRAN Global Quantum indices for each vibrational state, which depend on the
form of the molecule.
<li>The general form of the qualifiers is [list_of_isotopes][list_of_bands],
eg <tt>...(1)(2)(3:4)(1:6)(3)(2:6)...</tt> selects
bands (3:4) and (1:6) for isotopes (1) and (2), and band (2:6) for isotope (3).
<li>If the first qualifier(s) (or only qualifiers)
are a list of bands, then these are applied to
all isotopes listed in the HITRAN database.
<li>If the last qualifier(s) (or only qualifiers) are a list of isotopes, then
these all bands are selected for these isotopes.
<li>The lower/upper quantum index may be replaced by a 
wildcard <tt>*</tt> to include all bands with this upper/lower index.
However, these are checked for logical consistency with other selections,
eg you can't have <tt>(1)(1:*)</tt> and <tt>(1)(1:4)</tt> 
in the qualifier list for the same molecule. 
<tt>(1)(*:*)</tt> is acceptable for selecting all bands for isotope (1),
but the same effect can be achieved by placing (1) at the end of the qualifier
list without any following bands.
<li>The gas wildcard character <tt>*</tt> can be used in conjunction with any other
gases (in which case it will add any additional absorbers), but may only appear
once in the *GAS section, and not in any <a href=#gasfil>.gas</a> file. 
The main use of this is if you do not know in advance which absorbers might
be significant in a particular spectral range.
<li>The gas wildcard character has optional "optical strength" 
qualifiers which can select a cut
off for absorbers, eg "<tt>*(10)</tt>" is a reasonable value to exclude all
undetectable absorbers. A value "<tt>*(0)</tt>" is equivalent to just 
"<tt>*</tt>".
<li>The "optical strength" parameter is notionally 15 +
log10(max optical depth) for a zenith path through a standard atmosphere so
that a value 15 corresponds to optical depth 1 (hence "<tt>*(10)</tt>" excludes
all absorbers with optical depths less than 1e-5). These are all pretabulated
and very approximate: see module <tt>OPTDAT.INC</tt> for more details.
<li>If the gas wildcard is used, an entry appears in the <a
href=#runlog>.runlog</a> file listing all absorbers found together with
 their "optical strengths", i.e. you could just use the RFM to produce an
ordered list of significant absorbers within any spectral range
(the subroutine <tt>GASALL.FOR</tt> does this task).
<LI>(v4.2 onwards) The user may specify HDO to discriminate between H2O isotope#4 and the
other H2O isotopes, in which case it is treated as a separate gas 
requiring its own profile 
(default is to include all H2O isotopes if H2O is specified).
See <a href=#atmfil>.atmfil</a> format for specifying different mixing
ratio profiles for other isotopes.
<LI> Isotopes: there are two methods of handling isotopes within the RFM.
Isotopes specified within the *GAS section simply act as a filter to
include/exclude lines from the HITRAN database, and within the RFM itself 
there is no further distinction. See the <a href=#atm>*ATM</a> section for
how to specify that isotopes are handled as independent gases.
</ol>
<dt><b>Example</b>
<dd><pre>
*GAS                       
   H2O CO2 N2O CH4 HNO3 O3 ! MIPAS target species
   O2(CTM) N2(CTM) ! Oxygen and Nitrogen - continua only
   minor.gas       ! a file of minor species
   *(10)                   ! Plus any other significant absorbers 
   CO(1)(1:3) NO(1)(1:*)   ! Only primary isotopes, and specific bands
</pre>
<dt><b>Bugs</b>
<dd> <a href=rfm_bugs.html#bug14>Bug#14</a> 
(fixed <a href=rfm_upgrades.html#v411>v4.11</a>)
<dd> <a href=rfm_bugs.html#bug3>Bug#3</a> 
(fixed <a href=rfm_upgrades.html#v402>v4.02</a>)
</dl>
<hr>
<a name=atm>
<h3> *ATM SECTION: Atmospheric Profiles </h3>

<dl>
<dt><b>Type</b>
<dd> Primary Section

<dt><b>Description</b>
<dd> Atmospheric profile data.

<dt><b>Format</b>
<dd>Multiple fields, order is significant.

<dt><b>Fields</b>
<dd> Two types:
	<dl>
	<dt><TT>ATMFIL</TT> (Character)
	<DD> The name of a <a href=#atmfil><tt>.atm</tt></a> file containing 
	atmospheric profile data. 
	<dt><tt>(PSI)</tt> (Character)
	<dd> Qualifier used with <a href=graflg>GRA</a> option 
             to specify horizontal angle [deg] 
             associated with
             this and subsequent profiles, appended to file name with no spaces
	     e.g. <tt> file.atm(-4.5) </tt> to indicate that profiles in
             <tt>file.atm</tt> are located at <tt>PSI=-4.5 deg</tt> 
	</dl>

<dt><b>Notes</b>
<ol>

<li>The order of filenames is significant since the altitude grid of the
        first file defines the internal altitude profile of the RFM, 
        duplicated profiles overwrite the previous values, and any supplied
        value <tt>PSI</tt> is also applied to any following files which 
        do not have any appended value.
<LI> The surface is defined as being at the lowest altitude specified in the
profile (which is not necessarily 0km). A fatal error message is returned
if there are any calculations (including refraction and FOV convolution) 
which `see' below this level and the <a href=#sfcflg>SFC</a> characteristics
 have not been specified.

<li> The forward model will use the same layering as the internal altitude
profile unless the <a href=#layflg>LAY</a> flag is selected.

<LI> If subsequent .atm files include profiles specified over smaller 
altitude ranges than the first file the end values of the short profiles are
duplicated, i.e., the short profiles are extended over the full height range
assuming the end values remain constant (except for pressure, which is 
extrapolated in log space from the pair of end values).

<li> If the observer is placed within the atmosphere (<a href=#obsflg>OBS</a>
flag) at an altitude not corresponding to one of the profile points, an extra
profile level is inserted at the observer altitude. Similarly if
Jacobians  (<a href=#jacflg>JAC</a> flag) 
are specified at different levels.

<li> The Horizontal Angle qualifier <tt>(PSI)</tt> is ignored unless the <a
href=#graflg>GRA</a> flag is enabled, but (from <a
href=rfm_upgrades.html#v421>v4.21</a> onwards) must be present if the GRA
flag is enabled. 

<li> Angles <tt>PSI</tt> are defined as subtended at the local centre of
curvature, which is more or less the same as the spacing of degrees of
latitude, i.e., <tt>PSI=1</tt> corresponds to a distance of around 111 km on
the surface of the earth.  Direction is defined so that the observer is at high
values looking towards low values, i.e. so that profiles with lower values of
<tt>PSI</tt> are further away. Tolerance for distinguishing different PSI
angles (fixed by <tt>PSITOL</TT> parameter in <tt>prfgra.for</tt>) is 
1E-3 deg, approximately 100m along the surface.

<li> When the <a href=#graflg>GRA</a> flag is enabled, a two dimensional
atmosphere is established so that profiles are written (or overwritten) at each
location <tt>PSI</tt> independently, sharing only the height grid established
by the first <tt>.atm</tt> file in the *ATM section.  However, it is not
necessary to supply profiles for all absorbers at all locations since, after
all profiles have been read, there is an interpolation step to fill in any
missing profiles from those that have been supplied.  Suggested use is that the
atmosphere is fully defined for <tt>PSI=0</tt>, and only the horizontally
varying profiles are supplied at other locations.

<li> If not supplied by the user, a reference profile is also interpolated at
<tt>PSI=0</tt>. This extra profile location may lead an error message that the
<tt>MAXGRA</tt> array dimension has been exceeded.

<li> T, lnp, and ln(VMR) (or VMR if <a href=#linflg>LIN</a> flag enabled) are
assumed to vary linearly at each altitude surface between supplied locations,
and to remain constant outside the range of supplied locations.

<li> If no observer position is specified (<a href=#obsflg>OBS</a> Flag
disabled), then <tt>PSI=0</tt> defines the location of the tangent points,
either refracted or geometric according to the specification of the <a
href=tan>*TAN</a> section.

<LI> Isotopes: if isotopes are specified in any input files (eg by having
*CH4(1) as one of the profiles) then the RFM treats these as separate
gases - one gas for each specified isotopic profile plus one gas for the 
remaining isotopes (even if profiles have been supplied for all isotopes).

</ol>

<dt><b>Examples</b>
<dd>
One-dimensional atmosphere
<pre>
*ATM                
     hgtgrd.atm     ! Define altitude grid for calculation (z only)
     std.atm        ! US Std Atmosphere (z,p,T,H2O,CO2,O3,N2O,CO,CH4,O2)
     minor.atm      ! Minor species (HNO3, etc)
     co2_1998.atm   ! Replace US Std. CO2 vmrs with 1998 concentrations
</pre>
Two-dimensional atmosphere, defined at 3 locations
<pre>
*ATM
     std.atm(0)     ! US Std Atm, all species, at PSI=0 
     t_near.atm(2)  ! "near" side temperature profile at PSI=2 deg
     p_near.atm(2)  ! Pressure profile, also at PSI=2 deg
     t_far.atm(-1)  ! "far" side temperature profile, at PSI=-1 deg
     minor.atm(2)   ! Minor species, initially placed at PSI=2
                    ! All std and minor species apart from p,T will be 
                    ! duplicated at PSI=-1, 0 and +2. 
                    ! The std p profile at PSI=0 will be duplicated at PSI=-1
</pre>
</dl>
<hr>
<a name=tan>
<h3> *TAN SECTION: Tangent Paths (or other ray path definitions)</h3>
<h3> Can also use: *DIM, *ELE, *GEO, *LEN, *LEV or *SEC instead of *TAN
as the section header</h3>
<DL>
<DT><B>Type</b>
<dd> Primary Section

<dt><b>Description</b>
<dd> Contents of section defined according to header and flags:
(NB: `limb-viewing' here refers to any mode using a full ray-trace
calculation for a curved atmosphere, 
ie any mode <i>not</i> using the
<a href=#homflg>HOM</a>, <a href=#flxflg>FLX</a>
<a href=#nadflg>NAD</a>, <a href=#zenflg>ZEN</a>
or <a href=#tabflg>TAB</a> flags).
<dd>
Note that *TAN can also be used as the default section header for all options
unless *GEO or *ELE are specifically required.

<dt><b>Format</b>
<dd> Generally: Multiple fields, arbitrary order, except for
<dd><a href=#tabflg>TAB</a> flag:
6 fields, specific order for p,T axes for tabulated absorption coefficients



<dt><b>Fields</b>
<dd> Two types:
	<dl>
	<dt> <tt>USRTAN</TT> (Real)
	<dL>	
	<dt> <b>*TAN</b> header, limb-viewing
        <dd> Actual (refracted) tangent heights [km] 
	<dd> Allowed range: limited to within the atmospheric profile, as
             set by the first height profile in the 
             <href=#atm><tt>*ATM</tt></a> section. If an observer altitude
             is specified (<a href=#obsflg>OBS</a> flag), also limited to less
	     than or equal to this altitude. 
        <dt> <b>*GEO</b> header, limb-viewing
        <dd> Projected (geometric) tangent heights [km] 
	     Allowed range: converted to refracted tangent height, then
             same limits as previous. However, if a surface is specified 
             (<a href=#sfcflg>SFC</a> flag) values below the surface may be 
             used down to minus(local radius of curvature, 
             see <a href=#crv>*CRV</a> section) which corresponds to a nadir 
             view.
        <dt> <b>*ELE</b> header, limb-viewing or 
             <A href=#nadflg>NAD</a>/<a href=#zenflg>ZEN</a> flags
             (*ELE also requires <a href=#obsflg>OBS</a> flag enabled)
        <dd> Elevation angles [deg] relative to observer horizontal, 
             negative=viewing below the horizontal
        <dd> <a href=#zenflg>ZEN</a> flag: allowed range <TT>ELEMIN</TT>:+90 
             (<tt>ELEMIN</tt>=0.1deg, corresponding to ~600 airmasses, set in
             module <tt>CHKNAD.FOR</tt>)
        <dd> <a href=#nadflg>NAD</a> flag: <TT>-ELEMIN</TT>:-90 
        <dd> Limb viewing: downward (-ve) elevation angles have the same 
             restrictions as the equivalent projected geometric tangent 
             points; upward (+ve) elevation angles are only permitted for 
             if the observer is within the atmosphere, and restricted to 
             0:+90 deg. 
        <dt> <b>*SEC</b> header, 
             <A href=#nadflg>NAD</a>/<a href=#zenflg>ZEN</a> flags
             (but not <a href=#flxflg>FLX</a> flag)
        <dd> Airmass factors (=sec(zenith angle)) [dimensionless], 
             for plane-parallel atmospheres
             Minimum allowed value = <tt>1.0</tt> (corresponding to
	      vertical path).
        <dt> <b>*LEV</b> header, 
             <A href=#flxflg>FLX</a> flags (see Note 9)
        <dd> Altitude levels [km] for flux calculation outputs.
        <dt> <b>*LEN</b> header, <a href=#homflg>HOM</a> flag
        <dd> Path lengths [km] for homogeneous path calculations
             Must be a +ve number.
        <dt> <b>*DIM</b> header, <a href=#tabflg>TAB</a> flag
        <dd>  Set of 6 parameters required to define p,T axes for tabulated 
              absorption coefficients in following order:
		<ol>
		<li> <TT>PRE1</TT> Max/Min Pressure limit [mb] for tabulation.
		Allowed range: > 0.0 although a warning message sent to the
		<a href=#runlog><tt>.runlog</tt></a> file if outside range
		(1014.0 : 0.0001). If used in conjunction with an atmospheric
		profile (as opposed to a homogeneous path) then pressure limits
		must also be within pressure range of profile.
		<li> <TT>PRE2</TT> Min/Max Pressure limit [mb] for tabulation.
		Allowed range: same as for <tt>PRE1</tt>. <br>
		If <tt>NP=1</tt> (ie a single pressure tabulation point is 
		chosen) then <tt>PRE2=PRE1</TT> is required.
		<li> <TT>NP</TT> No. points in pressure domain.
		Allowed range: positive integer.
		<li> <TT>TEM1</TT> Min/Max Temperature limit [K] for 
                   tabulation.
		Allowed range: > 0.0 although a warning message sent to 
		<a href=#runlog><tt>.runlog</tt></a> if outside range
		(120 : 350). 
		<li> <TT>TEM2</TT> Max/Min Temperature limit [K] for 
                     tabulation.
		Allowed range: same as for <tt>TEM1</tt> <BR>
		If <tt>NT=1</tt> (ie a single temperature tabulation point is 
		chosen) then <tt>TEM2=TEM1</TT> is required.
		<li> <TT>NT</TT> No. points in temperature domain.
		Allowed range: positive integer.
		</ol>
	</dL>	
	<dt> <tt> TANFIL </tt> (Character)
	<dd> The name of a <a href=#tanfil><tt>.tan</tt></a> file containing a list of
	<tt>USRTAN</tt> values.
	</dl>
<dt><b>Notes</b>
<ol>

<li>The type of field is identified by first attempting to read it as a
legitimate tangent height (<TT>USRTAN</TT>), 
then, if failing (or if first character is one of
<tt>T,t,F,f</tt>), attempting to open it as a filename (<TT>TANFIL</TT>).

<li><tt>USRTAN</tt> values must generally be distinct to 5 significant figures
so that they give different filenames (eg 1m below 100km, 0.001 deg elevation,
but note: 1 km above 100km) (doesn't apply to TAB option).  

<li>For TAB option: in output <a href=#tabfil><tt>.tab</tt></a> file, the
starting point <tt>P1</tt> for the -lnp axis is determined by -ln(PRE1/mb),
whether this is the maximum or minimum pressure, but the sign of the -lnp
increment <tt>DP</tt> will change. Similarly, <tt>T1</tt> is set to TEM1 and
the sign of the temperature increment <tt>DT</tt> is +ve if <tt>TEM2 >
TEM1</tt>, otherwise negative.

<li>For limb paths which intersect the surface (defined as the lowest
altitude specified in the <a href=#atmfil>.atm</a> file rather than 0km), it is
also necessary to use the <a href=#sfcflg>SFC</a> flag so that the surface
parameters are specified.  This is mandatory for 
<a href=#nadflg>NAD</a> and <a href=#flxflg>FLX</a> paths which, by
definition, include surface terms (although not FLX+ZEN).

<li> Upward limb viewing can only be defined by elevation angles (*ELE section
header), and also requires <a href=#obsflg>OBS</a> flag so that the observer
altitudes is defined (which also has to be within the atmosphere).  

<li> The use of *TAN, *ELE or *GEO also has an impact on the interpretation of
the data in the <a href=#fovfil>.fov</a> file.

<lI> With the <a href=#graflg>GRA</a> flag (limb-viewing with horizontal 
gradients), the location of the tangent point is either determined by the
observer location (<a href=#obsflg>OBS</a> flag enabled) or taken at the
reference profile, <tt>PSI=0.0</tt> (<a href=#obsflg>OBS</a> flag disabled).

<li> When the <a href=#flxflg>FLX</a> Flag
is enabled (i.e. the *LEV definition), if <tt>USRTAN</tt> does not correspond
to an existing atmospheric profile level a new level is inserted (this may
not be desirable when also using the <a href=#mtx>MTX</a> option so a warning
is issued in that case). However, for the limb-viewing cases, the profile
layering is unaffected by the selected tangent paths.

<LI> Note that there are two different types of 
*LEV sections, the one here is an
alternative to the *TAN primary section and requires the <a href=#flxflg>FLX</a>
flag to be enabled. The other definition of the <a href=#lev>*LEV</a> section
is as a list of intermediate output levels with the <a href=#levflg>LEV</a>
flag is enabled (which is mutually exclusive with the FLX flag).

</ol>
<p>
<dt><b>Examples</b>
<dd>Normal use as list of actual tangent heights for limb path calculations
<pre>
*TAN                
    40 41 42        ! 40, 41, 42 km,
     paths.dat      ! list of tangent heights from a standard scan pattern.
</pre>
<dd>Used as tabulation axes for <a href=#tabflg>TAB</a> option
<pre>
*TAN
       1000.0  0.01  31  ! 6 points for every factor 10 in pressure
       180 320 15        ! Increments of 10K in temperature
</pre>
<dd> Set of elevation angles for a balloon observations (<a
href=#obsflg>OBS</a> option)
<pre>
*ELE
     -90,  -1.5, -0.5, 0.0, 0.5, 1.5  ! [deg] nadir, plus views towards limb
</pre>
<dt><b>Bugs</b>
<dd> <a href=rfm_bugs.html#bug2>Bug#2</a> (Fixed v4.02)

</dl>
<hr>
<a name=crv>
<h3> *CRV SECTION: Radius of Curvature </h3>

<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#crvflg>CRV</a> Flag.

<dt><b>Description</b>
<dd>Specify local Radius of Curvature to replace default value (6367.421km)

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd> Single type:
	<dl>
	<dt><tt>RADCRV</TT> (Real)
	<dd> Value [km] of radius of curvature. Allowed Range: 2000:100000 km.
	</dl>

<dt><b>Example</b>
<dd><pre>
*CRV
     6378.164     ! Earth's equatorial radius (for EW view at equator)
</pre>
<dt><b>Bugs</b>
<dd> <A href=rfm_bugs.html#bug16>Bug#16</a> 
(fixed <a href=rfm_upgrades.html#v411>v4.11</a>)
</dl>
<hr>
<a name=fin>
<h3> *FIN SECTION: Resolution of Fine Mesh Calculation </h3>

<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#finflg>FIN</a> Flag.

<dt><b>Description</b>
<dd> User-specified Resolution for Fine Mesh Calculation when used in conjunction with
ILS convolution, to replace default value of 0.0005 cm-1. 

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd> Single type:
	<dl>
	<dt><tt>FINRES</TT> (Real)
	<dd> Fine Mesh resolution expressed either as 
		<DL>
		<DT><TT>FINRES .LT. 1</TT>
		<DD> A wavenumber increment [cm-1]. 
		<DT><TT>FINRES .GE. 1</TT>
		<DD> No.points per wavenumber [pts/cm-1]
		</dl>
             The maximum resolution is 2100 pts/cm-1 (set by <TT>MAXFIN</TT> in
		<TT>rfmsiz.inc</tt>)
	</dl>
<dt><b>Notes</b>
<ol><li> Only applies in the case of an ILS convolution
- if no ILS convolution is specified then the fine-mesh resolution is
determined by the output resolution specified in the 
<a href=#spc><tt>*SPC</tt></a> section. 
<li> A warning message is issued if the specified resolution appears 
inadequate for the highest required tangent height.
</ol>

<dt><b>Example</b>
<dd><pre>
*FIN
         300    ! Perform fine mesh calculation at 300pts/cm-1
</pre>
</dl>
<hr>
<a name=fov>
<h3> *FOV SECTION: Field of View Data </h3>

<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#fovflg>FOV</a> Flag.

<dt><b>Description</b>
<dd>Specify Field-of-View Data.

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd> Single type:
	<dl>
	<dt><tt>FOVFIL</TT> (Character)
	<dd> Name of the <a href=#fovfil><tt>.fov</tt></a> file.
	</dl>

<dt><b>Example</b>
<dd><pre>
*FOV
rfm_500.fov            ! MIPAS FOV @ 500 m vertical resolution
</pre>
</dl>
<hr>
<a name=grd>
<h3> *GRD SECTION: Irregular Grid files </h3>

<DL>
<DT><B>Type</b>
<dd> Secondary Section - depends on <A href=#grdflg>GRD</a> Flag.

<dt><b>Description</b>
<dd> Specify Irregular Grid files 

<dt><b>Format</b>
<dd> Multiple fields, arbitrary order.

<DT><B>Fields</b>
<dd> Two types
	<dl>
	<dt> <tt>GRDFIL</TT> (Character)
	<dd> Name of a <tt><a href=#grdfil>.grd</a></tt> file.
        <dt> <tt>GRDDEF</TT> (Character) (<a href=rfm_upgrades#v423>v4.23</a> onwards)
        <dd> Filename template containing a '*' character 
        <dd> Max of 1 such field in section. See Note 2.
	</dl>
<dt><b>Notes</b>
<ol><li>Each irregular grid file listed in this section
is opened and the spectral range of the file compared with all the output
ranges selected in the <a href=#spc>*SPC</a> section.
If the file range completely overlaps one or more of the 
selected ranges it will be used for that range.
If not, then the default is to use the normal line-by-line calculation.
An appropriate message appears in the 
<a href=#runlog><tt>.runlog</tt></a> file.
<li> If a filename template is supplied, first all the explicitly 
specified files are read, then '<tt>*</tt>' character in the template is
expanded to the <a href=#spc>label</a> of each spectral
      range not yet assigned an irregular grid and, if the file exists, it
      is then included.
<li> If there is any ambiguity over which grid is to be used 
(i.e. two files overlapping the same spectral range) a fatal error
condition results.
<li> The grid is only required to overlap the <i>output</i> spectral range: if
an ILS convolution is required then a further check is performed on whether the
grid covers the additional range required by the width of the ILS. If this is
not the case then
a warning message is issued and the calculation proceeds on the
assumption that the absorption beyond the edges of the grid is
negligible. 
<li> The Max/Min tangent 
altitudes listed in the grid are also compared with the 
set of tangent heights selected for calculation. If any of these are outside
the max/min range of the grid file a warning message results but the 
calculation proceeds anyway.
<li> The grid file may indicate any of the following interpolation methods:
<ul>
<li><tt>lin: y = ax + b </tt>
<li><tt>qad: y = ax^2 + bx + c </tt>
<li><tt>cub: y = ax^3 + bx^2 + cx + d </tt>
<li><tt>1li: y = 1 / ( ax + b )</tt>
<li><tt>1qa: y = 1 / ( ax^2 + bx + c ) </tt>
<li><tt>1cu: y = 1 / ( ax^3 + bx^2 + cx + d ) </tt>
<li><tt>1sq: y = 1 / ( ax + b )^2 </tt>
<li><tt>lor: y = 1 / ( ax^2 + b ) </tt>
<li><tt>lnl: y = exp ( ax + b ) </tt>
<li><tt>lnc: y = exp ( ax^3 + bx^2 + cx + d ) </tt>
</ul>
</ol>

<dt><b>Example</b>
<dd><pre>
*GRD 
        h2o001.grd h2o002.grd  ! GRD for H2O microwindows
        ./other/*.grd          ! Template for grd files for any other label
        ch4013.grd             ! GRD for MW CH4013
</pre>
</dl>
<hr>
<a name=hit>
<h3> *HIT SECTION: Binary HITRAN Files </h3>

<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on whether any HITRAN `line' molecules 
selected.

<dt><b>Description</b>
<dd> Specify HITRAN binary data.

<dt><b>Format</b>
<dd> Multiple fields, arbitrary order.

<dt><b>Fields</b>
<dd> Single type:
	<dl>
	<dt><tt>HITFIL</TT> (Character)
	<dd> Name of a <a href=#hitfil><tt>.hit</tt></a>
	 file (generated by GENLN2 program HITLIN or by
<a href=rfm_downloads.html#hitbin>HITBIN</a>).
	</dl>

<dt></b>Notes</b>
<ol>
<li>If more than one file is specified the code tests for any ambiguity
between overlapping ranges/gases, but it is OK to have two files of overlapping
ranges if different gases are required from each, or to have two files with
the same gas but without overlap. 
<li>The binary format allows for multiple versions of data for any one
line, flagged with different `<tt>LSTAT</tt>' values. The RFM reads only
lines assigned<tt>LSTAT .GE. 10</tt>, i.e. takes only the most recent version.
</ol>

<dt><b>Example</b>
<dd><pre>
*HIT 
       hitran_1992.bin    ! HITRAN 1992 data
</pre>
</DL>
<hr>
<a name=ils>
<h3> *ILS SECTION: Instrument Line Shape </h3>

<DL>
<DT><B>Type</b>
<dd> Secondary Section - depends on <A href=#ilsflg>ILS</a> Flag.

<dt><b>Description</b>
<dd> Specify Instrument Line Shape data

<dt><b>Format</b>
<dd> Multiple fields, arbitrary order.

<DT><B>Fields</b>
<dd> Single type
	<dl>
	<dt> <tt>ILSFIL</TT> (Character)
	<dd> Name of an <a href=#ilsfil><tt>.ils</tt></a> file.
	</dl>
<dt><b>Notes</b>
<ol><li>Different ILS files may be specified covering different spectral
ranges, in which case only the ILS fully overlapping any required range
will be used. The program returns a fatal error message if any ambiguity is
found (eg if the required range is fully covered by two ILS functions).
<li>It is also possible to specify a default ILS (see 
<a href=#ilsfil><tt>.ils</tt></a>
file formats, <a href=#formats>Appendix C</a>) to be used if no overlapping
ILS is found for any particular range.
</ol>

<dt><b>Example</b>
<dd><pre>
*ILS
mipas_a.ils        ! ILS function for Band A
mipas_ab.ils       ! ILS function for Band AB       
mipas_b.ils        ! ILS function for Band B
mipas_c.ils        ! ILS function for Band C
mipas_d.ils        ! ILS function for Band D
</pre>
</dl>
<hr>
<a name=jac>
<h3> *JAC SECTION: Jacobian Calculation elements </h3>
<dl>
<Dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#jacflg>JAC</a> Flag.

<Dt><b>Description</b>
<dd> Specify derivatives for Jacobian (=Weighting Function) calculations,
effectively the elements of the "retrieval" state vector. 
This will create
additional output spectra representing the difference (in radiance,
transmission, absorption or optical depth) for these perturbations of the
atmospheric profile.

<Dt><b>Format</b>
<dd> Multiple records, arbitrary sequence

<Dt><b>Records</b>
<dd> One type
<dd> <tt>JACREC</tt>
      <dl>
      <dd> Species, plus (optional) list of retrieval altitudes and/or files 
           containing list of at least 3 altitudes.
      <DD> SPECIES ALT1 ALT2 ALT3 ... ALTFIL ... ALTN
      </dl>

<dt><b>Fields</b>
      <DL>
      <DT><TT>SPECIES</TT> (Character)
      <DD> Species for Jacobians 
      <dd> Allowed values: 'PRE', 'TEM', 'SFCTEM', 'SFCEMS' or chemical 
      formula of 
      any absorber already entered in <A href=#gas>*GAS</a> section
       (either upper or lower case), but HITRAN number codes not allowed.
       (<a href=rfm_upgrades.html#v425>v4.25</a> onwards an optional string may
       be added for a specific isotope, eg <TT>'(2)'</TT> 
       for the 2nd most abundant isotope - see Note 11).
      <dt><tt>ALTn</tt> (Real)
      <dd> Altitudes [km] for retrieval level perturbations (unless
            <TT>SFCTEM</TT> or <TT>SFCEMS</TT> - see Note 8)
      <dd> Allowed values: any altitude used for atmosphere representation,
i.e. must match an altitude listed in the first (see Note 3, no longer
a restriction from <a href=rfm_upgrades.html#v425>v4.25</a>) 
<tt><a href=#atmfil>.atm</a></tt> file listed in the <a href=#atm>*ATM</a>
section of the driver table (see Notes 6 and 7). 
      <DT><TT>ALTFIL</TT> (Character)
      <dd> The name of a file containing a list of altitudes
           (same format as <tt><a href=#tanfil>.tan</a></tt> file)
      </dl>
<dt><b>Notes</b>
<ol>
<li> The perturbation sizes for the Jacobians are 1% for VMR and pressure,
1 K for temperature
and 1.0E-4/km extinction for aerosol. 
So, for example, an output file would represent the
radiance difference between an atmosphere with VMR of some species perturbed
by +1% at some level minus the radiance from an unperturbed atmosphere.
(The perturbation sizes are specified by constants 
<tt>PTBVMR</TT>, <tt>PTBPRE</tt>, <TT>PTBAER</TT> and <tt>PTBTEM</tt> in file
      <TT>RFMCON.INC</TT>).
<li> For each species, the list of altitudes must fit on the same record. 
    If there are too many to fit a single record, enter the
     altitudes via a file (<tt>ALTFIL</tt>) instead.
<li> Jacobian altitudes must match the profile altitudes to within 1 metre
(tolerance specified by <tt>ALTTOL</tt> in module <tt>JACCHK.FOR</tt>). 
From <a href=rfm_upgrades.html#v425>v4.25</a> onwards arbitrary altitudes can
be used - if different from the internal profile extra levels will be
inserted.
<li> If no altitudes are specified for a particular species, 
this is treated as a total column perturbation, i.e. the whole atmospheric
profile is perturbed. For 
homogeneous path calculations (<a href=#homflg>HOM</a>
      flag), each record should <i>only</I> contain the 
<TT>SPECIES</TT> field.
<Li> For a set of altitudes, the 'perturbations' for each Jacobian are 
effectively triangular, centred on each altitude (apart from the highest and
lowest) and decreasing linearly
(in K or %) to zero at the adjacent altitudes. 
So if the altitudes 8, 11, 14 km are listed a Jacobian will only be
created for 11 km. If the atmospheric profile is represented at 1km spacing,
this "11 km" Jacobian corresponds to a 1% perturbation at 11km, 0.67% at 
10 and 12km, 0.33% at 9 and 13 km. This also makes allowance for any extra
layers that might have been inserted by the sub-layering option
(<a href=#layflg>LAY</a> flag).
<LI> Since no Jacobians are created for the highest and lowest altitudes,
at least three altitudes must be specified.
An fatal error is reported if only one or two altitudes 
are listed.
<lI> If the highest specified  altitude lies above the top of the profile this
is effectively regarded as infinity, i.e., the Jacobian calculation for the 
next highest altitude will be with respect to a perturbed `column' above
that altitude (although with the normal triangular taper below).
Similar rule applies for a lowest altitude below the base of the profile
and the Jacobian calculated for the next lowest altitude.
<LI> For surface temperature (<TT>SFCTEM</TT>) and surface emissivity
(<TT>SFCEMS</TT>) Jacobians (available from
 <a href=rfm_upgrades.html#v423>v4.23</a>
onwards), no altitude information is required an a fatal
error results if any other fields appear in the same record.
Perturbation values
are +1K and +0.01 respectively, 
set by <TT>PTBSFT</TT> and <TT>PTBSFE</TT> in <tt>rfmcon.inc</tt>. 
Note that if the surface emissivity is 1.0 (i.e., black surface) the 
Jacobian represents a 1% enhancement in surface emissivity but reflected
components remain zero (see subroutine <TT>radsfc.for</TT>). 
For emissivities close to unity it may be more useful
to redefine the perturbation <TT>PTBSFE</TT> as -0.01.
<li> Jacobian spectra are created as normal 
<a href=#spectra>spectral files</a> with the Jacobian
information following the tangent height information in the output filename, 
e.g. if the 
<a href=#radflg>RAD</a> flag is specified then as well as the normal
(unperturbed) radiance spectrum <tt>rad_a08000.asc</tt> there will be additional
 Jacobian spectra such as <tt>rad_a08000_h2o11000.asc</tt> repeated for each
species and each altitude (<tt>h2o</tt> and <tt>11</tt> km in this case)
      specified in the <a href=jac>*JAC</a> section.
<li> Pointing (line-of-sight) Jacobians are described separately,
see <A href=#losflg>LOS</a> option.
<LI> The default is to calculate Jacobians for all isotopes of a particular
gas, but (<a href=rfm_upgrades.html#v425>v4.25</a> onwards) it is possible
to generate Jacobians for specific isotopes using the same notation as in
the <a href=#gas>*GAS</a> and <a href=#atm>*ATM</a> sections, ie by appending
the HITRAN isotope code (1=most abundant) in brackets, eg H2O(1), CH4(2).
It is possible to mix specified isotopes and the molecule name on its own,
eg H2O(1), H2O(2), H2O, but in this case 
the specified isotopes are excluded from those represented by just the
molecule name. The brackets are included in the output filename
(see subroutine <TT>jacnam.for</TT> to set alternative symbols in case 
round brackets are not acceptable to the operating system).
</ol>
<Dt><b>Examples</B>
<pre>
*JAC              
     O3 5 8 11 14 ! Perturb O3 levels @ 8,11 km in 3km layers
    TEM 5 8 11 14 ! Perturb Temp levels @ 8, 11 km in 3km layers
    PRE           ! Perturb pressure for whole profile
    sfctem        ! Surface temperature Jacobian
     H2O(1)       ! Perturb H2O main isotope column
     H2O(2)       ! Perturb H2O second isotope column
     H2O          ! Perturb remaining H2O isotopes (#3,#4 etc) column
</PRE>
<Dt><b>Bugs</b>
<dd><A href=rfm_bugs.html#bug20>Bug#20</a> (fixed
<a href=rfm_upgrades.html#v411>v4.11</a>)
<dd> <A href=rfm_bugs.html#bug8>Bug#8</a> 
(fixed <A href=rfm_upgrades.html#v410>v4.10</a>
</dl>
<hr>
<a name=lev>
<h3> *LEV SECTION: Intermediate Output Levels (<a
href=rfm_upgrades.html#v425>v4.25 onwards</a>) </h3>
<dl>
<Dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#levflg>LEV</a> Flag.

<Dt><b>Description</b>
<dd> Specify altitudes for intermediate output levels along the ray path
This will create
additional output spectra representing the integrated paths from the remote
side of the atmosphere towards the observer. Effectively this is the same
as specifying multiple observer altitudes (<a href=#obsflg>OBS</a> flag)
within the same driver table.

<Dt><b>Format</b>
<dd> Multiple fields, arbitrary order

<Dt><b>Fields</b>
<dd> Two types
      <DL>
      <dt><tt>ALTn</tt> (Real)
      <dd> Altitudes [km] for output level
      <dd> Allowed values: any altitude within the altitude range specified
          in the <a href=#atm>*ATM</a> section
      <DT><TT>ALTFIL</TT> (Character)
      <dd> The name of a file containing a list of altitudes
           (same format as <tt><a href=#tanfil>.tan</a></tt> file)
      </dl>
<dt><b>Notes</b>
<ol>
<li> If the output levels do not correspond to existing atmospheric levels,
extra levels will be inserted
<LI> For limb-viewing and nadir paths with surface reflection there will
generally be two output spectra calculated for each specified altitude: one
corresponding to the downward integration from the top of the atmosphere
to the tangent point or surface, the other corresponding to the upward
integration to the observer.
<LI> No output files are generated for levels which are not intersected
by the ray path (eg specifying an output level at 14km when the tangent point
is at 15km) or for which the contribution is identically zero (eg downward
integration for a nadir view with non-reflective surface)
<li> Output  spectra are created as normal 
<a href=#spectra>spectral files</a> with the level
information following the tangent height information in the output filename, 
e.g. if the 
<a href=#radflg>RAD</a> flag is specified then as well as the normal full-path
radiance spectrum <tt>rad_a08000.asc</tt> there will be additional
spectra such as <tt>rad_a08000_down11000.asc</tt> and
<tt>rad_a08000_up11000.asc</tt> corresponding to the remote downward path 
(actually an upward-viewing observation) 
and the near upward path (down-viewing) respectively.
<LI> In the case of the  <tt>rad_a08000_down11000.asc</tt> spectrum, the
same result could be obtained using the <a href=#obs>OBS</a> flag with
the observer altitude at 11km and the tangent point at 8km.
<LI> In the case of the  <tt>rad_a08000_up11000.asc</tt> spectrum, the
same result could be obtained using the <a href=#obs>OBS</a> flag with
the observer altitude at 11km and an appropriate positive elevation
angle.
</ol>
<Dt><b>Example</B>
<pre>
*LEV
    11 12 13      ! outputs at 11, 12 and 13 km
    alts.lev      ! and further altitudes contained in file alts.lev
</PRE>
</dl>
<hr>
<a name=lut>
<h3> *LUT SECTION: Look-Up Tables </h3>

<DL>
<DT><B>Type</b>
<dd> Secondary Section - depends on <A href=#lutflg>LUT</a> Flag.

<dt><b>Description</b>
<dd> Specify filenames of Look-Up Tables, either simple tables such as
created by the <a href=#tabflg>TAB</a> option, or compressed by Singular
Value Decomposition. Also optional qualifiers.


<dt><b>Format</b>
<dd> Multiple filename fields, arbitrary order, but any qualifiers must be 
appended to relevant filename without any spaces

<DT><B>Fields</b>
<dd> Three types
	<dl>
	<dt> <tt>LUTFIL</TT> (Character)
	<dd> Name of a <tt><a href=#lutfil>.lut</a></tt> file.
        <dt> <tt>LUTDEF</TT> (Character) (<a
	href=rfm_upgrades.html#v423>v4.23</a> onwards)
        <dd> Filename template containing a '*' character 
        <dd> Max of 1 such field in section. See Note 2.
	<dt> <tt>QAL</tt> (Character)
	<dd> (Optional) Qualifier whose format and effect depend on which type
             of LUT file is specified:
        <dd><b>Simple Tabulation 
(<a href=#tabfil><tt>.tab</tt></a> file)</b>: <tt>QAL</tt> 
            is of the form <tt>(NP:NT)</tt> where <tt>NP</tt> and
            <tt>NT</tt> are integers controlling the p,T axes sampling
	    <dl>
            <dt><tt>NP > 0</tt> 
            <dd> increase the pressure axis interval by factor
                  NP, retaining the first point and adjusting the last point
                  if necessary
            <dt><tt>NP < 0</tt> 
            <dd> increase the pressure axis interval by factor
                  NP, retaining the last point and adjusting the first point
                  if necessary
            <dt><tt>NP = 0</tt> 
            <dd> only use a single point, nearest the middle
                  of the original axis.
	    <Dt>Similarly for <tt>NT</tt> and the temperature axis.
	    <TT>(1:1)</TT> has no effect (ie same as omitting the qualifier).
            </dl>
         <dd><b>SVD-compressed Tabulation
(<a href=#lutfil><tt>.lut</tt></a> file)</b>:<tt>QAL</tt> 
             is of the form <tt>(NS)</tt> where <tt>NS</tt> is
             an integer controlling the number of singular values used,
		<DL>
		<DT> <TT>NS > 0 </TT>
		<DD> Use <tt>NS</tt> SVs in LUT.
		If <tt>NS > NL</tt>, all <tt>NL</tt> SVs are used (which has 
		the same effect as omitting the qualifier) and 
		     a warning message is printed in the 
		     <tt><a href=#runlog>.runlog</a></tt> file
		<DT> <TT>NS = 0 </TT>
		<DD> Set absorption coefficient to zero 
                     (same effect as omitting
		the absorbing species). See note 6.
		<dt> <tt>NQ < 0 </TT>
		<DD> Use <tt>NQ + NL</tt> SVs in LUT.
		If <tt>NQ < -NL</tt> no SVs are used, which has the same
		effect as setting <tt>NQ = 0</tt> (see note 6) and 
		     a warning message is printed in the 
		     <tt><a href=#runlog>.runlog</a></tt> file).
		</dl>
	</dl>
<dt><b>Notes</b>
<ol><li>Each look-up table listed in this section
is opened and the gas and spectral range specified
in the file contents are read. If the gas matches one of the absorbers 
specified in the <A HREF=#gas>*GAS</a> section, and the spectral range either
matches or completely overlaps one or more of the ranges specified in the
<a href=#spc>*SPC</a> section, then the look-up table will be used.
If not, then the default is to use the normal line-by-line calculation.
An appropriate message appears in the 
<a href=#runlog><tt>.runlog</tt></a> file.
<LI> If a filename template is supplied, first all the explicitly 
specified files are read, then '<tt>*</tt>' character in the template is
expanded to the <a href=#spc>spectral range label</a> and absorber for
any combination not yet assigned a LUT. The default expansion is of the form
<tt>sssggg</tt> where <tt>sss</tt> is the spectral range label (optional)
and <tt>ggg</tt> is the molecule name (this is consistent with the filename
format generated with the <a href=#tabflg>TAB</a> option). However, if the
template contains the string <tt>CS_</TT> then it is assumed that this is
a MIPAS SVD-compressed LUT, and to conform with the standard MIPAS nomenclature
the expansion is <tt>sss_ii</tt> where <tt>ii</tt> is the molecule ID
(<a href=#gaslist>Appendix E</a>)
<li> If there is any ambiguity over which LUT is to be used (i.e. two files
for the same absorber overlapping the same spectral range) a fatal error
condition results.
<li> The LUT is only required to overlap the <i>output</i> spectral range: if
an ILS convolution is required then a further check is performed on whether the
LUT covers the additional range required by the width of the ILS. If this is
not the case then
a warning message is issued and the calculation proceeds on the
assumption that the absorption beyond the edges of the LUT (for that species) is
negligible. 
<li> The LUT is also checked for Max/Min limits on temperature and pressure.
If the RFM calculation involves paths for that absorber beyond
the table limits (quite possible at low pressures, high -lnp), 
a warning message is sent to the <a href=#runlog><tt>.runlog</tt></a> file
but the calculation proceeds using the value of the LUT at the closest edge
(effectively assuming k(p,T) is constant beyond p,T edges of the table).
<li> LUT files can either be the Abs.Coeff.
tables generated by the <a href=#tabflg>TAB</a> flag (ASCII or Binary 
<a href=#tabfil><tt>.tab</tt></a> files),
or the SVD-compressed versions (<a href=#lutfil><tt>.lut</tt></a> file,
ASCII only).  These are handled differently within
the program (ie the former  are not stored internally due to reasons of space)
but the only distinction as far as the user is concerned relates to the
types of qualifier that are allowed for each file.
<li> The effect of setting <tt>NQ=0</tt> is not quite the same as using
zero singular values for the <tt>'log'</tt> type of LUT 
tabulation. Using 0 SVs implies a
reconstructed value of log(k)=0, hence an absorption coefficient k = 1. 
It is assumed that this is undesirable, so if the qualifier is used to select
0 SVs, the tabulation treated as linear ('lin') in order to force k=0 
(ie as if the gas were omitted completely, which is assumed to be the intended
effect). If this happens, a warning message is written in the 
<tt><a href=#runlog>.runlog</a></tt> file.
<li> Some care is required when combining H2O LUTs with the 
<a href=#ctmflg>CTM</a> flag: the normal CKD H2O continuum requires subtracting
the line absorption coefficient at 25cm-1 from line centre before combining the
line shape with the continuum. This is not possible if the H2O line information
comes via the LUT, so an incorrect (larger) H2O line+continuum absorption 
results. Solutions are:
<ul>
<li> Include the H2O continuum into the LUT data when it is generated (and 
don't use the <a href=#ctmflg>CTM</a> flag in the subsequent RFM calculation)
<li> Same, except use <tt>H2O(NOCTM)</tt> in the <a href=#gas>*GAS</A>
section, allowing the 
<a href=#ctmflg>CTM</a> flag to be used for other continua.
</ul> 
</ol>

<dt><b>Example</b>
<dd><pre>
*LUT                   
! Absorbers for microwindow CH4_0001 
   tab_CH4_0001h2o.asc tab_CH4_0001co2.asc ! Direct LUTs for h2o and co2
   tab_CH4_0001o3.asc(2:3)    ! Direct LUT for o3 with 2*p, 3*T axis increments
   CS_CH4_0001_06.DAT(10)     ! SVD-compressed LUT for CH4 limited to 3 S.V.s
   CS_N2O_0001_n2o01a.lut(-2) ! SVD-compressed LUT for N2O reduced by 2 S.V.s
   CS_*.DAT                   ! standard SVD-compressed LUTs for other gases 
</pre>
</dl>
<hr>
<a name=nte>
<h3> *NTE SECTION: Non-LTE Data </h3>

<dl>
<dt><b>Type</b>
<dd>Secondary Section - depends on <a href=#nteflg>NTE</a> Flag.

<dt><b>Description</b>
<dd>Vibrational temperature profiles and partition functions
for non-LTE calculations.

<dt><b>Format</b>
<dd>Multiple fields, arbitrary order

<dt><b>Fields</b>
<DD> Two types:
	<dl>
	<dt><tt>NTEFIL</tt> (Character)
	<dd> Name of a <A href=#ntefil><tt>.nte</tt></a> file.
        <dt> <tt>NTEDEF</TT> (Character) (<a
	href=rfm_upgrades.html#v423>v4.23</a> onwards)
        <dd> Filename template containing a '*' character 
        <dd> Max of 1 such field in section. See Note 1.
	</dl>
<dt><b>Notes</b>
<ol>
<li> If a filename template is supplied, first all the explicitly 
specified files are read, then '<tt>*</tt>' character in the template is
expanded to the absorber name of any molecules for which vibrational
temperature data has not yet been loaded and, if the file exists, the data
is read in.
</ol>
<dt><b>Example</b>
<dd><pre>
*NTE
      co2_std.nte     ! CO2 vibrational temperatures for US Std Atmosphere
      h2o_std.nte     ! H2O vibrational temperatures for US Std Atmosphere 
      *_new.nte       ! default filename for other gases, eg 'o3_new.nte'
</pre>
</dl>
<hr>
<a name=obs>
<h3> *OBS SECTION: Observer Altitude </h3>
<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#obsflg>OBS</a> Flag.

<dt><b>Description</b>
<dd> Specify observer altitude [km] (same scale as atmospheric profile)
if required for calculations.

<DT><b>Format</b>
<DD>Two fields, order is significant

<DT><B>Fields</b>
<dd> Two types:
	<dl>
	<dt><tt>ALTOBS</TT> (Real)
	<DD> Observer altitude in [km]
	<dd> Minimum value: must be >= lowest altitude specified in first
	height profile of the <a href=#atm>*ATM</a> section.
	<dd> For limb-viewing paths specified by actual (*TAN) or projected
(*GEO) tangent heights in the <a href=#tan>*TAN</A> section, 
altitude must also be >= highest specified tangent point, but there is no
maximum altitude limit
        <dd> For limb-viewing or NAD/ZEN 
paths specified by elevation angle (*ELE),
altitude must also be sufficiently
low that the highest elevation angle intersects the atmosphere (for positive
	elevations, i.e. upward viewing, this requires the observer to
	be within the atmosphere itself)
	<dt><tt>PSIOBS</tt> (Real)
        <dd> Observer horizontal angle [deg]
	<dd> Optional/ignored unless <a href=#graflg>GRA</a> flag enabled.

	</DL>
<DT><B>Notes</b>
<ol>
<li>Where the observer altitude is not specified it is assumed that the
observer is somewhere between the top of the atmosphere and infinity - the
precise altitude makes no difference if the path is specified by tangent height
(either geometric or refracted) and the observer is somewhere outside the
atmosphere. With the <a href=#graflg>GRA</a> flag, all tangent points are
then taken to lie at <tt>PSI=0</tt>.
<li>When the <a href=#graflg>GRA</a> flag is specified (2D atmosphere),
all viewing is assumed to be in the direction +ve to -ve horizontal angle,
ie the observer location would normally be specified as a positive angle
relative to the atmospheric profile locations specified in the <a
href=#atm>*ATM</a> section.
<li>When used in conjunction with the <a href=#graflg>GRA</a> flag,
the observer location determines the horizontal angle of the tangent point
relative to the reference profile (PSI=0). This information is written to
the <a href=#pthfil><tt>.pth</tt></a> diagnostics file.
<LI>See <a href=#levflg>LEV</a> flag for method of generating outputs
equivalent to multiple observer altitudes within a single run.
</OL>
<dt><b>Examples</b>
<dd>
<pre>
*OBS  
      25.0  ! Observer at 25 km. (1-D atmosphere)
</pre>
<pre>
*OBS
      25.0  4.0 ! @25 km. +4 deg from ref (2-D atmosphere).
</pre>
</DL>
<hr>
<a name=rej>
<h3> *REJ SECTION: Line Rejection Limits </h3>

<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#rejflg>REJ</a> Flag.

<dt><b>Description</b>
<dd> Minimum line strengths (adjusted for path conditions) to be used for widemesh
and finemesh calculations. 

<DT><b>Format</b>
<DD>Single record containing two fields in sequence.

<DT><B>Fields</b>
<dd> Two types:
	<dl>
	<dt><tt>WIDREJ</TT> (Real)
	<dd> Minimum Line strength for inclusion in widemesh calculation 
	<dt> <tt>FINREJ</TT> (Real)
	<dd> Minimum Line strength for inclusion in finemesh calculation 
	</dl>

<dt><b>Example</b>
<dd><pre>
*REJ
        1.0E-8     1.0E-9  ! values recommended for MIPAS reference spectra
</pre>
</dl>
<hr>
<a name=sfc>
<h3> *SFC SECTION: Surface Parameters </h3>

<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#sfcflg>SFC</a> Flag.

<dt><b>Description</b>
<dd> Surface temperature and emissivity.

<DT><b>Format</b>
<DD>Single record containing two fields in sequence.

<DT><B>Fields</b>
<dd> Two types:
	<dl>
	<dt><tt>TEMSFC</TT> (Real)
	<dd> Surface Temperature [K].
           Minimum value: 0 K.
	<dt> <tt>EMSSFC</TT> (Real)
	<dd> Surface Emissivity [dimensionless]
	Restricted to range 0:1.
	</dl>

<dt><b>Example</b>
<dd><pre>
*SFC
      250 0.999 ! T_sfc = 250 K, reflectivity=0.001
</pre>
<DT><B>Notes</b>
<ol>
<li> The surface is considered to lie just below the lowest altitude specified
in the height profile, i.e. not necessarily at 0 km (0 km is the altitude 
surface for which the radius of curvature applies). 
<li> Specification of surface parameters is mandatory for 
nadir viewing in a plane-parellel atmosphere 
(<a href=#nadflg>NAD</a> flag) and for 
`limb-viewing' (ie
curved atmosphere) rays which intersect the lower boundary of the specified
height profile. 
<li> A warning message is issued if the surface temperature differs from the
lower boundary atmospheric temperature by more than <tt>TEMDEL</tt>=10 K
(set in module <tt>INPSFC.FOR</tt>) since this is an unphysically large 
temperature discontinuity.
<li> With the <a href=#nadflg>NAD</a> option, a surface emissivity of 1.0
(i.e. a perfect Black Body) is treated differently to values <1.0:
     <ul>
     <li> <TT>EMSSFC</TT>=1: <tt><A href=#trafil>.tra</a>, <a href=#absfil>.abs</a>,
 <a href=#optfil>.opt</a></tt> all refer just to the downward atmospheric path
 without including the surface (otherwise these spectra would be completely
flat)
     <li> <tt>EMSSFC</tt><1: spectra refer to complete downward + upward path
 including surface
     </ul>
<li> For surface emissivities less than unity, the reflection is treated as
specular (as opposed to diffuse) so that the observer-surface path is 
mirrored by the surface-space path beyond the reflection point.
</ol>
<dt><b>Bugs</b>
<dd> <a href=rfm_bugs.html#bug10>Bug#10</a> 
(fixed <a href=rfm_upgrades.html#v410>v4.10</a>)
<dd> <a href=rfm_bugs.html#bug6>Bug#6</a> 
(fixed <a href=rfm_upgrades.html#v404>v4.04</a>)
<dd> <a href=rfm_bugs.html#bug1>Bug#1</a> 
(fixed <a href=rfm_upgrades.html#v401>v4.01</a>)
</dl>
<hr>
<a name=shp>
<h3> *SHP SECTION: Molecular Lineshapes </h3>

<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on <a href=#shp>SHP</a> Flag.

<dt><b>Description</b>
<dd> User-defined (ie non-Voigt) spectral line shapes. 

<dt><b>Format</b>
<dd> Multiple records, arbitrary sequence

<DT><B>Records</b>
<dd> One type
	<dl>
	<dt><TT>SHPREC</TT>
	<DD> Shape used, plus list of absorbers to which it applies
	<dd>Fields:<tt>SHPNAM  GAS1  GAS2  GAS3  ... GASN </TT>, or
        <DD>Fields:<tt>SHPNAM  * </tt> (max 1 record of this type, see Note 2)
	</dl>

<DT><B>Fields</b>
<dd> 2 types:
	<dl>
	<dt><tt>SHPNAM</TT> (Character)
	<dd> One of a list of lineshapes 
	<dd> Allowed values: 
<tt>VOIgt </tt>, <tt> LORentz </tt>, <TT> DOPpler </TT>,
<tt>VAN Vleck Weisskopf</tt> (or <tt>VVW</tt>) and <tt>CHIfactor</TT> 
	<dt><tt>GAS</tt> (Character)
	<dd> Absorber to be used with specified lineshape.
	<dd> Allowed values: must be listed in <A href=#gas><tt>*GAS</tt></a> section.
	</dl>
<dt><b>Notes</b>
<ol><li> Only the first 3 characters of <tt>SHPNAM</TT> are tested.
<li> An asterisk (<tt>*</tt>) may be substituted for <tt>GAS</TT> 
	in which case it is taken to represent all required gases not explicitly
	allocated other shapes.
<li>If no asterisk is present, all absorbers must be explicitly allocated a 
lineshape.
<li> Currently the <tt>CHIFACTOR</tt> shape can only be used with CO2 
     (represents sub-Lorentzian wings of CO2).
<LI> The <TT>VVW</TT> lineshape specified here is an explicit calculation
     of the Van Vleck Weisskopf lineshape, i.e., the Lorentz lineshape with
     low-wavenumber correction terms.
<LI> The <a href=#vvwflg>VVW</a> flag (in the <a href=#flg>*FLG</a> section)
     can be used for applying the same correction <i>all</i> lineshapes, i.e.
     VVW lineshape is equivalent to LOR lineshape + VVW correction flag.
<LI> If both the <a href=#vvwflg>VVW</a> flag and VVW lineshape are specified,
     a warning is generated but the VVW correction is ignored for lines
     already generated with the VVW lineshape.
</ol>
<dt><b>Example</b>
<pre>
*SHP
     Chi-factor  CO2    ! Use CO2 sub-Lorentzian wings 
     LORENTZ  H2O CH4   ! Use Lorentz shape for H2O and CH4
     LORENTZ  N2O       ! Also N2O
     VOI         *      ! Use Voigt shape for all other absorbers
     DOPP CO            ! Doppler shape for CO
</pre>
</dl>
<hr>
<a name=tps>
<h3> *TPS SECTION: Total Internal Partition Sum Data </h3>

<dl>
<dt><b>Type</b>
<dd>Secondary Section - depends on <a href=#tpsflg>TPS</a> Flag.

<dt><b>Description</b>
<dd>Specify files containing 
Total Internal Partition Sum tabulations for each molecule/isotope
as a function of temperature

<dt><b>Format</b>
<dd>Multiple fields, arbitrary order

<dt><b>Fields</b>
<DD> Two types:
	<dl>
	<dt><tt>TPSFIL</tt> (Character)
	<dd> Name of a <A href=#tpsfil><tt>.tps</tt></a> file.
        <dt> <tt>TPSDEF</TT> (Character) (<a
	href=rfm_upgrades.html#v423>v4.23</a> onwards)
        <dd> Filename template containing a '*' character 
        <dd> Max of 1 such field in section. See Note 1.
	</dl>
<dt><b>Notes</b>
<ol>
<LI> A single file may be used containing the TIPS data for all
molecules/isotopes, or separate files containing tabulation for a single
molecule/isotope, or any combination. The data are read in at the start of
the program so the only advantage of the latter is to speed up the 
initialisation.
<li> If a filename template is supplied, first all the explicitly 
specified files are read, then '<tt>*</tt>' character in the template is
expanded to the absorber name of any molecules for which TIPS data
has not yet been loaded and, if the file exists, the data
is read in.
<li> 
These files are the original HITRAN format Partition Sums for 70-3000K
for each molecule/isotope converted to RFM-specific format. 
<LI> RFM .tps files can each contain one or more molecules/isotopes and
can be concatenated into a single file (at the expense of a longer initial
read time)
<LI> Any molecules/isotopes found in files listed in this section will be
used for direct interpolation, other molecules/isotopes will use the 
polynomial expressions in <tt>QTFCT</tt>
<LI> If data for a particular molecule/isotope is duplicated, either within the
same file or in a subsequent file the last dataset is used and a warning message
written to the <a href=#runlog><tt>.runlog</tt></a> file.
<li> See <a
href=http://www.atm.ox.ac.uk/RFM/rfm_downloads>http://www.atm.ox.ac.uk/RFM/rfm_downloads</a>
for file
</ol> 
<dt><b>Example</b>
<dd><pre>
*TPS
      co2.tps         ! CO2 vibrational temperatures for US Std Atmosphere
      ./rfm_files/*.tps ! other molecules, eg './rfm_files/h2o.tps'
</pre>
</dl>
<hr>
<a name=xsc>
<h3> *XSC SECTION: Cross-Section Data </h3>

<dl>
<dt><b>Type</b>
<dd> Secondary Section - depends on whether any `cross-section' molecules 
selected.

<dt><b>Description:</b>
<dd>Specify molecular cross-section files.

<dt><b>Format</b>
<dd>Multiple fields, arbitrary order

<dt><b>Fields</b>
<dd> Two types:
	<dl>
	<dt><tt> XSCFIL </TT> (Character)
	<dd> Name of an <a href=#xscfil><tt>.xsc</tt></a> file.
        <dt> <tt>XSCDEF</TT> (Character) (<a
	href=rfm_upgrades.html#v423>v4.23</a> onwards)
        <dd> Filename template containing a '*' character 
        <dd> Max of 1 such field in section. See Note 2.
	</dl>

<dT><b>Notes</b>
<ol><li> The single HITRAN file containing all the cross-sectional molecules 
         results in slow access times. Speed can be improved if this is split
         into individual files for each species and/or band.
<LI> If a filename template is supplied, first all the explicitly 
specified files are read, then '<tt>*</tt>' character in the template is
expanded to the absorber name of any molecules (using the 'fnn' form for
CFCs, see <a href=gaslist.html>Appendix E</a>) with ID GE 50 
for which absorption data has not
yet been assigned and, if the file exists, the data
is read in.
<li> The RFM checks for overlapping data or duplicate data in a similar fashion
     to the checks on the binary line data files.
<li> For the data tabulated as a function of (p,T) instead of just T
(eg as supplied with HITRAN96),
the RFM interpolates a value from the 3 surrounding (p,T) points using a 
fairly sophisticated triangulation scheme (see subroutine <tt>TRIANG.FOR</tt>).
Points outside the boundary of the tabulated (p,T) space are assigned a value
at the closest boundary point. The RFM then applies the GENLN2 heavy-molecule 
partition function temperature correction (<tt>QTINT.FOR</TT>).
<LI> The RFM (and GENLN2) uses a slightly modified version of the cross-section
files released with HITRAN: an extra record is added at the start of each
band with the format: <TT> (A3,I7,I10) '***', ID, NXST </tt>
where <TT>ID</TT> is an ID number associated with the molecule (see
<A HREF=#gaslist>Appendix E</a>) and NXST is the number of (p,T) tabulations
that follow. This is repeated if there are other bands or molecules in the same
file.
For example, the first three records of the file <tt>f11.xsc</tt> 
(F11 has ID=51),
containing 6 temperature tabulations for the 830-860cm-1
band,  are as follows (NB: your browser displays multiple spaces as a single
space so the actual records are more extended in terms of number of characters): <BR>
<tt>
***     51         6 <br>
  CCL3F     830.0010  859.9960      2023     293.0    0.0000  NCAR      CFC-11 <BR>
 3.510E-19 3.450E-19 3.290E-19 3.390E-19 3.480E-19 3.380E-19 3.400E-19 3.510E-19 3.510E-19 3.540E-19
</tt><br>
These modified files are available with the RFM on request.
</OL>
<dt><b>Example</b>
<dd><pre>
*XSC 
       f11.xsc   ! Cross section data for F11
       f12.xsc   ! Cross section data for F12
       ./rfm_files/*.xsc   ! Other data, eg './rfm_files/f22.xsc'
</pre>
The file f11.xsc,  (F11 has ID=51),
containing 6 temperature tabulations for the 830-860cm-1
band,  starts with the following 3 records: <BR>
<tt>
***     51         6 <br>
  CCL3F     830.0010  859.9960      2023     293.0    0.0000  NCAR      CFC-11 <BR>
 3.510E-19 3.450E-19 3.290E-19 3.390E-19 3.480E-19 3.380E-19 3.400E-19 3.510E-19 3.510E-19 3.540E-19
</tt>
</dl>
<hr>
<a name=abs>
<h3> *ABS SECTION: Absorption Spectra Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#absflg>ABS</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#absfil><tt>.abs</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> ABSFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#absfil><tt>.abs</tt></a> 
	     filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one spectral range or tangent height is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the spectral range label (if any) plus 5
         digits representing the tangent height in metres.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
<li> If the filename contains the strings `<TT>asc</tt>' or `<tt>bin</tt>',
these are automatically switched according to the status of the
<a href=#binflg>BIN</a> Flag.
</ol> 
<dt><b>Example</b>
<dd><pre>
*ABS
        rfm_*.abs
</pre>
</DL>
<hr>
<a name=bbt>
<h3> *BBT SECTION: Brightness Temperature Spectra Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#bbtflg>BBT</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#bbtfil><tt>.bbt</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> BBTFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#bbtfil><tt>.bbt</tt></a> 
	     filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one spectral range or altitude level is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the spectral range label (if any) plus 5
         digits representing the tangent height in metres.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
<li> If the filename contains the strings `<TT>asc</tt>' or `<tt>bin</tt>',
these are automatically switched according to the status of the
<a href=#binflg>BIN</a> Flag.
</ol> 
<dt><b>Example</b>
<dd><pre>
*BBT
        rfm_*.bbt
</pre>
</DL>
<hr>
<a name=coo>
<h3> *COO SECTION: Cooling Rate Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#cooflg>COO</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#coofil><tt>.coo</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> COOFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#coofil><tt>.coo</tt></a> 
	     filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one spectral range or altitude level is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the spectral range label (if any) plus 5
         digits representing the tangent height in metres.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
<li> If the filename contains the strings `<TT>asc</tt>' or `<tt>bin</tt>',
these are automatically switched according to the status of the
<a href=#binflg>BIN</a> Flag.
</ol> 
<dt><b>Example</b>
<dd><pre>
*COO
        rfm_*.coo
</pre>
</DL>
<hr>
<a name=opt>
<h3> *OPT SECTION: Optical Depth Spectra Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#optflg>OPT</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#optfil><tt>.opt</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> OPTFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#optfil><tt>.opt</tt></a> 
	filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one spectral range or tangent height is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the spectral range label (if any) plus 5
         digits representing the tangent height in metres.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
<li> If the filename contains the strings `<TT>asc</tt>' or `<tt>bin</tt>',
these are automatically switched according to the status of the
<a href=#binflg>BIN</a> Flag.
</ol> 
<dt><b>Example</b>
<dd><pre>
*OPT
        rfm_*.opt
</pre>
</DL>
<hr>
<a name=pth>
<h3> *PTH SECTION: Path Diagnostics Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#pthflg>PTH</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#pthfil><tt>.pth</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> PTHFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#pthfil><tt>.pth</tt></a> 
	filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one tangent height is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the 5 digits representing the tangent height 
         in metres.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
</ol> 
<dt><b>Example</b>
<dd><pre>
*PTH
        rfm_*.pth
</pre>
</DL>
<hr>
<a name=prf>
<h3> *PRF SECTION: Internal Profile Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#prfflg>PRF</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#prffil><tt>.prf</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> PRFFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#prffil><tt>.prf</tt></a> 
	filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one horizontal angle is specified (ie 2D calculations using
         the <a href=#graflg>GRA</a> flag), the 
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the 5 digits representing the horizontal
         angle in millidegrees.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
</ol> 
<dt><b>Example</b>
<dd><pre>
*PRF
        rfm_*.prf
</pre>
</DL>
<HR>
<a name=rad>
<h3> *RAD SECTION: Radiance Spectra Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#radflg>RAD</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#radfil><tt>.rad</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> RADFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#radfil><tt>.rad</tt></a> 
	filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one spectral range or tangent height is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the spectral range label (if any) plus 5
         digits representing the tangent height in metres.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
<li> If the filename contains the strings `<TT>asc</tt>' or `<tt>bin</tt>',
these are automatically switched according to the status of the
<a href=#binflg>BIN</a> Flag.
</ol> 
<dt><b>Example</b>
<dd><pre>
*RAD
        rfm_*.rad
</pre>
</DL>
<hr>
<a name=tab>
<h3> *TAB SECTION: Tabulated Absorption Coefficient Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#tabflg>TAB</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#tabfil><tt>.tab</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> TABFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#tabfil><tt>.tab</tt></a> 
	filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one spectral range or absorber is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the spectral range label (if any) plus the
         absorber name.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
<li> If the filename contains the strings `<TT>asc</tt>' or `<tt>bin</tt>',
these are automatically switched according to the status of the
<a href=#binflg>BIN</a> Flag.
</ol> 
<dt><b>Example</b>
<dd><pre>
*TAB
        rfm_*.tab
</pre>
</DL>
<hr>
<a name=tra>
<h3> *TRA SECTION: Transmission Spectra Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#traflg>TRA</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#trafil><tt>.tra</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> TRAFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#trafil><tt>.tra</tt></a> 
	filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one spectral range or tangent height is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the spectral range label (if any) plus 5
         digits representing the tangent height in metres.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
<li> If the filename contains the strings `<TT>asc</tt>' or `<tt>bin</tt>',
these are automatically switched according to the status of the
<a href=#binflg>BIN</a> Flag.
</ol> 
<dt><b>Example</b>
<dd><pre>
*TRA
        rfm_*.tra
</pre>
</DL>
<hr>
<a name=wid>
<h3> *WID SECTION: Widemesh Diagnostics Filenames </h3>

<DL>
<dt><b>Type</b>
<dd> Optional Section - depends on <a href=#widflg>WID</a> Flag 

<dt><b>Description:</b><br>
<DD>User-defined name for <a href=#widfil><tt>.wid</tt></a> file(s).

<dt><b>Format</b>
<dd>Single field

<dt><b>Fields</b>
<dd>Single type:
	<dl>
	<dt> <tt> WIDFIL </TT> (Character)
	<dd> Template for the user-defined <a href=#widfil><tt>.wid</tt></a> 
	filenames.
	</dl>
<dt><b>Notes</b>
<ol><li> If more than one spectral range or absorber is specified,
         filename must contain a wildcard `<tt>*</tt>' character which will be
         expanded to accommodate the spectral range label (if any) plus the
         absorber name.
<li> If any <a href=#runid><tt>run_ID</tt></a> is specified, this is also added to
    the output filename.
<li> If more than one absorber is specified, an extra file is produced 
    summing the line counts contributions from all absorbers.
    This follows the same filename template, but minus the species code.
</ol> 
<dt><b>Example</b>
<dd><pre>
*WID
        rfm_*.wid
</pre>
<dt><b>Bugs</b>
<dd><a href=rfm_bugs.html#bug5>Bug#5</a> (Fixed v4.04)
</DL>
<hr>
<a name=flags>
<h2> APPENDIX B: FLAGS  </h2>
The Flags are binary switches which apply to an entire run of the RFM
and determine which type of calculations are to be performed.
Flags are enabled if the 3-letter codes appear in the
<a href=#flg><tt>*FLG</tt></a> section of the <a href=#drvfil>Driver File</a>.
If they or do not appear, or appear after the end-of-record-comment
marker (`<tt>!</tt>'), the flag is disabled.
The list of enabled flags is written to the <a href=#runlog><tt>.runlog</tt></a> file.
<dl>
<dd> <a href=#absflg><tt>ABS</tt></a> - Write Absorption spectra
<dd> <a href=#avgflg><tt>AVG</tt></a> - Spectrally average output
<dd> <a href=#bbtflg><tt>BBT</tt></a> - Write Brightness Temperature spectra
<dd> <a href=#binflg><tt>BIN</tt></a> - Write output spectra as binary files
<dd> <A href=#clcflg><tt>CLC</tt></a> - Use specific absorption coefficients
for each path segment
<dd> <A href=#cooflg><tt>COO</tt></a> - Calculate cooling rates
<dd> <A href=#crvflg><tt>CRV</tt></a> - User-specified Radius of Curvature
<dd> <a href=#ctmflg><tt>CTM</tt></a> - Include Continuum absorption
<dd> <a href=#dblflg><tt>DBL</tt></a> - Write spectra to Double Precision
<dd> <A href=#finflg><tt>FIN</tt></a> - User-specified Fine Mesh Resolution
<dd> <A href=#flxflg><tt>FLX</tt></a> - Apply solid-angle integration for flux calculations
<dd> <A href=#fvzflg><tt>FVZ</tt></a> - Assume FOV function represents
<i>refracted</I> tangent heights
<dd> <a href=#geoflg><tt>GEO</tt></a> - Use geometric (i.e. unrefracted) ray paths
<dd> <a href=#ghzflg><tt>GHZ</tt></a> - Spectral units GHz rather than cm-1
<dd> <a href=#graflg><tt>GRA</tt></a> - Assume horizontal gradients (2D atmosphere)
<dd> <a href=#grdflg><tt>GRD</tt></a> - Use Irregular Grids for spectral calculations
<dd> <a href=#homflg><tt>HOM</tt></a> - Perform Homogeneous path calculation
<dd> <A href=#ilsflg><tt>ILS</tt></a> - Convolve with instrument line-shape
<dd> <a href=#jacflg><tt>JAC</tt></a> - Write Jacobian spectra 
<dd> <a href=#levflg><tt>LEV</tt></a> - Output spectra at intermediate levels
<dd> <a href=#layflg><tt>LAY</tt></a> - Perform sub-layering of profiles
<dd> <a href=#linflg><tt>LIN</tt></a> - Assume VMR varies linearly with altitude
<dd> <a href=#losflg><tt>LOS</tt></a> - Write Pointing Jacobian spectra 
<dd> <a href=#lunflg><tt>LUN</tt></a> - Re-use Logical Unit Numbers for output
spectra 
<dd> <a href=#lutflg><tt>LUT</tt></a> - Use Look-Up Table for Absorption Coefficient.
<dd> <a href=#mixflg><tt>MIX</tt></a> - Include Line-mixing
<dd> <a href=#mtxflg><tt>MTX</tt></a> - produce inter-level matrix of flux calculations
<dd> <A href=#nadflg><tt>NAD</tt></a> - Use Nadir-viewing ray paths
<dd> <A href=#newflg><tt>NEW</tt></a> - Open output files as `NEW'
<dd> <a href=#nteflg><tt>NTE</tt></a> - Use non-LTE Calculations
<dd> <A href=#obsflg><tt>OBS</tt></a> - Observer within atmosphere
<dd> <A href=#optflg><tt>OPT</tt></a> - Write Optical Depth spectra
<dd> <A href=#prfflg><tt>PRF</tt></a> - Write out Internal Profile
<dd> <A href=#pthflg><tt>PTH</tt></a> - Write Ray Path diagnostics
<dd> <a href=#qadflg><tt>QAD</tt></a> - Use simple quadratic interpolation for
line wings 
<dd> <a href=#radflg><tt>RAD</tt></a> - Write Radiance spectra
<dd> <a href=#rejflg><tt>REJ</tt></a> - Implement line rejection
<dd> <a href=#sfcflg><tt>SFC</tt></a> - Specify surface characteristics 
<dd> <a href=#shpflg><tt>SHP</tt></a> - Use non-Voigt line shapes
<dd> <a href=#tabflg><tt>TAB</tt></a> - Write Absorption Coefficient Tables
<dd> <a href=#tpsflg><tt>TPS</tt></a> - Use tabulated TIPS data
<dd> <a href=#traflg><tt>TRA</tt></a> - Write Transmission spectra
<dd> <a href=#vrtflg><tt>VRT</tt></a> - Flux-type calculations without solid
angle integration
<dd> <a href=#vvwflg><tt>VVW</tt></a> - Apply VVW correction to lineshapes
<dd> <a href=#widflg><tt>WID</tt></a> - Write Widemesh diagnostics
<dd> <A href=#wngflg><tt>WNG</tt></a> - Use far-wing cut off for lines
<dd> <A href=#zenflg><tt>ZEN</tt></a> - Use Zenith-viewing ray paths
</dl>
<hr>
<a name=absflg> 
<h3> ABS Flag - Write Absorption Spectra </h3>
<dt> <b>Enabled</b>
<dd> Create <A href=#absfil><tt>.abs</tt></a> files containing absorption spectra
     (=1-transmission).
<dd> If <A href=#abs><tt>*ABS</tt></a> section in Driver Table
, read user-defined filename.
<dt> <b> Disabled </b>
<dd> No absorption spectra written
<dd> <A href=#abs><tt>*ABS</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#tabflg>TAB</a> flag.
</dl>
<hr>
<a name=avgflg> 
<h3> AVG Flag - Spectrally Average Output 
(RFM <a href=rfm_upgrades.html#v410>v4.10</a> onwards) </h3>
<dt> <b>Enabled</b>
<dd> Output spectra represent spectral averages at the specified resolution
<dt> <b> Disabled </b>
<dd> Output spectra represent spectral sampling at the specified resolution
(unless <a href=#ilsflg>ILS</a> flag enabled).
<dt> <b> Restrictions </b> 
<dd> Incompatible with 
<a href=#ilsflg>ILS</a>, 
<a href=#optflg>OPT</a> and 
<a href=#tabflg>TAB</a> flags.
<dt> <b> Notes </b>
<dd> The spectral averaging is performed by creating an internal
`instrument line shape' which is a triangle with a base width equal to twice
the output resolution. Apart from small rounding errors, the same effect
can be achieved by explicitly using the ILS option and supplying such an
ILS as the <a href=#ilsfil><tt>.ils</tt></a> file.
<Dt> <b> Bugs</b>
<dd> <A href=rfm_bugs.html#bug11>Bug#11</a> 
(fixed <a href=rfm_upgrades.html>v4.11</a>)
</dl>
<hr>
<a name=bbtflg> 
<h3> BBT Flag - Write Brightness Temperature Spectra 
(RFM <a href=rfm_upgrades.html#v423>v4.23</a> onwards) </h3>
</h3>
<dt> <b>Enabled</b>
<dd> Create <A href=#bbtfil><tt>.bbt</tt></a> files containing brightness
temperature spectra (in K), i.e. the temperature of the Planck Function
that gives the equivalent spectral radiance
<dd> If <A href=#bbt><tt>*BBT</tt></a> section in Driver Table
, read user-defined filename.
<dt> <b> Disabled </b>
<dd> No brightness temperature spectra written
<dd> <A href=#bbt><tt>*BBT</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#tabflg>TAB</a> flag.
<dt> <b> Notes </b>
<dd> Internally the RFM calculates radiance, these are converted to brightness
temperature at the output stage (subroutine <tt>WRTOUT.FOR</tt>) using the
formula
<pre>
         BBT = C2 * V / LOG ( 1 + C1 * V**3 / RAD ) 
</pre>
where <TT>C1,C2</tt> are the radiation constants, approx 1.439 and 
1.191E-3 respectively (actual values in <TT>PHYCON.INC</TT>), <TT>V</TT> is
the wavenumber, <tt>RAD</tt> is the radiance.
</dl>
<hr>
<a name=bfxflg> 
<h3> BFX Flag - Use Planck v. Optical Depth within layer </h3>
<dt> <b>Enabled</b>
<dd> Calculate radiance = Sum ( B.dTau ) assuming B (Planck Function) varies
linearly with altitude and Optical Depth X = ln(Tau) varies linearly with
path within each layer (effectively integrate B(X)dTau for each layer assuming 
B is linear in X for Zenith/Nadir paths,
and quadratic in X for limb paths).
<dt> <b> Disabled </b>
<dd> Calculate radiance = Sum ( B.dTau ) assuming B is constant within each
layer, with weighted value determined by the Curtis-Godson temperatures for
each absorbing species.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#homflg>HOM</a>, <a href=nteflg>NTE</a> and
<a href=#tabflg>TAB</a> flags. 
<dd> <a href=radflg>RAD</a> flag must also be enabled.
</dl>
<hr>
<a name=binflg> 
<h3> BIN Flag - Write Output Spectra as Binary Files </h3>
<dt> <b>Enabled</b>
<dd> All output spectra 
     (<A href=#absfil><tt>.abs</tt></A>, <a href=#optfil><tt>.opt</tt></a>, 
	<A href=#radfil><tt>.rad</tt></a>,
     <A href=#trafil><tt>.tra</tt></a> files) written as binary files.
<dd> Any `<tt>.asc</tt>' string in output spectra filenames is replaced by 
	`<tt>.bin</tt>'
<dt> <b> Disabled </b>
<dd> Output spectra written as ASCII files.
<dd> Any `<tt>.bin</tt>' string in output spectra filenames is replaced by 
	`<tt>.asc</tt>'
<dt> <b> Restrictions </b> 
<dd> None.
</dl>
<hr>
<a name=clcflg> 
<h3> CLC Flag -  Use specific absorption coefficients for each path segment 
</h3>
<dt> <b>Enabled</b>
<dd> Absorption coefficients for each gas in each path segment are 
calculated according to specific Curtis-Godson parameters
<dt> <b> Disabled </b>
<dd> Absorption coefficients may be calculated by scaling those of
similar segments by the absorber amount.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#homflg>HOM</a>, <a href=#nadflg>NAD</a>,
<a href=#tabflg>TAB</a> and <a href=#zenflg>ZEN</a> Flags
(In the case of TAB flag, specific absorption coefficients are calculated
by definition, while in the other three cases the `scaled' absorption
coefficient is analytically identical to the specific calculation).
<Dt><b>Bugs</b>
<dd> <a href=rfm_bugs.html#bug9>Bug#9</a>
(fixed <a href=rfm_upgrades.html#v410>v4.10</a>)
</dl>
<hr>
<a name=cooflg> 
<h3> COO Flag - Write Cooling Rate Spectra 
(RFM <a href=rfm_upgrades.html#v410>v4.10</a> onwards)
</h3>
<dt> <b>Enabled</b>
<dd> Cooling rate spectra 
[K/day/cm-1] are produced for each altitude specified in the 
<a href=#tan>*TAN</a> (or *LEV) section of the Driver Table. 
<dd> If <a href=#coo>*COO</a> section in Driver Table, read user-defined filename. 
<dt> <b> Disabled </b>
<dd> No cooling rates calculated.
<dd> <a href=#coo>*COO</a> section ignored.
<dt> <b> Restrictions </b> 
<dd> <a href=#flxflg>FLX</a> Flag must be enabled.
<dt> <b>Notes</b>
<dd>
<oL>
<li>Cooling rates are defined as d(Fu-Fd)/dz*1/(Cp*rho) where Fu and Fd are
the upward and downward spectral radiance fluxes, z is altitude, 
Cp is the molar
heat capacity (<TT>CPMOL</TT> in file <tt>phycon.inc</tt>) and rho is the
density of air molecules.
<li>Cooling rates can be averaged over output intervals using the
<a href=#avgflg>AVG</a> flag, but the user has to multiply by the output
grid wavenumber interval in order to get K/day for that spectral interval.
<li>The actual cooling rate calculation involves a quadratic fit to three
adjacent profile levels. If the levels are equally spaced, this reduces to a 
simple difference in net fluxes (Fu-Fd) calculated at levels 
above and below the output level.
</ol>
</dl>
<hr>
<a name=crvflg> 
<h3> CRV - User-Specified Radius of Curvature </h3>
<dt> <b>Enabled</b>
<dd> Use user-specified Radius of Curvature supplied in 
<A href=#crv><tt>*CRV</tt></a>
	section of Driver Table.
<dt> <b> Disabled </b>
<dd> Use default Radius of Curvature (6367.421 km)
<dd> Ignore  <tt>*CRV</tt> section of Driver Table.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <A href=#homflg>HOM</a>, 
<a href=#nadflg>NAD</a>, <a href=#tabflg>TAB</a> 
and <a href=#zenflg>ZEN</a> Flags.
<dt> <b> Bugs</b>
<dd> <a href=rfm_bugs.html#bug16>Bug#16</a> 
(fixed <a href=rfm_upgrades.html#v411>v4.11</a>)
</dl>
<hr>
<a name=ctmflg> 
<h3> CTM - Include Continuum absorption </h3>
<dt> <b>Enabled</b>
<dd> Include pretabulated continuum for H2O, CO2, O2 and N2 if selected as
     absorbing species.
<dt> <b> Disabled </b>
<dd> Neglect any continuum effects 
<dt> <b> Restrictions </b> 
<dd> None.
<dt> <b> Note </b>
<dd> Can be further modified by use of the <tt>(CTM)</tt> and <tt>(NOCTM)</tt> qualifiers 
after the species name
in the  <a href=#gas>*GAS</a> section)
<dt> <b> Bugs </b>
<dd> <a href=rfm_bugs.html#bug3>Bug#3</a> (fixed v4.02)
</dl>
<hr>
<a name=dblflg> 
<h3> DBL - Write Spectra with Double Precision 
(RFM <a href=rfm_upgrades#v410>v4.10</a> onwards)</h3>
<dt> <b>Enabled</b>
<dd> Output spectra written with full (ie double) precision
<dt> <b> Disabled </b>
<dd> Output spectra truncated to single precision
<dt> <b> Restrictions </b> 
<dd> Incompatible with TAB flag
<dt> <b> Note </b>
<dd> Internally, the radiative transfer integration is performed with
double precision but uses single precision absorption coefficients 
(since most line parameters are only known with this accuracy).
Double Precision output is only really
necessary when considering transmittances close to 1.0, or when comparing
different RFM runs with minor perturbations.
</dl>
<hr>
<a name=finflg> 
<h3> FIN - User-specified Fine Mesh Resolution </h3>
<dt> <b>Enabled</b>
<dd> Use user-specified resolution for Fine Mesh calculations prior to ILS
	Convolution (or spectral averaging), 
        value given in <A href=#fin><tt>*FIN</tt></a> section of 
	Driver Table.
<dt> <b> Disabled </b>
<dd> Use default resolution (0.0005 cm-1) 
<dd> Ignore <a href=#fin><tt>*FIN</tt></a> section. 
<dt> <b> Restrictions </b> 
<dd> Either <a href=#avgflg>AVG</a> or <A href=#ilsflg>ILS</a> flags 
must also be enabled.
<dt> <b> Notes </b>
<dd> 
<ol>
<li>By default, the RFM generates spectrally <i>sampled</i> 
output at the resolution
specified in the <a href=#spc>*SPC</a> section of the driver table, so this is
also fine mesh resolution for calculations. However, if any spectral averaging
is required, either by an explicit instrument line shape convolution 
(<a href=#ilsflg>ILS</a> flag) or using the <a href=#avgflg>AVG</a> flag,
the fine mesh resolution for the calculations defaults to 0.0005 cm-1
irrespective of the output resolution, unless modified by the <a
href=#finflg>FIN</a> flag.
</ol>
</dl>
<hr>
<a name=flxflg> 
<h3> FLX - Apply solid angle integration for flux calculation 
(RFM <a href=rfm_upgrades.html#v410>v4.10</a> onwards) </h3>
<dt> <b>Enabled</b>
<dd> Transmittance, Absorption and Radiance spectra integrated over solid
angle (but see <a href=#vrtflg>VRT</a> flag)
<dd> <a href=#tan>*TAN</a> (=*LEV) 
section of driver table interpreted as atmospheric
levels for output.
<dd> Modifies definitions of <a href=#zenflg>ZEN</a> and <a href=#nadflg>NAD</a>
flags (see notes below).
<dd> Allows Cooling Rates (<a href=#cooflg>COO</a> Flag</a>) and flux matrices
(<a href=#mtxflg>MTX</a> Flag) to be derived.
<dd> Uses Lambertian surface reflections (specular if <a href=#vrtflg>VRT</a>
flag enabled)
<dt> <b> Disabled </b>
<dd> Spectra calculated along ray paths.
<dd> Specular surface reflections
<dt> <b> Restrictions </b> 
<dd> Incompatible with
<a href=#clcflg>CLC</a>,
<a href=#crvflg>CRV</a>,
<a href=#fovflg>FOV</a>,
<a href=#geoflg>GEO</a>,
<a href=#graflg>GRA</a>,
<a href=#homflg>HOM</a>,
<a href=#levflg>LEV</a>,
<a href=#losflg>LOS</a>,
<a href=#obsflg>OBS</a>,
<a href=#pthflg>PTH</a>,
and <a href=#tabflg>TAB</a> Flags
<dd>Incompatible with <a href=#optflg>OPT</a> flag unless
<a href=#vrtflg>VRT</a> flag also enabled
<dd>Either <a href=#sfcflg>SFC</a> or <a href=#zenflg>ZEN</a> flags 
must be enabled (but not both).
<dt> <b> Notes </b>
<dd>
<OL> 
<li> Solid angle integrations are defined as <tt>2.pi.x.u.du</tt> where 
<tt>u</tt> is the cosine of the zenith angle, integrated from 0:1, and
<tt>x</tt> is the quantity to be integrated. For transmittances and
absorptions, these are normalised by an factor <tt>1/(2.pi.u.du)=1/pi</tt>. 
<li> Integrations are performed using Gaussian 1st moment
quadrature. The number of coefficients 
used is controlled by <TT>PARAMETER NQAD</TT>
in subroutine <tt>RFMFLX.FOR</tt>, currently set to 4 although values up to
5 are tabulated in <TT>GAUQAD.FOR</TT>. 
<li> <a href=#nadflg>NAD</a> and <a href=#zenflg>ZEN</a> Flags:
when used in conjunction with the <a href=#flxflg>FLX</a> flag these define
 the hemisphere for integration as follows
    <ul>
    <li><a href=#radflg>RAD</a> and <a href=#cooflg>COO</a> Flags:
        NAD/ZEN are optional and can be used to restrict calculations to the
        upward/downward fluxes alone (rather than net fluxes).
    <li><a href=#traflg>TRA</a> and <a href=#absflg>ABS</a> Flags:
        NAD/ZEN are mandatory and define whether the transmittance is from the
        output level to the surface/space respectively.
    </uL>
However, note that NAD/ZEN are not used with the <a href=#mtxflg>MTX</a> flag.
<li> Sign: upward fluxes are defined as positive, downward as negative.
Cooling rates follow the sign of d(Net Flux)/dz, ie a net flux divergence
(increase in net flux with altitude) gives a positive cooling rate.
<li> Units: using the FLX flag (without the <A href=vrtflg>VRT</a> flag)
also converts the 
radiances from nW/cm2 to W/m2, i.e. multiplied by factor 1e-5
<LI> The <a href=#vrtflg>VRT</a> flag option allows the solid angle integration
to be suppressed in which case this functions as a simple vertical ray path
calculation (and optical depth calculations are meaningful - 
hence <a href=#optflg>OPT</a> flag may also be enabled).
</OL>
<dt> <b> Bugs </b>
<dd><a href=rfm_bugs.html#bug23>Bug#23</a> (fixed <a href=rfm_upgrades.html#v412>v4.12</a>)
</dl>
<hr>
<a name=fovflg> 
<h3> FOV - Convolve with field-of-view </h3>
<dt> <b>Enabled</b>
<dd> Perform vertical convolution on spectra using field-of-view function
     specified in <a href=#fov><tt>*FOV</tt></a> section. 
<dt> <b> Disabled </b>
<dd> No FOV convolution, i.e. produce spectra with delta-function FOV  response
     at the nominal tangent height
<dd> Ignore <a href=#fov><tt>*FOV</tt></a> section. 
<dt> <b> Restrictions </b> 
<dd> Incompatible with <A href=#optflg>OPT</a>, 
	<a href=#homflg>HOM</a>,
	<a href=#nadflg>NAD</a>,
        <a href=#tabflg>TAB</a> and
	<a href=#zenflg>ZEN</a> Flags.
</dl>
<hr>
<a name=fvzflg> 
<h3> FVZ - FOV function represents <i>refracted</i> tangent heights </h3>
<dt> <b>Enabled</b>
<dd> Regard FOV file as containing FOV-shape after refraction
(i.e. strictly only valid for a particular tangent height view) 
<dt> <b> Disabled </b>
<dd> Regard FOV file as containing FOV-shape as projected from satellite
(normal usage, valid for all tangent heights since distortion due to refraction
will be taken into account)
<dt> <b> Restrictions </b> 
<dd> <a href=#fovflg>FOV</a> Flag must also be enabled.
</dl>
<hr>
<a name=geoflg> 
<h3> GEO - Use Geometric Paths </h3>
<dt> <b>Enabled</b>
<dd> Ignore refraction effects when ray-tracing. 
<dt> <b> Disabled </b>
<dd> Allow for refraction
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#homflg>HOM</a>, <A href=#nadflg>NAD</a>,
<a href=#tabflg>TAB</a>
and <A href=#zenflg>ZEN</a> Flags.
<dt><b> Bugs</b>
<dd> <a href=rfm_bugs.html#bug13>Bug#13</a>
(fixed <a href=rfm_upgrades.html#v411>v4.11</a>)
</dl>
<hr>
<a name=graflg> 
<h3> GRA - Horizontal Gradients 
(RFM <a href=rfm_upgrades.html#v410>v4.10</a>  onwards) </h3>
<dt> <b>Enabled</b>
<dd> Use 2D ray-tracing algorithm
<dd> <a href=#atm>*ATM</A> section: 
read horizontal angles (PSI) qualifiers associated with each profile.
<dd> <a href=#obs>*OBS</a> section:
read horizontal angle of observer location
<dd> <a href=#pthfil><tt>.pth</tt></a> file: horizontal gradient information
added to path diagnostics.
<dt> <b> Disabled </b>
<dd> Use 1D ray-tracing algorithm
<dd> <a href=#atm>*ATM</a> section: ignore any horizontal angles
<dd> <a href=#obs>*OBS</a> section: ignore any horizontal angle
<dt> <b> Restrictions </b> 
<dd> Incompatible with 
<A href=#homflg>HOM</a>,
<A href=#nadflg>NAD</a>,
<A href=#tabflg>TAB</a> and 
<a href=#zenflg>ZEN</a> Flag.
<Dt><b> Bugs</b>
<dd> <a href=rfm_bugs.html#bug21>Bug#21</a> (fixed 
<a href=rfm_upgrades.html#v411>v4.11</a>)
<dd> <a href=rfm_bugs.html#bug19>Bug#19</a> (fixed 
<a href=rfm_upgrades.html#v411>v4.11</a>)
<dd> <a href=rfm_bugs.html#bug13>Bug#13</a> (fixed 
<a href=rfm_upgrades.html#v411>v4.11</a>)
</dl>
<hr>
<a name=ghzflg> 
<h3> GHZ - Define spectra in GHz rather than cm-1
(RFM <a href=rfm_upgrades.html#v423>v4.23</a>  onwards) </h3>
<dt> <b>Enabled</b>
<dd> Interpret contents of <a href=#spc>*SPC</a> section as spectral
range, resolution defined in GHz
<DD> Output <a href=#spectra>spectra</a> on GHz axis
<DD> Warn if <a href=#ilsfil>ILS</a> files defined on cm-1 axis
<dt> <b> Disabled </b>
<dd> Interpret contents of <a href=#spc>*SPC</a> section as spectral
range, resolution defined in cm-1
<DD> Output <a href=#spectra>spectra</a> on cm-1 axis
<DD> Warn if <a href=#ilsfil>ILS</a> files defined on GHz axis
<dt> <b> Restrictions </b> 
<dd> None
<Dt><b>Notes</b>
<OL>
<LI> Internally the RFM always works in cm-1, so spectral ranges defined in
GHz in the <a href=#spc>*SPC</a> section
are converted to cm-1 using the factor 1E7/VLIGHT (approximately 1/30),
where VLIGHT, the speed of light, is defined in <tt>PHYCON.INC</TT>).
Conversely, the spectral axis defined in header record#3 of the output
<a href=#spectra>spectral files</a>, is converted back to GHz before being
written to the file.
<LI> <a href=#ilsfil>ILS files</a> may be expressed in either wavenumber
or GHz. If incompatible with the GHZ flag, the appropriate conversion is made 
and a warning message sent to the <a href=#runlog>log file</a>.
<LI> All other spectral input data, e.g., in the <a href=#hit>*HIT</a> or <a
href=#xsc>*XSC</a> sections, are assumed to be in cm-1.
</OL>
</dl>
<hr>
<a name=grdflg> 
<h3> GRD - Use Irregular Grid files </h3>
<dt> <b>Enabled</b>
<dd> Use irregular grids for spectral calculations of path radiance,
transmission and absorption (interpolated to regular grid before 
any ILS convolution and output), or (<a href=rfm_upgrades.html>RFM v4.10</a>
onwards) tabulated absorption coefficients).
<dd> Read <a href=#grdfil><tt>.grd</tt></a> filenames from
<a href=#grd>*GRD</a> section of driver table
<dt> <b> Disabled </b>
<dd> Use regular spectral grid for all calculations
<dd> <a href=#grd>*GRD</a> section of driver table ignored
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#wngflg>WNG</a> Flags.
(Incompatible with <a href=#tabflg>TAB</a> Flag prior to
(<a href=rfm_upgrades.html>RFM v4.10</a>).
<Dt><b>Bugs</b>
<dd><A href=rfm_bugs.html#bug18>Bug#18</a> (fixed
<a href=rfm_upgrades.html#v411>v4.11</a>)
<dd><A href=rfm_bugs.html#bug20>Bug#20</a> (fixed
<a href=rfm_upgrades.html#v411>v4.11</a>)
</dl>
<hr>
<a name=homflg> 
<h3> HOM - Perform Homogeneous path calculation </h3>
<dt> <b>Enabled</b>
<dd> Perform calculations for homogeneous path specified in normal way via
     <A href=#atmfil><tt>.atm</tt></a> files except that the first file must
        only contain a single-level `profile'.
<dd> Path length(s)  entered via the <a href=#tan><tt>*TAN</tt></A> section.
<dt> <b> Disabled </b>
<dd> Assume limb path (or nadir/zenith path if 
<a href=#nadflg>NAD</a>/<a href=#zenflg>ZEN</a> Flags enabled).
     At least two altitudes must be specified
     for profile representation.
<dt> <b> Restrictions </b> 
<dd> Incompatible with
<A href=#crvflg>CRV</a>, 
<A href=#fovflg>FOV</a>, 
<a href=#geoflg>GEO</a>, 
<a href=#graflg>GRA</a>, 
<a href=#layflg>LAY</a>,
<a href=#levflg>LEV</a>,
<a href=#losflg>LOS</a>,
<a href=#nadflg>NAD</a>, 
<a href=#obsflg>OBS</a>, 
<a href=#sca>SCA</a>,
and <a href=#zenflg>ZEN</a> Flags.
<DT> <b> Bugs</b>
<dd> <A href=rfm_bugs.html#bug11>Bug#11</a> 
(fixed <A href=rfm_upgrades.html#v411>v4.11</a>
<dd> <A href=rfm_bugs.html#bug8>Bug#8</a> 
(fixed <A href=rfm_upgrades.html#v410>v4.10</a>
</dl>
<hr>
<a name=ilsflg> 
<h3> ILS - Convolve with Instrument Line-Shape </h3>
<dt> <b>Enabled</b>  
<dd> Spectral convolution with (Apodised) Instrument Line Shape.
<dd> <a href=#ils><tt>*ILS</tt></a> section of Driver Table required to list
     <a href=#ilsfil><tt>.ils</tt></a> input files.
<dd> <a href=#spc><tt>*SPC</tt></a> section resolution interpreted as final output 
     resolution only (decoupled from Fine Mesh Calculation resolution).
<dt> <b> Disabled </b>
<dd> <a href=#ils><tt>*ILS</tt></a> section of Driver Table ignored.
<dd> <a href=#spc><tt>*SPC</tt></a> section resolution defines resolution both for 
      Fine Mesh Calculation and for output spectra.
<dt> <b> Restrictions </b> 
<dd> Incompatible with 
<A href=#avgflg>AVG</a>, 
<A href=#optflg>OPT</a> and
<a href=#tabflg>TAB</a> Flags.
<dt> <b> Notes </b>
This flag may be used to apply a triangular ILS shape to create a spectrally
averaged (as opposed to spectrally sampled) output, however, from
RFM <A href=rfm_upgrades.html#v410>v4.10</a> onwards this effect can be
achieved more conveniently simply be enabling the <a href=#avgflg>AVG</a>
flag.
<dt><b> Bugs</b>
<dd> <a href=rfm_bugs.html#bug17>Bug#17</a> (fixed
<a href=rfm_upgrades.html#v411>v4.11</a>)
</dl>
<hr>
<a name=jacflg> 
<h3> JAC - Write Jacobian Spectra  </h3>
<dt> <b>Enabled</b>
<dd> Calculate and write out Jacobian spectra defined in <a href=#jac>*JAC</a>
section of driver table, corresponding to all selected output spectra
<dt> <b> Disabled </b>
<dd> No Jacobian calculations, <a href=#jac>*JAC</a> section of driver table
ignored.
<dt> <b> Restrictions </b>
<dd> Incompatible with  <a href=#mtxflg>MTX</a>, <a href=#levflg>LEV</a> 
and <a href=#tabflg>TAB</a> flags
<dt> <b> Notes </b>
<dd> Due to the large number of spectra thay may be generated with this option,
it may also be necessary on some machines to use the <a href=lunflg>LUN</a> flag.
<Dt><b>Bugs</b>
<dd><A href=rfm_bugs.html#bug20>Bug#20</a> (fixed
<a href=rfm_upgrades.html#v411>v4.11</a>)
<dd> <A href=rfm_bugs.html#bug8>Bug#8</a> 
(fixed <A href=rfm_upgrades.html#v410>v4.10</a>
</dl>
<hr>
<a name=layflg> 
<h3> LAY - Perform sub-layering of profiles </h3>
<dt> <b>Enabled</b>
<dd> Limit thickness of vertical layers to comply with maximum allowed 
     variation of Planck Function and line width.
Constructs intermediate 
	      profile points until criteria are met, retaining all
             original profile points.
<dt> <b> Disabled </b>
<dd> Use vertical profile exactly as specified in the first height 
profile (*HGT) of
     the first file in the <A href=#atm><tt>*ATM</tt></a> section of the
     Driver Table.
<dt> <b> Restrictions </b>
<dd> Incompatible with <a href=#homflg>HOM</a> Flag.
</dl>
<hr>
<a name=levflg> 
<h3> LEV - Write Intermediate Level Spectra (<a href=rfm_upgrades.html#v425>v4.25</a>
onwards) </h3>
<dt> <b>Enabled</b>
<dd> Calculate and write out spectra at intermediate altitude levels
along ray path defined in <a href=#lev>*LEV</a>
section of driver table
<dt> <b> Disabled </b>
<dd> No intermediate outputs, <a href=#lev>*LEV</a> section of driver table
ignored.
<dt> <b> Restrictions </b>
<dd> Incompatible with  
<a href=#flxflg>FLX</a>,
<a href=#homflg>HOM</a>,
<a href=#jacflg>JAC</a>,
<a href=#losflg>LOS</a> and
<a href=#tabflg>TAB</a> flags
<dt> <b> Notes </b>
<dd> Due to the large number of spectra thay may be generated with this option,
it may also be necessary on some machines to use the <a href=lunflg>LUN</a> flag.
</dl>
<hr>
<a name=linflg> 
<h3> LIN - Assume VMR profile varies linearly with altitude </h3>
<dt> <b>Enabled</b>
<dd> Interpolate profiles assuming VMR varies linearly with altitude
<dt> <b> Disabled </b>
<dd> Interpolate profiles assuming ln(VMR) varies linearly with altitude
<dt> <b> Restrictions </b>
<dd> None.
<dt> <b> Bugs </b>
<dd> <a href=rfm_bugs.html#bug22>Bug#22</a> (fixed 
<a href=rfm_upgrades.html#v411>v4.11</a>)
</dl>
<hr>
<a name=losflg> 
<h3> LOS - Write Pointing Jacobian Spectra  </h3>
<dt> <b>Enabled</b>
<dd> Calculate and write out Jacobian spectra representing the 
gradient of radiance as a function of altitude or elevation angle
<dt> <b> Disabled </b>
<dd> No Pointing Jacobian calculations
<dt> <b> Restrictions </b>
<dd> At least two tangent paths must be specified in the 
<A href=#tan>*TAN</a> section
<dd> Incompatible with  
<a href=#flxflg>FLX</a>
<a href=#homflg>HOM</a>
<a href=#levflg>LEV</a>
<a href=#mtxflg>MTX</a>
<a href=#nadflg>NAD</a>
<a href=#tabflg>TAB</a> and 
<a href=#zenflg>ZEN</a> flags
<dt> <b> Notes </b>
<dd> 
<ol>
<li> Pointing Jacobians are distinct from Jacobians with respect to elements
of the atmospheric profile (<a href=#jacflg>JAC</a> option), 
and are defined 
by the tangent heights selected
in the <a href=#tan>*TAN</a> section of the driver table
<li> The spectra are calculated simply from the difference between the 
nominal output spectra: linear difference for the lowest and highest altitudes,
gradient of a quadratic fit for any intermediate altitudes, so accuracy will
depend on the user-defined tangent height spacing
<li> `Perturbation' units (defined by the parameter <tt>PTBLOS</tt> in
file <tt>rfmcon.inc</tt>) are 0.001 of the units in the <a href=#tan>*TAN</a>
section, i.e., 0.001*km or 0.001*deg (if using <tt>*ELE</tt> instead
of <tt>*TAN</tt>)
<li> Each nominal spectral file
(<a href=#spectra>Appendix D</a>), e.g. <tt>rad_a08000.asc</tt> will then
have an associated Jacobian file, e.g. <tt>rad_a08000_los.asc</tt>,
the string "<tt>_los</tt>" being inserted into the filename immediately
following the tangent height identification.
</ol>
</dl>
<hr>
<a name=lunflg> 
<h3> LUN - Re-cycle Logical Unit Numbers for output spectra </h3>
<dt> <b>Enabled</b>
<dd> Use same LUN for all output spectra of each type (Radiance,
transmission, etc) by opening/closing files after writing data for each
widemesh interval
<dt> <b> Disabled </b>
<dd> Use individual LUNs for all output spectra, maintained `open' throughout.
<dt> <b> Restrictions </b>
<dd> None.
</dl>
<hr>
<a name=lutflg> 
<h3> LUT - Use Look-Up Tables for Absorption Coefficient </h3>
<dt> <b>Enabled</b>
<dd> Use pre-tabulated data for evaluate the 
     absorption coefficient k(p,T) for each Curtis-Godson path
<dd> Read <a href=#lutfil><tt>.lut</tt></a> filenames from
<a href=#lut>*LUT</a> section of driver table
<dt> <b> Disabled </b>
<dd> Calculate absorption coefficients using line-by-line method.
<dd> <a href=#lut>*LUT</a> section of driver table ignored
<dt> <b> Restrictions </b>
<dd>  Incompatible with <a href=#nteflg>NTE Flag</a>
</dl>
<hr>
<a name=mixflg> 
<h3> MIX - Include Line-mixing </h3>
<dt> <b>Enabled</b>
<dd> Include line-mixing for any CO2 lines for which pretabulated data exists.
<dd> Calculated ranges may be expanded to include entire affected bands
<dt> <b> Disabled </b>
<dd> Ignore line mixing
<dt> <b> Restrictions </b>
<dd>	None
</dl>
<hr>
<a name=mtxflg> 
<h3> MTX - Produce inter-level matrix of flux calculations
(RFM <a href=rfm_upgrades.html#v410>v4.10</a> onwards)</h3>
<dt> <b>Enabled</b>
<dd> Produce interval flux transmittances and absorptions 
(<a href=#traflg>TRA</a> and <a href=#absflg>ABS</a> Flags)
<dd> Produce sensitivies of net fluxes and cooling rates to layer source
functions (<a href=#radflg>RAD</a> and <a href=#cooflg>COO</a> Flags
respectively).
<dd> 
<dt> <b> Disabled </b>
<dd> See basic <a href=#flxflg>FLX</a> Flag operation
<dt> <b> Restrictions </b>
<dd> <a href=#flxflg>FLX</a> flag must be enabled
<DD> (In addition to <a href=#flxflg>FLX</a> Flag incompatibilities)
incompatible with 
<a href=#jacflg>JAC</a>, 
<a href=#levflg>LEV</a>, 
<a href=#losflg>LOS</a>, 
<a href=#nadflg>NAD</a> and 
<a href=#zenflg>ZEN</a>
Flags 
<dt> <b> Notes </b>
<dd> 
<ol> 
<li> The use is best explained by an example: if the driver table contains
the following flags:
<pre>
*FLG
     COO FLX MTX RAD SFC TRA
</PRE>
and the <a href=#tan>*TAN</a> (or *LEV) section of the driver table contains
<pre>
*LEV
     10 20 30
</pre>
then the following files are generated: <br>
  <dl>
  <dt><tt>coo_10000.asc, coo_20000.asc, coo_30000.asc</tt>
  <dd> Contain the cooling rates at 10, 20, 30km (as would have been
       generated without the MTX flag)
  <dt><tt>coo_10000_10000.asc, coo_10000_20000.asc ... coo_30000_30000.asc</tt>
       (9 files)
  <dd> File <tt>coo_i_j.asc</tt> contains the change in cooling rate at 
<i>level</i> <tt>i</tt> for a 1% increase in source function in <i>layer</I>
<tt>j</tt> (meaning: the user-defined profile layer with 
base at altitude <i>j</i>).
  <dt> <tt>rad_10000.asc, rad_20000.asc, rad_30000.asc</tt>
  <dd> Contain the net fluxes at 10, 20, 30km (as would have been generated
       without the MTX flag)
  <dt> <tt>rad_10000_10000.asc, rad_10000_20000.asc ... rad_30000_30000.asc</tt>
       (9 files)
  <dd> File <tt>rad_i_j.asc</tt> contains change in net flux at <i>level</i>
<tt>i</tt> for a 1% increase in source function in <i>layer</i> <tt>j</tt>.
  <dt>  <tt>tra_10000.asc, tra_20000.asc, tra_30000.asc</tt>
  <dd> Just contain zeroes (consider these a `feature' of the RFM when run in
       this mode). However, from <a href=rfm_upgrades.html#v425>v4.25</a> onwards
       these spectra contain the absorption coefficient (/cm3) which can be used,
       in conjunction with the flux transmittances, to calculate Escape Functions.
  <dt>  <tt>tra_10000_10000.asc, tra_10000_20000.asc ... tra_30000_30000.asc</tt>
       (9 files)
  <dd> File <tt>tra_i_j.asc</tt> contains the flux transmittance between
<i>level</i> <tt>i</tt> and <i>level</i> <tt>j</tt> 
(consequently <tt>tra_i_i.asc</tt> contains 1's,
and <tt>tra_i_j.asc</tt> = <tt>tra_j_i.asc</tt>).
  </dl>
 
</ol>
</dl>
<hr>
<a name=nadflg> 
<h3> NAD - Use Nadir Viewing for plane-parallel atmosphere  </h3>
<dt> <b>Enabled</b>
<dd> Calculate spectra viewing downwards into a plane parallel atmosphere

<dd><a href=#tan>*TAN</a> section of Driver Table specifies airmass factor for
 calculation (eg, 1.0=vertical, 2.0= 60 deg to vertical in a plane, parallel
 atmosphere).
<dt> <b> Disabled </b>
<dd> Assume limb view (or homogeneous/zenith calculation
if <a href=#homflg>HOM</a>/<a href=#zenflg>ZEN</a> Flags enabled).
<dt> <b> Restrictions </b> 
<dd> Incompatible with 
<A href=#crvflg>CRV</a>, 
<a href=#fovflg>FOV</a>, 
<a href=#geoflg>GEO</a>, 
<A href=#graflg>GRA</a>, 
<A href=#homflg>HOM</a>, 
<A href=#losflg>LOS</a>, 
<a href=#tabflg>TAB</a>,
and <A href=#zenflg>ZEN</a> Flags. 
<DD> <A HREF=#sfcflg>SFC</a> Flag must also be enabled.
<dt> <b>Notes</b>
<dd> Use of <a href=#flxflg>FLX</a> Flag redefines NAD flag.
</dl>
<hr>
<a name=newflg> 
<h3> NEW - Open output files as `NEW' </h3>
<dt> <b>Enabled</b>
<dd> Avoid overwriting existing files by opening all output files with 
     <TT>STATUS='NEW'</tt>. If file already exists:
	<ul>
	<li> DEC: creates a new file generation.
	<li> UNIX: leads to a fatal error 
	</ul>
<dt> <b> Disabled </b>
<dd> Overwrite existing files by opening all output files with 
	<TT>STATUS='UNKNOWN'</TT>.
<dt> <b> Restrictions </b> 
<dd> None.
</dl>
<hr>
<a name=nteflg> 
<h3> NTE Flag - Use Non-LTE Calculations </h3>
<dt> <b>Enabled</b>
<dd> Use vibrational temperature profiles for transitions specified in the
    <A href=#nte><tt>*NTE</tt></a> section of the Driver Table.
<dt> <b> Disabled </b>
<dd> Use LTE calculation throughout (kinetic temperature profile).
<dd> <A href=#nte><tt>*NTE</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd>  Incompatible with <a href=lutflg>LUT Flag</a>
</dl>
<hr>
<a name=obsflg> 
<h3> OBS Flag - Observer within atmosphere </h3>
<dt> <b>Enabled</b>
<dd> Read Observer altitude from <a href=#obs><tt>*OBS</tt></a> 
section of the Driver
Table. 
<dd> Allows option of specifying ray paths (<a href=#tan><tt>*TAN</tt></a> section)
and/or FOV shape (<a href=#fovfil><tt>.fov</tt></a> file)  in terms of
elevation angles instead of tangent heights.
<dt> <b> Disabled </b>
<dd> Observer assumed outside atmosphere
<dd> <A href=#obs><tt>*OBS</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#homflg>HOM</a> and <a href=#tabflg>TAB</a>
Flags.
<dt> <b> Notes</b> 
<DD> See <a href=#levflg>LEV</a> flag for a method of generating spectra
at multiple observer altitudes within a single run
</dl>
<hr>
<a name=optflg> 
<h3> OPT Flag - Write Optical Depth spectra </h3>
<dt> <b>Enabled</b> 
<dd> Create <A href=#optfil><tt>.opt</tt></a> filescontaining optical depth
	spectra. 
<dd> If <A href=#opt><tt>*OPT</tt></a> section exists in Driver Table, read
	user-defined      filename template, otherwise use default filenames. 
<dt> <b> Disabled </b>   
<dd> No optical depth spectra written
<dd> <A href=#opt><tt>*OPT</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> Incompatible with 
<A href=#avgflg>AVG</a>, 
<A href=#fovflg>FOV</a>, 
<A href=#ilsflg>ILS</a>
and <a href=#tabflg>TAB</a> Flags.
<dt> <b> Notes </b>
Incompatible with the convolution flags since convolution of
optical depth is not a physically meaningful quantity. Convolution of
absorption, =ln(optical depth), is the nearest equivalent (<a
href=#absflg>ABS</a> flag).
</dl>
<hr>
<a name=prfflg> 
<h3> PRF Flag - Write out Internal Profile 
(<a href=rfm_upgrads.html#v425>v4.25</a> onwards)</h3>
<dt><b>Enabled</b>
<dd> Create <A href=#prffil><tt>.prf</tt></a> files containing internal
profile(s) (same format as <A href=#atmfil><tt>.atm</tt></a> input files).
For 1D calculations this is a single file, for 2D calculations 
(<a href=#graflg>GRA</a> flag) a separate
file is written for every specified horizontal angle.

<dd> If <A href=#prf><tt>*PRF</tt></a> section exists in Driver Table, read 
	user-defined 
     filename template otherwise use default filenames.
<dt> <b> Disabled </b>
<dd> Internal Profile not written out.
<dt> <b> Restrictions </b> 
<dd> None
</dl>
<hr>
<a name=qadflg> 
<h3> QAD Flag - Quadratic Interpolation of Line Wings </h3>
<dt><b>Enabled</b>
<dd> Use simple quadratic interpolation (GENLN2-like) 
to model line wings on fine grid.
<dt> <b> Disabled </b>
<dd> Use inverse quadratic (Lorentzian shape) 
interpolation to model line wings on fine grid
<dt> <b> Restrictions </b> 
<dd> None.
</dl>
<hr>
<a name=pthflg> 
<h3> PTH Flag - Write Ray Path Diagnostics </h3>
<dt><b>Enabled</b>
<dd> Create <A href=#pthfil><tt>.pth</tt></a> files containing ray path diagnostics.
<dd> If <A href=#pth><tt>*PTH</tt></a> section exists in Driver Table, read 
	user-defined 
     filename template otherwise use default filenames.
<dt> <b> Disabled </b>
<dd> No path diagnostics written.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#tabflg>TAB</a> Flag.
</dl>
<hr>
<a name=qadflg> 
<h3> QAD Flag - Quadratic Interpolation of Line Wings </h3>
<dt><b>Enabled</b>
<dd> Use simple quadratic interpolation (GENLN2-like) 
to model line wings on fine grid.
<dt> <b> Disabled </b>
<dd> Use inverse quadratic (Lorentzian shape) 
interpolation to model line wings on fine grid
<dt> <b> Restrictions </b> 
<dd> None.
</dl>
<hr>
<a name=radflg> 
<h3> RAD Flag - Write Radiance Spectra </h3>
<dt> <b>Enabled</b>
<dd> Create <A href=#radfil><tt>.rad</tt></a> files containing radiance spectra.
<dd> If <A href=#rad><tt>*RAD</tt></a> section exists in Driver Table, read user-defined 
     filename template, otherwise use default filenames.
<dt> <b> Disabled </b>
<dd> No radiance spectra written
<dd> <A href=#rad><tt>*RAD</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#tabflg>TAB</a> Flag.
</dl>
<hr>
<a name=rejflg> 
<h3> REJ Flag - Implement Line Rejection </h3>
<dt> <b>Enabled</b>
<dd> Reject lines with adjusted strengths weaker than user-specified limits
    from <a href=#rej><tt>*REJ</tt></a> section of Driver Table. 
<dt> <b> Disabled </b>
<dd> All lines included in calculations
<dd> <A href=#rej><tt>*REJ</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> None
</dl>
<hr>
<a name=sfcflg> 
<h3> SFC Flag - Specify Surface Characteristics </h3>
<dt> <b>Enabled</b>
<dd> Read surface temperature and emissivity from 
<a href=#sfc><tt>*SFC</tt></a> section of the Driver Table.
<dd> Allows rays paths which intersect (and reflect from) the surface
<dt> <b> Disabled </b>
<dd> Ignore <a href=#sfc><tt>*SFC</tt></a> section of the Driver Table.
<dd> Only allow paths with tangent points within the atmosphere
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#tabflg>TAB</a> and 
<a href=#zenflg>ZEN</a> Flags.
<dt> <b> Bugs </b>
<dd> <a href=rfm_bugs.html#bug10>Bug#10</a> 
(fixed <a href=rfm_upgrades.html#v410>v4.10</a>)
<dd> <a href=rfm_bugs.html#bug6>Bug#6</a> 
(fixed <a href=rfm_upgrades.html#v404>v4.04</a>)
<dd> <a href=rfm_bugs.html#bug1>Bug#1</a> 
(fixed <a href=rfm_upgrades.html#v401>v4.01</a>)
<dt> <b> Notes </B>
<ol>
<li> Surface reflections are treated as specular by default, but
Lambertian if the <a href=#flxflg>FLX</a> flag is enabled.
</ol>
</dl>
<hr>
<a name=shpflg> 
<h3> SHP Flag - Use non-Voigt Line Shapes </h3>
<dt> <b>Enabled</b>
<dd> Use non-Voigt lineshapes defined in <A href=#shp><tt>*SHP</tt></a> section of 
     Driver Table for some or all molecules.
<dt> <b> Disabled </b>
<dd> Use default (Voigt) lineshape for all molecules
<dd> <A href=#shp><tt>*SHP</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> None.
</dl>
<hr>
<a name=tabflg> 
<h3> TAB Flag - Write Absorption Coefficient Tables </h3>
<dt> <b>Enabled</b>
<dd> Create <A href=#tabfil>.tab</a> files containing absorption coefficient
tables [m^2/mole]
<dd> Interpret <a href=#tan><tt>*TAN</tt></a> section as tabulation axes.
<dd> If <A href=#tab><tt>*TAB</tt></a> section exists in Driver Table, read user-defined 
     filename template, otherwise use default filenames.
<dd> If <a href=#grdflg>GRD</a> Flag is enabled, output absorption
coefficients on irregular grid (<a href=rfm_upgrades.html#v410>RFM v4.10</a>
onwards), otherwise full, regular grid.
<dt> <b> Disabled </b>
<dd> No absorption coefficient tables produced.
<dd> <A href=#tab><tt>*TAB</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> Incompatible with
<a href=#absflg>ABS</A>, 
<a href=#avgflg>AVG</A>, 
<a href=#crvflg>CRV</A>, 
<a href=#dblflg>DBL</A>, 
<a href=#fovflg>FOV</A>, 
<a href=#geoflg>GEO</A>,
<a href=#graflg>GRA</A>,
<a href=#ilsflg>ILS</A>, 
<a href=#levflg>LEV</A>, 
<a href=#losflg>LOS</A>, 
<a href=#nadflg>NAD</A>, 
<a href=#obsflg>OBS</A>, 
<a href=#optflg>OPT</A>, <a href=#pthflg>PTH</A>, 
<a href=#radflg>RAD</A>, 
<a href=#sfcflg>SFC</A>, 
<a href=#traflg>TRA</A>
and <a href=#zenflg>ZEN</A>
Flags.
Incompatible with <a href=#grdflg>GRD</A> Flag prior to
<a href=rfm_upgrades.html#v410>RFM v4.10</a>.
<dt><b>Notes</b>
<OL>
<LI> To create tables for different isotopes, you can either
  <UL>
  <LI> perform separate RFM
calculations with different single
isotopes specified in the <a href=#gas>*GAS</a> section (output files will all
have the same default filename and no internal information on the isotope
  <LI> perform a single RFM run, speficying different profiles for each isotope
      in the files in the <a href=#atm>*ATM</a> section. In this case the
      output filenames and internal information are also modified.
  </UL>
The second method is recommended.
</ol>
</dl>
<hr>
<a name=tpsflg> 
<h3> TPS Flag - Use Tabulated TIPS Data (RFM <a href=rfm_upgrades.html#v422>v4.22</a>
onwards) </h3>
<dt> <b>Enabled</b>
<dd> Read in <a href=#tpsfil><tt>.tps</tt></a> files listed in the 
<A href=#tps>*TPS</a> 
section of the driver table containing 
tabulated TIPS data 
<dd> Calculate partition sums by linear interpolation in temperature
from these tables
<dt> <b> Disabled </b>
<dd> <a href=#tps>*TPS</a> section ignored
<dd> Calculate partition sums using polynomial approximations
<dt> <b> Restrictions </b> 
<dd> none
</dl>
<hr>
<a name=traflg> 
<h3> TRA Flag - Write Transmission Spectra </h3>
<dt> <b>Enabled</b>
<dd> Create <A href=#traflg>.tra</a> files containing transmission spectra.
<dd> If <A href=#tra><tt>*TRA</tt></a> section exists in Driver Table, read user-defined 
     filename template, otherwise use default filenames.
<dt> <b> Disabled </b>
<dd> No transmission spectra written
<dd> <A href=#tra><tt>*TRA</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#tabflg>TAB</a> Flag.
</dl>
<hr>
<a name=vrtflg> 
<h3> VRT Flag - Flux type calculations without solid-angle integration </h3>
<dt> <b>Enabled</b>
<dd> Suppress solid-angle integration in flux calculations 
(<A href=#flxflg>FLX</a> enabled)
<dt> <b> Disabled </b>
<dd> <A href=#flxflg>FLX</a> flag includes solid-angle integration
<dt> <b> Restrictions </b> 
<dd> <a href=#flxflg>FLX</a> Flag must be enabled, incompatible with
<A href=#cooflg>COO</a> flag.
<dt> <b> Notes </b>
<dd> The main purpose of this flag is to allow multiple vertical path
calculations to different atmosphere levels within the same driver table instead
of using different driver tables with the <a href=#obsflg>OBS</a> flag used to
set the observer altitude at each level. For example, to calculate the
(vertical) 
radiance from the top of the atmosphere down to 25km one could either use
<pre>
*FLG
    ZEN RAD OBS ! observer looking upwards at downwelling radiance
...
*TAN
    1.0     ! defines vertical path
...
*OBS
   25.0     ! observer at 25km 
...
*END
</PRE>
or one could get the same answer using
<pre>
*FLG
    ZEN RAD FLX VRT ! flux-type calc of downwelling radiance without solid-angle
...
*TAN (or *LEV)
  25.0      ! output at 25km
...
*END
</pre>
The advantage of the second approach is that multiple output levels can be
selected by adding more numbers in the *TAN section
</dl>
<hr>
<a name=vvwflg> 
<h3> VVW Flag - Apply Van Vleck-Weisskopf Correction to Lineshapes
(RFM <a href=rfm_upgrades.html#v423>v4.23</a> onwards) </h3>
<dt> <b>Enabled</b>
<dd> Apply VVW correction term to line-by-line calculations
(unless already calculated using VVW lineshape - see <a href=#shp>*SHP</a>
section)
<dt> <b> Disabled </b>
<dd> Normal lineshapes
<dt> <b> Restrictions </b> 
<dd> None.
</dl>
<hr>
<a name=widflg> 
<h3> WID Flag - Write Widemesh Diagnostics </h3>
<dt> <b>Enabled</b>
<dd> Create <A href=#widfil><tt>.wid</tt></a> files containing widemesh diagnostics for
     each spectral range.
<dd> If <A href=#wid><tt>*WID</tt></a> section exists in Driver Table, read user-defined 
     filename template, otherwise use default filenames.
<dt> <b> Disabled </b>
<dd> No widemesh diagnostics written
<dd> <A href=#wid><tt>*WID</tt></a> section ignored.
<dt> <b> Restrictions </b> 
<dd> None.
<Dt><b> Bugs</b>
<dd> <a href=rfm_bugs.html#bug5>Bug#5</a>
(fixed <a href=rfm_upgrades.html#v404>v4.04</a>)
</dl>
<hr>
<a name=wngflg> 
<h3> WNG Flag - Use Far-wing Cutoff for lines </h3>
<dt> <b>Enabled</b>
<dd> Only include lines within 200 Voigt halfwidths of grid points within
fine-mesh calculation
<dt> <b> Disabled </b>
<dd> Include all lines within adjacent widemesh intervals
<dt> <b> Restrictions </b> 
<dd> Incompatible with <a href=#grdflg>GRD</a> Flag.
<dt> <b> Notes</b>
<dd> The WNG flag only affects the fine-mesh calculation. The wide-mesh
calculation is fixed to includes lines up to +/- 25cm-1 for compatibility
with the H2O continuum definition. If you need to change this,
alter the parameter <tt>FWIND</tt> in <tt>RFMCON.INC</tt>
</dl>
<hr>
<a name=zenflg> 
<h3> ZEN - Use Zenith Viewing ray paths </h3>
<dt> <b>Enabled</b>
<dd> Calculate vertical downward sky radiance, as viewed at the surface.
<dd> <a href=#tan><tt>*TAN</tt></a> section of Driver Table specifies airmass
     factor for calculation (eg, <tt>1.0</tt>=vertical, <tt>2.0</tt>=
     60 deg to vertical in a plane, parallel atmosphere).
<dt> <b> Disabled </b>
<dd> Assume limb view (or homogeneous/nadir calculation
if <a href=#homflg>HOM</a>/<a href=#nadflg>NAD</a> Flags enabled).
<dt> <b> Restrictions </b> 
<dd> Incompatible with 
<A href=#crvflg>CRV</a>, 
<a href=#fovflg>FOV</a>, 
<a href=#geoflg>GEO</a>, 
<a href=#graflg>GRA</a>, 
<A href=#homflg>HOM</a>, 
<A href=#losflg>LOS</a>, 
<A href=#nadflg>NAD</a>, 
<a href=#sfcflg>SFC</a> and <a href=#tabflg>TAB</a> Flags.
<dt> <b> Notes </b>
<dd> Use of <A href=#flxflg>FLX</a> Flag redefines ZEN flag.
</dl>
<hr>
<a name=formats>
<h2> APPENDIX C: RFM FILE FORMATS </h2>

The Driver Table (<tt>.drv</tt> file) is described
in <a href=#driver>section 6</a>, and the Runlog (<tt>.runlog</tt> file) is
described in <a href=#runlog>section 8</a>. The binary data 
(<tt>.hit</tt> file) <a href=#edwards>(Edwards, 1992)</a>, the 
Molecular Cross-Section data (<tt>.xsc</tt> file) <a href=#rothman>(Rothman,
1992)</a>, and the MIPAS Irregular grids (<tt>.grd</tt>) and
Look-Up Tables (<tt>.lut</tt> files)
are not RFM-specific files, and are described elsewhere.
	<dl>
	<dt> <tt><a href=#absfil>.abs</a>  </tt> Absorption Spectrum (Output)
	<dt> <tt><a href=#atmfil>.atm</a>  </tt> Atmospheric Profiles (Input)
	<dt> <tt><a href=#bbtfil>.bbt</a>  </tt> Brightness Temperature
	                                         Spectrum (Output)
	<dt> <tt><a href=#coofil>.coo</a>  </tt> Cooling Rate Spectrum (Output)
	<dt> <tt><a href=#drvfil>.drv</a>  </tt> Driver Table (Input)
	<dt> <tt><a href=#fovfil>.fov</a>  </tt> Field-of-View data  (Input)
	<dt> <tt><a href=#gasfil>.gas</a>  </tt> List of Absorbers (Input)
	<dt> <tt><a href=#grdfil>.grd</a>  </tt> Irregular Grid (Input)
	<dt> <tt><a href=#hitfil>.hit</a>  </tt> HITRAN binary file (Input)
	<dt> <tt><a href=#ilsfil>.ils</a>  </tt> Instrument Line Shape (Input)
	<dt> <tt><a href=#lutfil>.lut</a>  </tt> Look-Up Table (Input)
	<dt> <tt><a href=#ntefil>.nte</a>  </tt> Non-LTE data (Input)
	<dt> <tt><a href=#optfil>.opt</a>  </tt> Optical Depth Spectrum (Output)
	<dt> <tt><a href=#prffil>.prf</a>  </tt> Internal Profile (Output)
	<dt> <tt><a href=#pthfil>.pth</a>  </tt> Path Diagnostics (Output)
	<dt> <tt><a href=#radfil>.rad</a>  </tt> Radiance Spectrum (Output)
	<dt> <tt><a href=#runlog>.runlog</a>  </tt> Runlog (Output)
	<dt> <tt><a href=#spcfil>.spc</a>  </tt> Spectral Ranges (Input)
	<dt> <tt><a href=#tabfil>.tab</a>  </tt> Tabulated Absorp.Coeffs (Output/Input)
	<dt> <tt><a href=#tanfil>.tan</a>  </tt> List of Tangent Heights (Output) 
	<dt> <tt><a href=#tpsfil>.tps</a>  </tt> Tabulated TIPS data (Input) 
	<dt> <tt><a href=#trafil>.tra</a>  </tt> Transmission Spectrum (Output)
	<dt> <tt><a href=#widfil>.wid</a>  </tt> Widemesh Diagnostics (Output)
	<dt> <tt><a href=#xscfil>.xsc</a>  </tt> Cross Section data (Input)
	</DL>
</ul>
<hr>
<a name=absfil>
<h3> .abs FILE: Absorption Spectrum </h3>

<dl>
<dt><b>Type</b>
<DD> Output(s), if <a href=#absflg>ABS</a> Flag is enabled.
<dd> One file created per tangent height per spectral range

<dt><b>Description</b>
<dd> Absorption spectrum.

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#abs><tt>*ABS</tt></a> section of the Driver Table.
<dd> Default is <tt>abs_*.asc</tt> (ASCII) or <tt>abs_*.bin</tt> (Binary).

<dt><b>Format</b>
<dd> See <a href=#spectra>Appendix D</a>

<dt><b>Example</b>
<dd><pre>
! Absorption calc. for Tangent Hgt=   40.000 [km] by RFM v.4.00
!14-JUL-96 RFM code test
!No.Pts  Lower_Wavenumber   Delta_Wavenumber  Upper_Wavenumber  Label
     81  952.000000000000 0.0250000000000000  954.000000000000 'Absorption'
 8.0286446E-07  8.5045428E-07  9.0240422E-07  9.5926384E-07  1.0216717E-06
 1.0903740E-06  1.1662465E-06  1.2503228E-06  1.3438297E-06  1.4482325E-06
 1.5652920E-06  1.6971395E-06  1.8463758E-06  2.0161972E-06  2.2105730E-06
  ... etc
[eof]
</pre>
</dl>
<hr>
<a name=atmfil>
<h3> .atm FILES: Atmospheric Profiles </h3>
<dl>
<dt><b>Type</b>
<dd> Mandatory Input(s)
<dt><b>Description</b>
<dd> Profiles of Height [km], Pressure [mb], Temperature [K], VMRs [ppmv]
and extinction [km-1].
<dt><b>Filename(s)</b>
<dd>Specified in <a href=#atm><tt>*ATM</tt></a> section of Driver Table
<dt><b>Format</b>
<dd><pre>
! comments
NLEV      
! comments
*PRF1
DAT1(1) DAT1(2) ...
              ... DAT1(NLEV)
! comments
*PRF2
DAT2(1) DAT2(2) ...
              ... DAT2(NLEV)
! comments
*PRF2(ISO1)
DAT2(1) DAT2(2) ...
              ... DAT2(NLEV)
...
*END
</PRE>
<dt><b>Fields</b>
	<dl>
	<dt><tt>NLEV</tt> (Integer)
	<dd>Number of profile levels. Allowed range 2:<TT>MAXATM</TT>
           (<TT>MAXATM=100</TT> set in <tt>rfmsiz.inc</tt>), or 1 if 
            homogeneous path calculation specified.
	<dt><tt>*PRF</tt> (Character)
	<DD>Profile type. Accepted values <TT>PRF1 = `*HGT'</TT>, 
           <TT>PRFn=`*PRE'</TT>, 
	    <TT>`*TEM'</TT>, and <tt>*ggg</tt> where <tt>ggg</tt> is an absorber
            specified in the <a href=#gas><tt>*GAS</tt></a> section. For anything else,
            the profile is ignored.
	<DD>Optional Isotope identification (Character) (v4.2 onwards). Accepted values
             `<TT>(1)</TT>' ... `<TT>(n)</TT>' where n is the number of listed isotopes
            for the species (see subroutine <tt>gasiso.for</tt> for list of isotopes).
	<dt><tt>DAT(NLEV)</tt> (Real Array)
	<dd>Profile values. 
	<dt><tt>*END</tt> (Character)
	<DD> End-of-file marker, value = `<TT>*END</TT>' (Optional).
	</dl>
<dt><b>Notes</b>
<ol>
<li> The first profile type in each file must be `<tt>*HGT</tt>'. 
<li> The first height profile of the first file specifies the RFM internal
     profile representation to which all subsequent profiles are interpolated.
     This also defines the upper level of the atmosphere.
<li> Subsequent profiles (after the height profile)
     will replace any previously loaded data of the same type 
<li> The header record of each accepted profile is written to the 
     <a href=#runlog><tt>.runlog</tt></a> file, together with notification if this
     replaces an existing profile.
<li> For homogeneous path calculations, the first-specified
     file must have <TT>NLEV=1</tt>.
<li> The RFM uses a definition of VMR=(no.molec.species)/(total no.molec.),
thus VMRs of all gases cannot be greater than 1 (there is a check for this).
Note that there are other definitions of VMR using
either (total molecules of dry air), or (total molecules of other gases) as
the denominator, but these become infinite for paths of, say, pure H2O.
<LI> Isotope abundances are implicity scaled to the total molecule number, 
not expressed in absolute terms (which requires knowing the isotope strength scaling
used in the HITRAN database).
So, for example if isotope#3 is given half the mixing ratio (in ppmv) of the main
molecule, its concentration will be half of its default value had no separate
profile been specified.
<li> Once an isotope# is specified for a molecule, its profile is then treated
as a separate gas so if the default profile is subsequently modified the
isotope profile remains unaffected.
</ol>
<dt><b>Example</b>
<dd> See <a href=rfm_downloads.html#atm>RFM Downloads</a>
<dd><pre>
! Modified CO2 profile using 360 ppmv to 80km, reduced to 250 ppmv at 120km
3  = Number of profile levels
*HGT  [km]
              0.0    80.0   120.0
*CO2  [ppmv]
            360.0   360.0   250.0
*CO2(2) different profile shape for Isotope#2
            360.0   360.0   200.0
*END
[eof]
</PRE>
</dl>
<hr>
<a name=bbtfil>
<h3> .bbt FILE: Brightness Temperature Spectrum </h3>

<dl>
<dt><b>Type</b>
<DD> Output(s), if <a href=#bbtflg>BBT</a> Flag is enabled.
<dd> One file created per output level per spectral range

<dt><b>Description</b>
<dd> Brightness Temperature Spectrum [K]

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#bbt><tt>*BBT</tt></a> section of the Driver Table.
<dd> Default is <tt>bbt_*.asc</tt> (ASCII) or <tt>bbt_*.bin</tt> (Binary).

<dt><b>Format</b>
<dd> See <a href=#spectra>Appendix D</a>

<dt><b>Example</b>
<dd><pre>
! Bright. Temp. calc. for Nadir Path Airmass =    1.000    by RFM v.4.23_10AUG
!10AUG03 BBT calculation
!No.Pts  Lower_Wavenumber   Delta_Wavenumber  Upper_Wavenumber  Label
     11    780.0000000000      0.1000000000    781.0000000000 'Bright. Temp.'
   284.5296       284.3315       284.5350       284.5521       283.9294
   281.1870       283.8128       284.6874       284.8173       284.7411
   284.6458
[eof]
</pre>
</dl>
<hr>
<a name=coofil>
<h3> .coo FILE: Cooling Rate Spectrum </h3>

<dl>
<dt><b>Type</b>
<DD> Output(s), if <a href=#cooflg>COO</a> Flag is enabled.
<dd> One file created per output level per spectral range

<dt><b>Description</b>
<dd> Cooling Rate spectrum [K/day/cm-1]

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#coo><tt>*COO</tt></a> section of the Driver Table.
<dd> Default is <tt>coo_*.asc</tt> (ASCII) or <tt>coo_*.bin</tt> (Binary).

<dt><b>Format</b>
<dd> See <a href=#spectra>Appendix D</a>

<dt><b>Example</b>
<dd><pre>
 ! Flux Cooling Rate  calc.for Altitude Level =   10.000 km by RFM v.4.10
 ! 24-APR-00 TEST
 !No.Pts  Lower_Wavenumber   Delta_Wavenumber  Upper_Wavenumber  Label
      11    700.0000000000      0.1000000000    701.0000000000 'Cooling Rate'
 -1.4694498E-03 -6.7312585E-04 -1.1123747E-03 -8.7296078E-04 -1.7481288E-02
 -1.6526178E-03 -7.9232298E-02 -2.8422063E-03 -2.4783660E-03 -3.6561102E-04
 -1.5365405E-03
[eof]
</pre>
</dl>
<hr>
<a name=fovfil>
<h3> .fov FILE: Field-of-View Data </h3>
<dl>
<dt><b>Type</b>
<dd> Input, mandatory if <a href=#fovflg>FOV Flag</a> enabled.

<dt><b> Description </b>
<DD>FOV response as a function of altitude 

<dt><b>Filename</b>
<dd>Specified in <a href=#fov><tt>*FOV</tt></a> section of Driver Table.

<dt><b>Format</b>
<dd><pre>
! comments
NPT                
ALT(1)  ALT(2) ...
                   ... ALT(NPT)
FOV(1)  FOV(2) ...
                   ... FOV(NPT)
[eof]
</pre>
<dt><b>Fields</b>
	<dl>
	<DT> <TT>NPT</TT> (Integer)
	<DD> No.of tabulation points for FOV response function. A negative
             value indicates that tabulation is in elevation angle rather than
             altitude.
	<DT> <TT>ALT(NPT)</TT> (Real Array)
        <DD> Altitudes [km] or Elevations [deg] 
             relative to nominal tangent point 
	<DT> <TT>FOV(NPT)</TT>  (Real Array)
	<DD> Field-of-View response function.
	</dl>
<dt><b>Notes</b>
<ol>
<li> There must be at least three tabulation points, of which the first and
last values <tt>FOV(1), FOV(NPT)</TT> must be zero. 
<li> The <tt>FOV</TT> function does not have to be normalised - this is 
     performed within the code.
<li> With the <a href=#fvzflg>FVZ</a> Flag, the altitudes are treated as the
<i>refracted</I> tangent point altitudes so that, in principle, a separate 
FOV function is required for each tangent height (this is to ensure 
compatibility with the OFM handling of the same situation).
Without the FVZ flag, the 
RFM interprets these altitudes as <i>projected</i> tangent points, in which
case distortions due to refraction are automatically considered during the 
ray-tracing.
<li> When specifying an observer altitude (<a href=#obsflg>OBS</a> Flag) any
FOV <i>must</i> be expressed in terms of elevation angle rather than altitude,
since tangent points (and tangent heights of the paths required for the FOV
convolution) can, in principle, vary by large amounts, e.g. right beside the
instrument for a horizontal view. 
<li> Conversely, FOV
expressed as elevation angle can <i>only</i> be used in conjunction with the 
<a href=#obsflg>OBS</a> Flag, since knowledge of the observer altitude is
required to convert the angle into a tangent path.
</ol>
</pre>

<dt><b>Examples</b>
<DD><pre>
! Trapezoidal FOV 2.8km / 4km @ 5 pt resolution
5  = No.tabulation points
    -2.0   -1.4   0.0   1.4   2.0
      0      1     1     1     0
[eof]

! Square(ish) FOV aperture of 2 deg full-width 
 -4  = No.tabulation points, negative implies angular separations in degrees
    -1.01 -1.0 1.0 1.01
      0     1   1   0
[eof]
</pre>
</dl>
<hr>
<a name=gasfil>
<h3> .gas FILE: Gas List </h3>
<dl>
<dt><b>Type</b>
<dd> Optional Input(s)

<dt><b>Description</b>
<DD>List of absorbers for inclusion in RFM calculations 
(alternative to typing each explicitly in the Driver Table).

<dt><b>Filename</b>
<dd>Specified in the  <a href=#gas><tt>*GAS</tt></a> section of the Driver Table.

<dt><b>Format</b>
<dd><pre>
! comments
GAS1 GAS2 ... 
          ... GASn
[eof]
</pre>
<dt><b>Fields</b>
	<dl>
	<dt><TT>GAS</TT> or <tt>GAS(Q1)(Q2)...(QN)</tt> (Character) 
	<DD> Name of molecule. Allowed values listed in 
	     <a href=#gaslist>Appendix E</a>. See <a href=#gas>*GAS</a>
              section for description of qualifiers <TT>(Qi)</tt>
	</dl>
<dt><b>Example</b>
<dd><pre>
! List of MIPAS target species
CO2 H2O CH4 N2O HNO3 O3
</pre>
</dl>
<hr>
<a name=grdfil>
<h3> .grd FILE: Irregular Grid </h3>
<dl>
<dt><b>Type</b>
<dd> Input(s), mandatory if <a href=#grdflg>GRD</A> Flag enabled

<dt><b>Description</b>
<DD>Irregular grid for spectral calculations.

<dt><b>Filename</b>
<dd>Specified in the  <a href=#grd><tt>*GRD</tt></a> section of the Driver Table.

<dt><b>Format</b>
<dd> See <a href=#gosg>PO-TN-OXF-GS-0010</A>
</dl>
<hr>
<a name=hitfil>
<h3> .hit FILE: HITRAN binary-format data </h3>
<dt><b>Type</b>
<dd>Input(s), mandatory if any line molecules requested (unless absorption
coefficients supplied by look-up tables).
<dt><b>Description</b>
<dd> HITRAN data converted into direct-access binary format either by 
GENLN2 program HITLIN or RFM program 
<a href=rfm_downloads.html#hitbin>HITBIN</a>
(binary formats are the same in both cases).
<DT><B>Format</b>
<dd> See <a href=#edwards>Edwards (1992)</a>

<hr>
<a name=ilsfil>
<h3> .ils FILE: Instrument Line Shape </h3>
<dl>
<dt><b>Type</b>
<DD>Input(s), mandatory if <a href=#ilsflg>ILS</a> Flag enabled.

<dt><b>Description</b>
<dd>Tabulated instrument line shape (or apodised ILS)
to be convolved with calculated spectra (performed in spectral space).

<dt><b>Filename(s)</b>
<dd>Specified in <a href=#ils><tt>*ILS</tt></a> section of the Driver Table.

<dt><b>Format</b>
<dd><pre>
! comments
NPT PT1 PTD  [WNOMIN WNOMAX]
ILS(1) ILS(2) ... 
              ... ILS(NPT)            
[eof]
</pre>
<dt><b>Fields</b>
	<dl>
	<DT> <TT>NPT</TT> (Integer)
	<DD> No. of tabulation points. 
        <DD> If negative, spectral information
             interpreted as GHz rather than cm-1 (see Note 7).
        <DD>     Allowed (absolute) range <tt>1:MAXILP</tt> 
	(<tt>MAXILP=2001</tt> initially set in <TT>rfmsiz.inc</tt>).
	<DT> <TT>PT1</TT> (Real)
	<DD> Relative Wavenumber of 1st Point [cm-1] (usually negative)
	<DT> <TT>PTD</TT> (Real). 
	<DD> Wavenumber spacing for tabulation [cm-1] 
	<dt> <tt>WNOMIN</TT> (Real)
	<DD> Lower limit [cm-1] of spectral range for for ILS application 
	     (Optional)
	<dt> <tt> WNOMAX </TT> (Real)
	<DD> Upper limit [cm-1] of spectral range for ILS application (Optional)
	<dt> <tt> ILS(NPT) </TT> (Real Array)
	<DD> ILS function 
	</dl>
<dt><b>Notes</b>
<ol>
<li>It is possible to specify several ILS files for application over different
    spectral ranges (eg MIPAS Bands A, AB, B, C, D).
<li>If <TT>WNOMIN, WNOMAX</TT> are absent, it is assumed the supplied ILS is the
    default function to be applied over any range not fully covered by one of 
    the specific-range ILS functions.
<li>The ILS function does not have to be normalised or symmetric. Internally
    the user-supplied ILS function is linearly interpolated to the fine mesh
    grid (assumed much finer than the ILS structure) and renormalised to unity.
<LI>The maximum ILS width that can be specified is +/- 1 widemesh
interval from the centre (i.e. around 2cm-1 total width if symmetric).
This is because the RFM only retains the spectra from one previous widemesh
interval for convolution. 
<li>When an ILS convolution is specified the calculated spectrum is
extended by up to 1cm-1 
at each end to allow for edge-effects, however the output
is restricted to the original user-defined range.
<LI>From <a href=rfm_upgrades.html#v421>RFM v4.21</a> onwards, it is possible
to concatenate files containing individual ILS shapes into a single file.
<LI>(RFM <a href=rfm_upgrades.html#v423>v4.23</a> onwards) ILS information
may be specified in GHz rather than cm-1 (for compatibility with the
<a href=#ghzflg>GHZ</a> flag) by setting <tt>NPT</tt> negative. In this case
its value is inverted and <tt>PT1,PTD,WNOMIN,WNOMAX</TT> are all assumed to
be in GHz rather than cm-1.

</ol>
<dt><b>Example</b>
<dd><pre>
! Triangular ILS for approximating 0.035 cm-1 halfwidth resolution.
! Npts   Lowest Wno   Del.Wno       Applic.Range: Min  Max  (0=any range).
    3      -0.035      0.035                      685  970       
    0  1  0
[eof]
</pre>
</dl>
<hr>
<a name=lutfil>
<h3> .lut FILE: Look-Up Table </h3>
<dl>
<dt><b>Type</b>
<dd> Input(s), mandatory if <a href=#lutflg>LUT</A> Flag enabled

<dt><b>Description</b>
<DD>Look-up table of absorption coefficients for particular absorber and
spectral range.

<dt><b>Filename</b>
<dd>Specified in the  <a href=#lut><tt>*LUT</tt></a> 
section of the Driver Table.

<dt><b>Format</b>
<dd> See <a href=#svd>PO-TN-OXF-GS-0011</A>
</dl>
<hr>
<a name=ntefil>
<h3> .nte FILE: Non-LTE Data </h3>
<dl>
<dt><b>Type</b>
<DD>Input(s), mandatory if <a href=#nteflg>NTE</a> Flag enabled.

<dt><b>Description</b>
<dd>Vibrational temperatures and partition functions for non-LTE calculations.
<DD> (also rotational temperatures 
from <a href=rfm_upgrades.html#v425>v4.25</a> onwards)

<dt><b>Filename(s)</b>
<dd>Specified in <a href=#nte><tt>*NTE</tt></a> section of the Driver Table.

<dt><b>Format</b>
<dd><pre>
! comments
*** MODEL NSET NGAS NLEV NQPR
JGAS(1), NISO(1) 
JGAS(2), NISO(2) 
... 
JGAS(NGAS) NISO(NGAS)
P(1) P(2)   ...
            ...  P(NLEV)
0     [=ISET for TK]
TK(1) TK(2) ...
            ... TK(NLEV)
! Vibrational Partition functions
[repeat for IQPR = 1, NQPR ]
       JGAS(IGAS) JISO(IISO)
       QV(1,IISO,IGAS) QV(2,IISO,IGAS) ...
                           ... QV(NLEV,IISO,IGAS)
[end repeat for IQPR]
! Vibrational Temperatures
[repeat for ISET = 1, NSET]
       ISET  JGAS(IGAS) JISO(IISO) IVSGQ(ISET) ENERGY(ISET) [ROTID]
       TV(1,ISET), TV(2,ISET) ...
                              ... TV(NLEV,ISET)
[end repeat for ISET]
[eof]
</pre>
<dt><b>Fields</b>
	<dl>
	<DT> <TT>MODEL</TT> (Integer)
	<DD> Model ID, eg 1-6 for FASCODE atmospheres
	<DT> <TT>NSET</TT> (Integer)
	<DD> Number of Vibrational temperature sets in file
	<DT> <TT>NGAS</TT> (Integer)
	<DD> Number of different species in file
	<dt> <tt>NLEV</TT> (Integer)
	<DD> Number of profile levels in file
	<dt> <tt>NQPR</TT> (Integer)
	<DD> Number of vibrational partition function profiles
	<dt> <tt>JGAS(NGAS)</TT> (Integer Array)
	<DD> HITRAN ID for each gas (see <a href=#gaslist>Appendix E</a>)
	<dt> <tt>NISO(NGAS)</TT> (Integer Array)
	<DD> Number of isotopes listed for each gas
	<dt> <tt>P(NLEV)</TT> (Real Array)
	<DD> Pressure [mb] profile
	<dt> <tt>TK(NLEV)</TT> (Real Array)
	<DD> Kinetic Temperature [K] profile from model
	<dt> <tt>JISO(NISO(IGAS))</TT> (Integer Array)
	<DD> Isotope indices for each gas (i.e. <tt>1,2...NISO</tt>)
	<dt> <tt>QV(NLEV,NISO(IGAS),NGAS)</TT> (Real Array)
	<DD> Vibrational Partition Function profile 
	<dt> <tt>ISET</TT> (Integer)
	<DD> No.of Vibrational Temperature profile (range <tt>1:NSET</tt>),
             ISET=0 is used for Kinetic Temperature profile.
	<dt> <tt>IGAS</TT> (Integer)
	<DD> Gas# for current set (range <tt>1:NGAS</tt>)
	<dt> <tt>ISO</TT> (Integer)
	<DD> Isotope# for current set (range <tt>1:NISO(IGAS)</tt>)
        <DT> <TT>IVSGQ</TT> (Integer)
   	<dd> Vibrational Level Global Quantum Number
	<dt> <tt>ENERGY</TT> (Real)
   	<dd> Energy [cm-1] of Vibrational Level
	<dt> <tt>ROTID</TT> (Character, up to C*9, enclosed in quotes)
   	<dd> Optional Rotational Level Local Quantum Identifier
 	<dt> <tt>TV(NLEV,NSET)</tt> (Real Array)
	<dd> Vibrational Temperature [K]
	</dl>
<dt><b>Notes</b>
<ol>
<li>These files are in the same format as GENLN2 non-LTE input data supplied
    by IAA Granada, Spain.
<LI> In normal use, only the vibrational temperatures are supplied since 
rotational LTE is assumed (ROTID is ignored in RFM versions before
<a href=rfm_upgrades.html#v425>v4.25</a>)
<LI> Rotational non-LTE is implemented for particular lines 
if the HITRAN ID (up to C*9) is specified (ROTID). 
<LI> If a purely vibrational temperature is specified for a level (no ROTID
field) this becomes the default for any transitions for which  no rotational
ID is specified.
<LI> A negative value of the vibrational quantum number IVSGQ 
for the upper energy of a transition results in the RFM only calculating
the source function in LTE, while assuming line strength and absorption are
determined by LTE (ie kinetic temperature)
(<a href=rfm_upgrades.html#v425>v4.25</a> onwards)</ol>
<dt><b>Example</b>
<dd><pre>
!  Non-LTE CO2 Vibrational temperatures for US Std.Atmos
***     6     3     1     5     1
        2     1
5.529E+01, 2.871E+00, 2.190E-01, 1.050E-02, 3.200E-04
     0
    216.70, 250.40, 247.00, 198.60, 195.10
!QV   Vibrational Partition functions
     2     1
 1.000331  1.000228  1.000165  1.000171  1.000196
!TV   Vibrational Temperatures
     1     2     1     2    667.3801
210.000   201.750   195.000   195.750   198.500
     2     2     1     3   1285.4087
210.000   201.750   194.929   195.731   198.488
     3     2     1     4   1335.1317
221.986   225.341   227.785   229.493   231.004  
[eof]
</pre>
</dl>
<hr>
<a name=optfil>
<h3> .opt FILE: Optical Depth Spectrum </h3>

<dl>
<dt><b>Type</b>
<DD> Output(s), if <a href=#optflg>OPT</a> Flag is enabled.
<dd> One file created per tangent height per spectral range

<dt><b>Description</b>
<dd> Optical Depth spectrum.

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#opt><tt>*OPT</tt></a> section of the Driver Table.
<dd> Default is <tt>opt_*.asc</tt> (ASCII) or <tt>opt_*.bin</tt> (Binary).

<dt><b>Format</b>
<dd> See <a href=#spectra>Appendix D</a>

<dt><b>Example</b>
<dd><pre>
! Optical Depth calc. for Tangent Hgt=   40.000 [km] by RFM v.4.00
!14-JUL-96 RFM code test
!No.Pts  Lower_Wavenumber   Delta_Wavenumber  Upper_Wavenumber  Label
     81  952.000000000000 0.0250000000000000  954.000000000000 'Optical Depth'
 8.0285503E-07  8.5044417E-07  9.0239359E-07  9.5925247E-07  1.0216597E-06
 1.0903614E-06  1.1662329E-06  1.2503083E-06  1.3438142E-06  1.4482159E-06
  ... etc
[eof]
</pre>
</dl>
<hr>
<a name=prffil>
<h3> .prf FILE: Internal Profile used in RFM calculations </h3>
<DL>
<DT><B>Type</b>
<DD> Output(s), if <a href=#prf>PRF</a> flag enabled.

<DT><B>Description</b>
<DD> For a 1D calculation a single file is created, for 2D calculations
(<a href=#graflg>GRA</a> flag enabled) a separate file is written for each
specified horizontal angle.

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#prf><tt>*PRF</tt></a> section of the Driver Table
<dd> Default is <tt>prf_*.asc</tt>.

<dt><b>Format</b>
<DD>
Same as <a href=#atmfil>.atm</a> file, hence can also be used as input
in the <a href=#atm>*ATM</a> section of a subsequent driver table.
</dl>
<hr>
<a name=pthfil>
<h3> .pth FILE: Path Diagnostics (updated in v4.10 onwards, earlier format
in <a href=sum_v3.html#pthfil>v3 SUM</a>)</h3>

<dl>
<dt><b>Type</b>
<DD> Output(s), if <a href=#pth>PTH</a> Flag enabled.
<dd> One file created per ray path specified in <a href=#tan><tt>*TAN</tt></a>
section

<dt><b>Description</b>
<dd> Ray tracing and Curtis-Godson integral diagnostics

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#pth><tt>*PTH</tt></a> section of the Driver Table
<dd> Default is <tt>pth_*.asc</tt>.

<dt><b>Format</b>
<dd><pre>
HEADER1
HEADER2
[ HEADER3 ]
[ HEADER4 ]
NGAS  NSEG1  NSEG2 '= NGas, NSeg1, NSeg2'
GAS(1)
HEADER5
LEV(1)   ALT(1)   ANG(1)   PRE(1)   TEM(1)   VMR(1)   AMT(1)   LEN(1)   FLG(1) 
LEV(2)   ALT(2)   ANG(2)   PRE(2)   TEM(2)   VMR(2)   AMT(2)   LEN(2)   FLG(2)
...
LEV(NSEG1) ALT(NSEG1) ANG(NSEG1) PRE(NSEG1) TEM(NSEG1) VMR(NSEG1) AMT(NSEG1) LEN(NSEG1) FLG(NSEG1)
'Total:' TOTAMT TOTLEN 
[with the <a href=#graflg>GRA</a> Flag, NSEG2 records are then repeated in
reverse order for the upward path of the path extending away from the observer]
GAS(2)
HEADER5
LEV(1)   ALT(1)   ANG(1)   PRE(1)   TEM(1)   VMR(1)   AMT(1)   LEN(1)   FLG(1)
...etc
GAS(NGAS)
...etc
[eof]
</pre>
<dt><b>Fields</b>
	<dl>
	<dt><tt>HEADER1</tt> (Character)
	<dd> Contains ray path identification and RFM version 
	<dt><tt>HEADER2</tt> (Character)
	<dd> Text read from <a href=#hdr><tt>*HDR</tt></a> section of Driver Table
	<dt><tt>HEADER3</tt> (Character - only generated for limb-viewing mode,
	i.e. not with <a href=#homflg>HOM</a>, <a href=#nadflg>NAD</a> or
	<a href=#zenflg>ZEN</a> Flags)
	<DD> Text record containing column headers for data in <TT>HEADER4</TT>
              (see Example below)
        <DT><TT>HEADER4</TT> (Character - produced with <tt>HEADER3</tt>)
	<dd> Values of Refracted Tangent Height, Geometric Tangent Height,
Tangent Point Zenith Angle (90 if true tangent point, otherwise zenith angle at
	the surface or, for upward paths, at the observer),
Local Radius of Curvature, 
Observer Elevation Angle, Observer Altitude, Observer Psi angle.
<dd> Observer info blank if <a href=#obsflg>OBS</a> flag not used.
<dd> Psi angle info blank if <a href=#graflg>GRA</a> flag not used.
	<dt> <tt>NGAS</tt> (Integer)
	<DD> No.of different molecules 
	<DT> <TT>NSEG1</TT> (Integer)
	<DD> No.of path segments for ray on downward path
	<DT> <TT>NSEG2</TT> (Integer)
	<DD> No.of path segments for ray on upward path
	<DT> <TT>GAS</TT> (Character)
	<DD> Name of molecule 
	<dt><tt>HEADER5</tt> (Character)
	<dd> Text record containing column headers for data
	     (`<tt>Lev Zlow[km] ...'</tt> etc, see Example below).
	<dt> <tt>LEV(NSEG)</tt> (Integer Array)
	<dd> Atmospheric Profile Layer# (same for all molecules) 
	<dt> <tt>ALT(NSEG)</tt> (Real Array)
	<dd> Lower altitude of segment (same for all molecules) 
	<dt> <tt>ANG(NSEG)</tt> (Real Array)
	<dd> Either Zenith angle [deg] (<a href=#graflg>GRA</a> Flag disabled)
or Psi angle [deg] (<a href=#graflg>GRA</a> Flag enabled) at the end of the
path segment nearest the observer.
	<dt> <tt>PRE(NSEG)</tt> (Real Array)
	<dd> Curtis-Godson Pressure [mb] 
	<dt> <tt>TEM(NSEG)</tt> (Real Array)
	<dd> Curtis-Godson Temperature [K] 
	<dt> <tt>VMR(NSEG)</tt> (Real Array)
	<dd> Volume Mixing Ratio [ppv] 
	<dt> <tt>AMT(NSEG)</tt> (Real Array)
	<dd> Gas Amount [kmol/cm^2] 
	<dt> <tt>LEN(NSEG)</tt> (Real Array)
	<dd> Path length [km] (same for all molecules) 
        <dt> <tt>FLG(NSEG)</TT> (Integer Array)
	<dd> Flag indicating whether the path was explicitly calculated (=1) 
             (true for all paths with <a href=#clcflg>CLC</a> Flag) or scaled
             from another (=0).
	<dt> <tt>TOTAMT</tt> (Real)
	<dd> Total Gas Amount in path [kmol/cm^2] 
	<dt> <tt>TOTLEN</tt> (Real)
	<dd> Total Path length [km] (same for all molecules) 
	</dl>
<dt><b>Examples</b>
<dd>Limb viewing, co2 and o3
<pre>
! Path diagnostics calculated for Tan Hgt=   5.000 [km] by RFM v.4.09
! 27-APR-00 demo
!  Rfr.Tan   Geo.Tan   Tan.Zen   Tan.Psi   Rad.Crv   Obs.Ele   Obs.Alt   Obs.Psi
!    5.000     6.044    90.000            6367.421
           1          44           0 = NGas, NSeg1, NSeg2
co2
Lev  Zlow[km]  Zen[dg] Temp[K]  Press[mb]  VMR[ppv]   Amt[kmol/cm2] Len.[km] Clc
 49  115.000   79.245  326.069 3.31580E-05 3.79538E-05 1.21510E-13    27.087  1
 48  110.000   79.480  264.033 5.71787E-05 5.21933E-05 3.45144E-13    27.700  1
 47  105.000   79.721  220.677 1.12542E-04 9.11163E-05 1.37424E-12    28.358  1
...etc
  8    7.000   88.332  239.623 3.84607E+02 3.30000E-04 2.40937E-05    37.871  1
  7    6.000   88.641  246.198 4.43279E+02 3.30000E-04 3.53086E-05    49.470  1
  6    5.000   89.041  253.598 5.17799E+02 3.30000E-04 9.69768E-05   119.815  1
                                                Total: 2.47250E-04  1248.007
o3
Lev  Zlow[km]  Zen[dg] Temp[K]  Press[mb]  VMR[ppv]   Amt[kmol/cm2] Len.[km] Clc
 49  115.000   79.245  316.979 3.54397E-05 3.07916E-09 7.04431E-18    27.087  1
 48  110.000   79.480  256.459 6.12180E-05 3.15013E-08 1.52709E-16    27.700  1
 47  105.000   79.721  218.963 1.16757E-04 1.41958E-07 1.89773E-15    28.358  1
...etc
  7    6.000   88.641  246.091 4.42272E+02 4.51605E-08 4.82731E-09    49.470  1
  6    5.000   89.041  253.548 5.17271E+02 3.87587E-08 1.13941E-08   119.815  1
                                                Total: 2.33307E-07  1248.007
[eof]
</pre>
<dd> Limb viewing, co2 only,
<a href=#graflg>GRA</a> Flag enabled (horizontal gradient mode, although no
gradient applied hence down and up paths identical apart from Psi angle)
<pre>
! Path diagnostics calculated for Tan Hgt=   5.000 [km] by RFM v.4.09
!27-APR-00
!  Rfr.Tan   Geo.Tan   Tan.Zen   Tan.Psi   Rad.Crv   Obs.Ele   Obs.Alt   Obs.Psi
!    5.000     6.044    90.000     0.000  6367.421
           1          44          44 = NGas, NSeg1, NSeg2
co2
Lev  Zlow[km]  Psi[dg] Temp[K]  Press[mb]  VMR[ppv]   Amt[kmol/cm2] Len.[km] Clc
 49  115.000   11.091  326.069 3.31580E-05 3.79538E-05 1.21510E-13    27.087  1
 48  110.000   10.856  264.033 5.71787E-05 5.21933E-05 3.45146E-13    27.700  1
 47  105.000   10.615  220.677 1.12542E-04 9.11164E-05 1.37425E-12    28.358  1
...etc
  8    7.000    1.862  239.623 3.84607E+02 3.30000E-04 2.40952E-05    37.873  1
  7    6.000    1.522  246.198 4.43280E+02 3.30000E-04 3.53127E-05    49.476  1
  6    5.000    1.077  253.597 5.17796E+02 3.30000E-04 9.69509E-05   119.784  1
                                                Total: 2.47231E-04  1247.991
  6    5.000    0.000  253.597 5.17796E+02 3.30000E-04 9.69509E-05   119.784  1
  7    6.000   -1.077  246.198 4.43280E+02 3.30000E-04 3.53127E-05    49.476  1
  8    7.000   -1.522  239.623 3.84607E+02 3.30000E-04 2.40952E-05    37.873  0
...etc
 47  105.000  -10.368  220.677 1.12542E-04 9.11164E-05 1.37425E-12    28.358  0
 48  110.000  -10.615  264.033 5.71787E-05 5.21933E-05 3.45146E-13    27.700  0
 49  115.000  -10.856  326.069 3.31580E-05 3.79538E-05 1.21510E-13    27.087  0
                                                Total: 2.47231E-04  1247.991
[eof]
</pre>
<dd> Zenith viewing, co2 only
<pre>
! Path diagnostics calculated for AirMass=   1.000      by RFM v.4.09
! 27-APR-00 demo
           1          49           0 = NGas, NSeg1, NSeg2
co2
Lev  Zlow[km]  Zen[dg] Temp[K]  Press[mb]  VMR[ppv]   Amt[kmol/cm2] Len.[km] Clc
  1    0.000  180.000  285.015 9.55900E+02 3.30000E-04 1.32985E-06     1.000  1
  2    1.000  180.000  278.516 8.46900E+02 3.30000E-04 1.20564E-06     1.000  1
  3    2.000  180.000  272.018 7.48100E+02 3.30000E-04 1.09038E-06     1.000  1
...etc
 47  105.000  180.000  221.063 1.11603E-04 9.05438E-05 2.37295E-13     5.000  1
 48  110.000  180.000  265.192 5.65723E-05 5.18274E-05 6.05628E-14     5.000  1
 49  115.000  180.000  327.066 3.29121E-05 3.78736E-05 2.20778E-14     5.000  1
                                                Total: 1.17960E-05   120.000
[eof]
</pre>
</dl>
<hr>
<a name=radfil>
<h3> .rad FILE: Radiance Spectrum </h3>

<dl>
<dt><b>Type</b>
<DD> Output(s), if <a href=#radflg>RAD</a> Flag is enabled.
<dd> One file created per tangent height per spectral range

<dt><b>Description</b>
<dd> Radiance spectrum [nW/cm^2/st/cm-1], 
or Radiance Flux spectrum [W/m2/cm-1] if <a href=#flxflg>FLX</a> Flag also enabled.
<dt><b>Filename(s)</b>
<dd> Specified in <a href=#rad><tt>*RAD</tt></a> section of the Driver Table.
<dd> Default is <tt>rad_*.asc</tt> (ASCII) or <tt>rad_*.bin</tt> (Binary).

<dt><b>Format</b>
<dd> See <a href=#spectra>Appendix D</a>
<dt><b>Notes</b>
<ol><li>
Radiance units are established by parameter <tt>C1</tt> - 
`First Radiation Constant' - in include module <TT>phycon.inc</tt>.
</ol>
<dt><b>Example</b>
<dd><pre>
! Radiance calc. for Tangent Hgt=   40.000 [km] by RFM v.4.00
!14-JUL-96 RFM code test
!No.Pts  Lower_Wavenumber   Delta_Wavenumber  Upper_Wavenumber  Label
     81  952.000000000000 0.0250000000000000  954.000000000000 'Radiance'
 5.3145241E-02  5.6291815E-02  5.9726570E-02  6.3485809E-02  6.7611739E-02
 7.2153658E-02  7.7169426E-02  8.2727358E-02  8.8908501E-02  9.5809631E-02
 0.1035471      0.1122619      0.1221255      0.1333494      0.1461957
  ... etc
[eof]
</pre>
</dl>
<hr>
<a name=spcfil> 
<h3> .spc FILE: Pretabulated Spectral Ranges </h3>

<DL>
<dt><b>Type</b>
<dd> Input(s), optional.

<dt><b>Description</b> 
<dd> Pretabulated spectral ranges and identifying labels.

<dt><b>Filename(s)</b>
<dd> Specified in <A href=#spc><tt>*SPC</tt></a> section of the Driver Table.

<dt><b>Format</b>
<dd><pre>
! comments
LABEL1  WNOLOW1  WNOUPP1  WNORES1  
LABEL2  WNOLOW2  WNOUPP2  WNORES2
...
LABELn  WNOLOWn  WNOUPPn  WNORESn 
[eof]
</pre>
<dt><b>Fields</b>
<dd> Conforms to <tt>LABREC</tt> record format described in 
	<a href=#spc><tt>*SPC</tt></a> section:
	<dl>
	<dt> <tt> LABEL </tt> (Character)
	<dd> A label for each spectral range which forms part of 
	     the output filename(s). Allowed value: any string up to C*6 
	<dt> <tt> WNOLOW </tt> (Real)
	<DD> Lower wavenumber for range. Allowed range: 
		600-<tt>WNOUPP</TT> cm-1. 
	<dt> <tt> WNOUPP </tt> (Real) 
	<dd> Upper wavenumber for output spectra. Allowed range: 
	<TT>WNOLOW</TT>-2500 cm-1. 
	<dt> <tt> WNORES </tt> (Real)
	<DD> Resolution for output spectra, usually set to 0.0 when used with
             a .spc file.
	</dl>

<dt><b>Notes</b>
<ol>
<li> The Label, converted to lower case, forms part of the output filename.
<li> Labels may be subsequently redefined within the 
<a href=#spc><tt>*SPC</tt></a> section.
<li> The 600-2500 cm-1 wavenumber limits are set in <tt>spcchk.for</tt>.
</ol>

<dt><b>Example</b>
<dd><pre>
! Define microwindows for p,T retrieval
! Just defines labels and ranges - not activated unless a resolution is 
! assigned to the label in a subsequent record in the <tt>*SPC</tt> section 
! Label     Low.Wno  Upp.Wno   0=off   Alt.range
 PT001A     688.1    688.225    0    ! 26-38 km
 PT004B     693.45   693.875    0    ! 50-60 km
 PT005A     695.175  695.275    0    ! 50-60 km
 PT010A     700.0    700.225    0    ! 32-60 km
 PT012A     700.85   701.1      0    ! 26-47 km
 PT025A     715.175  715.375    0    ! 8 -29 km
[eof]
</pre>
</dl>
<hr>
<a name=tabfil>
<h3> .tab FILE: Tabulated Absorption Coefficient File </h3>
<dl>
<dt><b>Type</b>
<dd> Output(s) if <a href=#tabflg>TAB</a> Flag is enabled
<dd> Optional Input(s) if <a href=#lutflg>LUT</a> Flag is enabled 
(input same way as <tt>.lut</tt> files in <a href=#lut>*LUT</a> section).
<dd> One file per spectral range per species

<dt><b>Description</b>
<dd> Absorption Coefficients [m^2/mole] tabulated
as function of -ln(pressure) and temperature.

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#tab><tt>*TAB</tt></a> section of the Driver Table

<dt><b>Format</b>
<dd> <pre>
! comments
IDENTIFIER 
NL NV V1 DV NP P1 DP NT T1 DT         [dimension record]
K(1,1,1)  ... K(NP,1,1)  ... K(NP,NT,1)
...
K(1,1,NV) ... K(NP,1,NV) ... K(NP,NT,NV)
[eof]
</pre>

<dt><b>Fields</b>
	<dl>
	<DT> <TT>IDENTIFIER</TT> (C*15 or C*17 for isotopic files)
	<DD> Microwindow/species/tabulation identification, split into
             three components separated by two blank spaces: (A8,X,I2,X,A3)
             or (A8,X,I2,X,I1,A3) for isotopes.
        <dd> <tt>MWCODE</tt> microwindow label, eg <tt>O3053A</tt>
	<dd> <tt>ID</tt> HITRAN ID for absorber, eg <tt>01</TT> (H2O).
		Allowed values listed in <a href=#gaslist>Appendix E</a>.
        <dd> <tt>ISO</tt> (isotopes only), eg <tt>1</tt> (main isotope) (see
	Note 4)
	<dd> <tt>TAB</tt> Tabulated function of k. 
		Allowed values: <tt>LIN</tt> (k tabulated directly), 
	<tt>LOG</tt> (ln(k) tabulation), or <TT>4RT</TT> (k^(1/4) tabulation).
	Note that files generated as RFM output will have <TT>LIN</TT>.
	<DT> <TT>NL</TT> (Integer)
	<dd> Value=0. (Used as No. of singular values for LUT files, a value 0
             flags this as a <tt>TAB</TT> file containing no SVD compression.)
	<dt> <tt>NV</TT> (Integer)
	<dd> No. of wavenumber grid points in table.
	<dt> <tt>V1</TT> (Real*8)
	<dd> First (lowest) wavenumber grid point [cm-1].
	<dt> <tt>DV</TT> (Real*8)
	<dd> Wavenumber grid increment [cm-1]
	<dt> <tt>NP</TT> (Integer)
	<dd> No. of pressure grid points in table.
	<dt> <tt>P1</TT> (Real)
	<dd> First -ln(p/mb) grid point.
	<dt> <tt>DP</TT> (Real)
	<dd> -ln(p) grid increment 
	<dt> <tt>NT</TT> (Integer)
	<dd> No. of temperature grid points in table.
	<dt> <tt>T1</TT> (Real)
	<dd> First temperature grid point [K].
	<dt> <tt>TV</TT> (Real)
	<dd> Temperature grid increment [K]
	<DT> <TT>K(NP,NT,NV)</TT> (Real)
	<dd> Absorption coefficient k [m^2/mole] (RFM output files), 
           or some function of it (RFM input files)
		according to <tt>TAB</tT> value in <tt>IDENTIFIER</tt>.	
	</dl>
<dt><b>Notes</b>
<ol>
<li> Header format of <tt>.tab</tt> files is similar to LUT files,
but distiguished by the value <tt>NL=0</tt>. 
<li> Each record represents all the (p,T) points for a single wavenumber grid.
In binary format (<a href=#binflg>BIN</a> Flag enabled) each record 
therefore contains <tt>NP*NT</TT> Real values.
<li> The RFM will accept 
either </tt>.tab</tt> files or </tt>.lut</tt> files as input in the 
<TT><a href=#lut>*LUT</a></TT> section. Although the internal handling is
different (<tt>.lut</tt> files are read into memory, <tt>.tab</tt> files are
not) they are equivalent as far as the user is concerned.
point.
<LI> When creating isotopic .tab files (see Note 1 on use of the  
<a href=#tabflg>TAB</a> flag) a separate file is created for each isotopic
profile supplied in the <a href=#atm>*ATM</a> section. These have "iN" where
N is the isotope number, inserted into the output filename (eg a profile
*CH4(2) will result in a .tab filename ...ch4i2...). There will also be a file
"i0" for remaining, unspecified isotopes (which may contain all zeros if
all isotopes were specified - consider this a "feature" of the RFM).
This information is also inserted into the <TT>IDENTIFIER</TT> as a decimal
value after the HITRAN ID, eg "06.2" and "06.0".
<LI> When using .tab files as input to RFM calculations, if no
isotopic profile is specified the RFM will only accept a generic .tab file
for that molecule (eg with the ID " 6" rather than " 6.x"). Conversely,
if isotopic profiles are specified the RFM will only accept .tab files
for that particular isotope (eg with the ID "6.2") and any unspecified 
isotopes will be modelled using the default isotopic file (eg "6.0"). 
<P>
Note: if, for example, you generate .tab files for the first two isotopes
(6.1, 6.2) the remaining isotopes will be included in the file with ID 6.0.
However, if you then use these as input to the RFM specifying only the first
isotope, 6.1, as a separate profile,
 the RFM will incorrectly assume that isotope#2 is included
in the default file 6.0 and ignore the file 6.2.

</ol>
<dt><b>Example</b>
<dd><pre>
 ! o3      Tabulated Absorp.Coeff. created by RFM v.3.42_OXF
 !  TEST
 !NL  NV    V1      DV    NP   P1         DP         NT       T1          DT
O3__0053  3 LIN
 0  2701 1036.0250 0.0005 20  -6.907755   0.727132    8     120.000      30.000
   22.20402       26.26059       26.64072       19.32595       11.47375
   6.571761       3.676178       1.906070      0.9411216      0.4572936
...
[eof]
</pre>
</dl>
<hr>
<a name=tanfil>
<h3> .tan FILE: Tangent Height File </h3>
<dl>
<dt><b>Type</b>
<dd> Input(s), optional

<dt><b>Description</b>
<dd> Pretabulated list of calculation tangent heights

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#tan><tt>*TAN</tt></a> section of the Driver Table,
or in <A href=#jac><tt>*JAC</tt></a> section

<dt><b>Format</b>
<dd> <pre>
! comments
TAN1 TAN2 ... TANn
[eof]
</pre>

<dt><b>Fields</b>
	<dl>
	<DT> <TT>TAN</TT> (Real)
	<DD> Tangent heights [km] or elevation angles [deg].
             See <a href=#tan><tt>*TAN</tt></a> for allowed ranges.
	</dl>

<dt><b>Example</b>
<dd><pre>
! Nominal MIPAS Scan Pattern 8 - 53 km @ 3 km steps
8 11 14 17 20 23 26 29 32 35 38 41 44 47 50 53
[eof]
</pre>
<dt><b>Notes</b>
<ol>
<li> The first record must be a comment (i.e. 1st character <tt>!</tt>)
<li> Maximum of 80 characters per record
<li> There must be a carriage return <tt>&lt;CR&gt;</tt> at the end of the last
record.
</ol>
</dl>
<hr>
<a name=tpsfil>
<h3> .tps FILE: Tabulated Total Internal Partition Sum data</h3>
<dl>
<dt><b>Type</b>
<dd> Input(s), mandatory if <a href=#tpsflg>TPS</a> Flag enabled.

<dt><b>Description</b>
<dd> Tabulated TIPS data for different molecules/isotopes
as a function of temperature

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#tps><tt>*TPS</tt></a> section of the Driver Table.

<dt><b>Format</b>
<dd> <pre>
! comments
GasID#1  IsotopeID#1, NPT#1,  PT1#1, PTD#1
TIPS#1(TEM#1), TIPS#1(TEM#2) .... TIPS#1(TEM#NPT#1)
GasID#2  IsotopeID#2, NPT#2,  PT1#2, PTD#2
TIPS#2(TEM#1), TIPS#2(TEM#2) .... TIPS#2(TEM#NPT#2)
...
[eof]
</pre>

<dt><b>Fields</b>
	<dl>
	<DT> <TT>GasID</TT> (Integer)
	<DD> <a href=#gaslist>HITRAN ID</a> of molecule
	<DT> <TT>IsotopeID</TT> (Integer)
	<DD> Isotope number (HITRAN numbering)
	<DT> <TT>NPT</TT> (Integer)
	<DD> Number of tabulated points
	<DT> <TT>PT1</TT> (Real)
	<DD> Temperature [K] of first tabulated point
	<DT> <TT>PTD</TT> (Real)
	<DD> Temperature tabulation increment [K]
	<DT> <TT>TIPS</TT> (Real)
	<DD> TIPS value at each temperature
	</dl>

<dt><b>Example</b>
<dd><pre>
! H2O TIPS values - first 5 temps only as an example - do not use!
! File: H2O_161.dat
! Molecule#  Isotope#     NTem      Tem1      TemD
         1         1      5         70.0       1.0
   19.98540       20.41787       20.85324       21.29149       21.73261
! File: H2O_181.dat
! Molecule#  Isotope#     NTem      Tem1      TemD
         1         2      5         70.0       1.0
   20.15708       20.59318       21.03220       21.47412       21.91895
[eof]
</pre>
<dt><b>Notes</b>
<ol>
<li> The first record must be a comment (i.e. 1st character <tt>!</tt>)
<li> Further comments can be inserted between data for individual molecules/isotopes
but not within the data records
<li> Files can be simply concatenated 
</ol>
</dl>
<hr>
<a name=trafil>
<h3> .tra FILE: Transmission Spectrum </h3>

<dl>
<dt><b>Type</b>
<DD> Output(s), if <a href=#traflg>TRA</a> Flag is enabled.
<dd> One file created per tangent height per spectral range

<dt><b>Description</b>
<dd> Transmission spectrum.

<dt><b>Filename(s)</b>
<dd> Specified in <a href=#tra><tt>*TRA</tt></a> section of the Driver Table.
<dd> Default is <tt>tra_*.asc</tt> (ASCII) or <tt>tra_*.bin</tt> (Binary).

<dt><b>Format</b>
<dd> See <a href=#spectra>Appendix D</a>

<dt><b>Example</b>
<dd><pre>
! Transmission calc. for Tangent Hgt=   40.000 [km] by RFM v.4.00
!14-JUL-96 RFM code test
!No.Pts  Lower_Wavenumber   Delta_Wavenumber  Upper_Wavenumber  Label
     81  952.000000000000 0.0250000000000000  954.000000000000 'Transmission'
 0.9999991971452954 0.9999991495561950 0.9999990976068126 0.9999990407479853
 0.9999989783407944 0.9999989096392288 0.9999988337677885 0.9999987496924945
  ... etc
[eof]
</pre>
</dl>
<hr>
<a name=widfil>
<h3> .wid FILE: Widemesh Diagnostics </h3>

<dl>
<dt><b>Type</b>
<dd> Output(s), if <A href=#widflg>WID</a> Flag is enabled.
<dd> One file created per spectral range, per absorber, plus an extra file
for total of all absorbers if more than one absorber present.

<dt><b> Description </b>
<DD> Diagnostics (mainly line counts) for widemesh intervals.

<dt><b>Filename(s)</b>
<dd> Specified in <A href=#wid><tt>*WID</tt></a> section of the Driver Table.
<dd> Default is <tt> wid_*.asc </tt> 
<dd> The name of the `total absorber' file contains just the
    spectral range label inserted at the <tt>`*'</tt> (ie no absorber name).

<dt><b>Format</b>
<dd><pre>
HEADER1
HEADER2
NWID WNO1 DWNO '=NWid,Wno1,DWno' 
HEADER3
IWID(1) WNOL(1) TOTL(1) WIDL(1) FINL(1) LOCL(1) XSC(1) CTM(1) 
IWID(2) WNOL(2) TOTL(2) WIDL(2) FINL(2) LOCL(2) XSC(2) CTM(2) 
...
IWID(NWID) WNOL(NWID) ... CTM(NWID) 
NINTL NEXTL '= Internal, external lines used for whole range'
[eof]
</PRE>
<dt><b>Fields</b>
	<DL>
	<dT><TT>HEADER1</TT> (Character)
	<dd> Contains gas and RFM version
	<dt><tt>HEADER2</tt> (Character)
	<dd> Text read from <a href=#hdr><tt>*HDR</tt></a> section of the 
	Driver Table
	<DT> <TT>NWID</TT> (Integer)
	<DD> No.of widemesh intervals 
	<DT> <TT>WNO1</TT> (Real)
	<DD> Lower Wavenumber [cm-1] of 1st interval 
	<DT> <TT>DWNO</TT> (Real)
	<DD> Width [cm-1] of widemesh intervals 
	<dt><tt>HEADER3</tt> (Character)
	<dd> Column headers for data records 
  	(i.e. `<tt>Itvl#  Wavenumber Tot.Lines ...</tt>')
	<DT> <TT>IWID(NWID)</TT> (Integer Array)
	<DD> Index of Widemesh interval (1:NWID) 
	<DT> <TT>WNOL(NWID)</TT> (Real Array)
	<DD> Lower Wavenumber [cm-1] of Widemesh interval 
	<DT> <TT>TOTL(NWID)</TT> (Integer Array)
	<DD> Total number of lines considered  (=<tt>WIDL+FINL</tt>)
	<DT> <TT>WIDL(NWID)</TT> (Integer Array)
	<DD> Number of lines used for quadratic interpolation 
	<DT> <TT>FINL(NWID)</TT> (Integer Array)
	<DD> Number of lines used with explicit calculation 
	<DT> <TT>LOCL(NWID)</TT> (Integer Array)
	<DD> Number of lines centres lying inside widemesh interval 
	     (.LE. <TT>FINL</TT>)
	<DT> <TT>XSC(NWID)</TT> (Integer Array)
	<DD> 1 or 0 indicating whether particular molecule cross-section was
             used (in gas files), or total number of molecular cross-sections
             used (in total file).
	<DT> <TT>CTM(NWID)</TT> (Integer Array)
	<DD> 1 or 0 indicating whether particular molecule continuum was
             used (in gas files), or total number of molecular continua 
             used (in total file).
        <DT> <TT>NINTL</TT> (Integer)
        <DD> Total number of lines used centred within specified spectral range
        <DT> <TT>NEXTL</TT> (Integer)
        <DD> Total number of lines used centred outside specified spectral range
	</dl>
<dt><b>Example</b>
<dd> This is the output for a RFM run using a single CO2 line centred in the
952-953 cm-1 interval. It is shown as a local line for interval 3,
its contribution is included explicitly for this and adjacent intervals
(2-4), and as a quadratic interpolation in intervals 1 and 5.
</dl>
<dd><pre>
! co2     Widemesh Line count created by RFM v.4.04
!14-APR-00 RFM code test
          5   950.0000000000000       1.000000000000000     =NWid,Wno1,DWno
Itvl#  Wavenumber Tot.Lines = Wide mesh + Fine mesh  Local  X/Section Continuum
    1   950.00000         1         1         0         0         0         0
    2   951.00000         1         0         1         0         0         0
    3   952.00000         1         0         1         1         0         0
    4   953.00000         1         0         1         0         0         0
    5   954.00000         1         1         0         0         0         0
          1          1 = Internal, external lines used for whole range
</pre>
<hr>
<a name=xscfil>
<h3> .xsc FILE: Cross-Section Data </h3>
<dl>
<dt><b>Type</b>
<dd> Input(s), mandatory if any cross-section molecules are selected
(those with HITRAN ID 50 or higher in <a href=#gaslist>Appendix E</a>

<dt><b>Description</b>
<DD>Molecular cross-section data for one or more species.

<dt><b>Filename</b>
<dd>Specified in the  <a href=#xsc><tt>*XSC</tt></a> section of the 
Driver Table.

<dt><b>Format</b>
<dd> See <a href=#rothman>Rothman <i>et al</i> (1992)</a>

<dt><b>Example</b>
<dd> See <a href=rfm_downloads.html#xsc>RFM Downloads</a>
</dl>
<hr>
<a name=spectra>
<h2> APPENDIX D: OUTPUT SPECTRA </h2>

The RFM can create spectra of <a href=#atmfil>Absorption</a>,
<a href=#bbtfil>Brightness Temperatures</a>, 
<a href=#coofil>Cooling Rates</a>, 
<a href=#optfil>Optical Depth</a>, 
<a href=#radfil>Radiance</a> and 
<a href=#trafil>Transmission</a>.
These are single precision by default, but double precision can be selected
with the <a href=#dblflg>DBL</a> flag.
These are in wavenumber [cm-1] by default, but frequency [GHz] can be selected
with the <a href=#ghzflg>GHZ</a> flag.
These can be either ASCII or Binary files, depending on the 
<A href=#binflg>BIN</a> Flag status. There is one difference between the two
formats.

<dl>
<dt><b>Format</b>
<dd>
Common to both ASCII and Binary files:
<pre>
HEADER1
HEADER2
HEADER3
NPT  PT1  PTD  PT2  LABEL 
</PRE>
Then, for ASCII files, the spectrum is written as a single array:
<pre>
DAT(1)  DAT(2) ... 
                    ... DAT(NPT) 
[eof]
</pre>
For Binary files, the spectrum is written as a sequence of records, each
record starting with the number of points in the record
<pre>
NP1   DAT(1)      DAT(2)     ... DAT(NP1)
NP2   DAT(NP1+1)  DAT(NP1+2) ... DAT(NP1+NP2)
...
NPn   DAT(NPT-NPn+1)         ... DAT(NPT)
[eof]
</PRE>

<DT><B>Fields</b>
	<dl>
	<dt><tt>HEADER1</tt> (Character)
	<dd> Contains tangent height and RFM version identifier
	<dt><tt>HEADER2</tt> (Character)
	<dd> Text read from <a href=#hdr><tt>*HDR</tt></a> section of 
	Driver Table
	<dt><tt>HEADER3</tt> (Character)
	<dd> Captions for next record, including whether spectra defined 
            in Wavenumber or Frequency (or, for <a href=#jac>Jacobian
	spectra</a>, details of perturbed species and altitude)
	<dt><tt>NPT</tt> (Integer)
	<dd> No.of tabulated spectral points 
	<DT> <TT>PT1</TT> (Real)
	<DD> Wavenumber [cm-1] or Frequency [GHz] of first/lowest tabulated 
             point 
	<DT> <TT>PTD</TT> (Real)
	<DD> Wavenumber [cm-1] or Frequency [GHz] increment of tabulation 
	<DT> <TT>PT2</TT> (Real)
	<DD> Wavenumber [cm-1] or Frequency [GHz] of last/highest tabulated 
             point 
	<DT> <TT>LABEL</TT> (Character)
	<DD> Either Spectral Range Label, enclosed in single quotes, or, if no 
	     range label specified a default label for type of spectrum.
	<DT> <TT>NPi</TT> (Integer)
	<DD> Number of spectral points following in current record 
             (Binary files only) 
	<DT> <TT>DAT(NPT)</TT> (Real Array)
	<DD> Spectrum
	</dl>
</dl>
Suggested FORTRAN code for reading BIN files:
<pre>
      INTEGER          I, J, N, NPTS
      REAL             X(MAXARR)         ! Or DOUBLE PRECISION for DBL flag
      DOUBLE PRECISION WNO1, WNOD
      CHARACTER*80     RECORD
C
      OPEN ( UNIT=LUN, FILE=FILNAM, STATUS='OLD', FORM='UNFORMATTED' )
C
      READ ( LUN ) RECORD                ! Skip 3 header records
      READ ( LUN ) RECORD
      READ ( LUN ) RECORD
C
      READ ( LUN ) NPTS, WNO1, WNOD      ! No.pts, 1st Wno, Wno increment
C
      J = 0                              ! J=number of points read so far
      DO WHILE ( J .LT. NPTS )
        READ ( LUN ) N, ( X(I), I = J+1, J+N )   
        J = J + N
      END DO
C
</pre>
An IDL Procedure, <tt>rfmrd.pro</tt> can be found in the 
<a href=rfm_downloads.html#idl>Downloads</a> section
<hr>
<a name=gaslist>
<h2> APPENDIX E: LIST OF RECOGNISED ABSORBERS </h2>

Line data (Numbers refer to HITRAN ID for molecule, as defined on the
<a href=http://www.hitran.com>HITRAN web-site</a>)
<pre>
 1 H2O           9 SO2          17 HI           25 H2O2         33 HO2
 2 CO2          10 NO2          18 ClO          26 C2H2         34 O
 3 O3           11 NH3          19 OCS          27 C2H6        *35 ClONO2
 4 N2O          12 HNO3         20 H2CO         28 PH3          36 NO+
 5 CO           13 OH           21 HOCl         29 COF2         37 HOBr
 6 CH4          14 HF           22 N2          *30 SF6          38 C2H4
 7 O2           15 HCl          23 HCN          31 H2S
 8 NO           16 HBr          24 CH3Cl        32 HCOOH
</pre>
*These species are represented by both line-by-line HITRAN data and tabulated
cross-section data (species#64 and #61 respectively). Since the 
cross-section tabulations are usually more comprehensive in terms of wavenumber coverage
the RFM default is to assume cross-section. To force the line data to be used,
in the <a href=sum.html#gas>*GAS</a> section of the driver table either
specify the HITRAN molecule# ("30" or "35") or add "Q" or "q" after the name,
eg "sf6q", "clono2q" (NB, SF6 cross-section data is only available with
<a href=rfm_upgrades.html#v420>v4.20</a> onwards, previous versions assign
this ID to X64).
<p>
HDO, if listed by the user in the 
driver table, is treated as a separate gas (otherwise it is included with the other
H2O isotopes as having the same mixing ratio profile)
<pre>
39 HDO
</PRE>
Additional species from MASTER (BrO is index 40, inserted from
<a href=rfm_upgrades.html#v422>v4.22</a> onwards, ID=40 previously assigned to
GeH4) and
<a href=http://www.ara.polytechnique.fr/alexei_index.html>GEISA 1997</a> dataset
 (Species 41-46 only defined for RFM <a
href=rfm_upgrades.html#v410>v4.10</a> onwards, and
ID codes are RFM-specific, not HITRAN or GEISA standards).
<pre>
40 BrO   (40 was GeH4 from v4.10-4.21)
41 C3H8
42 C2N2
43 C4H2
44 HC3N
45 C3H4
46 GeH4  (46 was unassigned prior to v4.22)
</pre>
Aerosol data (used for any absorber tabulated as a profile of extinction/km)
<pre>
50 Aerosol (ID code is RFM-specific, not HITRAN-standard)
</pre>

Cross-Section data (ID codes are RFM and GENLN2-specific, not HITRAN-standard)
<BR>
Species 70-81, distributed with HITRAN2000, are only accessible with 
RFM <A HREF=rfm_upgrades.html#v411>v4.11</a> onwards.
<pre>
                        60 CCl4                *70 CHCl2CF3      (F123)
51 CFCl3   (F11)        61 ClONO2              *71 CHClFCF3      (F124)
52 CF2Cl2  (F12)        62 N2O5                *72 CH3CCl2F      (F141b)
53 CClF3   (F13)        63 HNO4                *73 CH3CClF2      (F142b)
54 CF4     (F14)        64 SF6                 *74 CHCl2CF2CF3   (F225ca)
55 CHCl2F  (F21)        65 X65 (RFM-specific)  *75 CClF2CF2CHClF (F225cb)
56 CHClF2  (F22)        66 X66 (RFM-specific)   76 CH2F2         (F32)
57 C2Cl3F3 (F113)       67 X67 (RFM-specific)   77 CHF2CF3       (F125)
58 C2Cl2F4 (F114)       68 X68 (RFM-specific)  *78 CHF2CHF2      (F134)
59 C2ClF5  (F115)       69 X69 (RFM-specific)   79 CFH2CF3       (F134a)
                                                80 CF3CH3        (F143a)
                                                81 CH3CHF2       (F152a)
</pre>
*The RFM only accepts chemical names up to 7 characters long, so these species
can ONLY be specified by the "F..." form.
<p>
The absorbers X65 - X69 
are for user-defined cross sections. To use these, eg defining X65 as benzene,
<ul>
<li> Create a <a href=sum.html#xscfil>cross-section file</a> 
(eg <tt>benzene.xsc</tt>)
containing the tabulated absorption as a function of wavenumber, pressure and
temperature and list this filename in the <a href=sum.html#xsc>*XSC</a> 
section of the
driver table. The header record for each (p,T) table must contain the 
corresponding ID, <tt>65</tt>.
<li> Create an <A href=sum.html#atmfil>atmospheric profile</a> 
(eg <tt>benzene.atm</tt>)
and list this filename in the <a href=sum.html#atm>*ATM</a> 
section of the driver table.
In the file, the profile must be preceded by the key <tt>*X65</TT>.
<li> Add the gas either as <tt>X65</tt> or <tt>65</tt> 
to the <a href=sum.html#gas>*GAS</a> section of the
driver table.
</ul>
If you want to "hard-wire" in your own names instead of "X65", etc., 
change the data statement for array <TT>CODMOL</TT> in
     subroutine <tt>GASCHK.FOR</tt>.
<hr>
<a name=abb>
<h2> 13. LIST OF ABBREVIATIONS </h2>
<dl>
<dt> CFC
<DD> Chloro-Fluoro Carbon
<dt> ESA
<DD> European Space Agency
<dt> FOV
<dd> Field of View 
<dt> ILS
<dd> Instrument Line Shape
<dt> LTE 
<dd> Local Thermodynamic Equilibrium 
<dt> MIPAS
<dd> Michelson Interferometer for Passive Atmospheric Sounding
<dt> OFM
<dd> Optimised Forward Model
<dt> PPMV
<dd> Parts Per Million by Volume
<dt> RFM
<dd> Reference Forward Model
<dt> SUM
<dd> Software User's Manual
<dt> VMR
<dd> Volume Mixing Ratio
</dl>
<hr>
<a name=ref>
<h2> 14. REFERENCES </h2>
<h3> Applicable Documents </h3>
<ol>
<a name=sow>
<li> PO-SW-ESA-GS-00323<br>
	Development of a Reference Forward Algorithm for the Simulation of
        MIPAS Atmospheric Limb Emission Spectra - Statement of Work.<br>
	ESTEC, Noordwijk, NL, December, 1995.
<a name=srd>
<li> PO-RS-OXF-GS-0001<BR>
	Software Requirements Document<br>
	Oxford University, UK, August 1996.
<a name=svvp>
<li> PO-PL-OXF-GS-0002<BR>
	Software Verification and Validation Plans<br>
	Oxford University, UK, August 1996.
<a name=hlad>
<li> PO-MA-OXF-GS-0004<BR>
	High Level Algorithms Definition<br>
	Oxford University, UK, October 1996.
<a name=std>
<li> PO-MA-OXF-GS-0009<BR>
	Software Transfer Document<br>
	Oxford University, UK, September 1996.
<a name=gosg>
<li> PO-TN-OXF-GS-0010<BR>
	Generation of Optimized Spectral Grids <br>
	Oxford University, UK, November, 1997.
<a name=svd>
<li> PO-TN-OXF-GS-0011<BR>
	SVD-Decompression for Tabulated k-Coefficients<br>
	Oxford University, UK, November, 1997.
</ol>
<h3>Reference Documents</h3>
<ol> 
<a name=edwards>
<li> Edwards, D.P. (1992)<br>
	GENLN2: A General Line-by-line Atmospheric Transmittance and Radiance 
	Model. Version 3.0 Description and User's Guide. <br>
	Report NCAR/TN-367+STR. NCAR, Boulder, CO, USA.
<a name=rothman>
<li> Rothman, L.S. <i>et al.</i>, (1992) <br>
	The HITRAN database: Editions of 1991 and 1992. </br>
	<i>J. Quant. Spectrosc. Radiat. Transfer</i>, <b>48</b>, 469-507.
</ol>



g.s	t<